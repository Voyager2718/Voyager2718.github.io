_.Module.define({path:"common/widget/Icons",requires:["IconCard","IconsBookView","IconsBookTip","IconsBookControl"],sub:{initial:function(a){this._buySlot=$(".j_icon_slot_buy");this._icon_book_wrap=$(".j_book_icon");if(!a){this.bindEvents()}},getPreIconHtml:function(e,d){var c=["\u8d34\u5427\u4f1a\u5458","\u8d34\u5427\u9ad8\u7ea7\u4f1a\u5458"];var f;var a="";var b=Math.round(new Date().getTime()/1000);if(Env.server_time>1396281600000&&Env.server_time<1396368000000&&d!=4){a='<div class="pre_icon_wrap pre_icon_wrap_theme1">';f=2;a+='<a class="icon_tbworld tbworld_lv'+f+'" href="/tbmall/home" target="_blank" title="'+c[f-1]+'"></a>';a+="</div>";return a}if(e&&e.level&&e.level["end_time"]>b){a='<div class="pre_icon_wrap pre_icon_wrap_theme1">';f=e.level.props_id;a+='<a class="icon_tbworld tbworld_lv'+f+'" href="/tbmall/home" target="_blank" title="'+c[f-1]+'"></a>';a+="</div>"}return a},_getIconsHtml:function(j,h){var h=h||1;var k=j.iconinfo;var b=PageUnit.load("icons_cfg");var p=50;var e="";if(k&&k.length>0){e='<div class="icon_wrap icon_wrap_theme1">';var q=null,o,m,a,f,l,d;for(var g=0;g<k.length;g++){q=k[g];l=b[q.name+"_"+q.value];o=q.sprite[q.value];if(!o){for(var n in q.sprite){if(q.sprite[n]){o=q.sprite[n];l=b[q.name+"_1"];break}return e}}m=o.split(",");a=m[0];f=m[1];d='style="background: url(http://static.tieba.baidu.com/tb/cms/com/icon/icon_sprite.png?stamp='+a+") no-repeat -"+f*p+"px  -"+(h-1)*p+'px;"';switch(q.name){case"meizhi_level":var c=q.value;c=c?c:0;if(c>=2){c-=2;e+="<a "+d+' class="maizhi_link" href="/p/'+q.meizhi_thread_id+'" target="_blank" title="\u8d34\u5427\u59b9\u7eb8\u8ba4\u8bc1"><span class="icon_meizhi meizhi_level_'+c+'"></span></a>'}break;case"is_member":e+="<a "+d+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(l){if(l[1]){e+="<a "+d+' target="_blank" href="'+l[1]+'" title="'+l[0]+'" locate="'+q.name+"_"+q.value+'"></a>'}else{e+="<span "+d+' title="'+l[0]+'" locate="'+q.name+"_"+q.value+'"></span>'}}}}e+="</div>";return e}},getIconsHtml:function(c,b,h){var b=b||1;var h=h?h:5;var e=c.new_iconinfo;var f=0;for(var a in e){f++}var d='<div class="icon_wrap  icon_wrap_theme1">';var i=0;if(!e){var k=c.iconinfo;if(k){var g=k[0];d+=this._getIconHtml(g,1)}}for(var l in e){var m=e[l];if(i==h){break}if($.isEmptyObject(m)){if(l=="1"){var k=c.iconinfo;if(!$.isEmptyObject(k)){var g=this._getReplaceIcon(k,e);if(!g){continue}d+=this._getIconHtml(g,1);i++}}}else{d+=this._getIconHtml(m,1);i++}}d+="</div>";return d},_getReplaceIcon:function(c,a){if($.isEmptyObject(a)){return c[0]}else{for(var b=0;b<c.length;b++){var d=c[b];if(!this._judgeIconInNewiconinfo(a,d)){return d}}return null}},_judgeIconInNewiconinfo:function(a,c){if($.isEmptyObject(a)){return false}if($.isEmptyObject(c)){return false}else{for(var b in a){var d=a[b];if(d&&d.name==c.name){return true}}return false}},_getIconHtml:function(l,g){var g=g||1;var b=PageUnit.load("icons_new_cfg");var m=50;var e="";var k,i,a,f,h,d;h=b[l.name+"_"+l.value];k=l.sprite[l.value];if(!k){for(var j in l.sprite){if(l.sprite[j]){k=l.sprite[j];h=b[l.name+"_1"];break}return e}}i=k.split(",");a=i[0];f=i[1];d='style="background: url(http://static.tieba.baidu.com/tb/cms/com/icon/icon_sprite.png?stamp='+a+") no-repeat -"+f*m+"px  -"+(g-1)*m+'px;"';switch(l.name){case"meizhi_level":var c=l.value;c=c?c:0;if(c>=2){c-=2;e+="<a "+d+' class="maizhi_link" href="/p/'+l.meizhi_thread_id+'" target="_blank" title="\u8d34\u5427\u59b9\u7eb8\u8ba4\u8bc1"><span class="icon_meizhi meizhi_level_'+c+'"></span></a>'}break;case"is_member":e+="<a "+d+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(h){if(h[1]){e+="<a "+d+' target="_blank" href="'+h[1]+'" title="'+h[0]+'" locate="'+l.name+"_"+l.value+'"></a>'}else{e+="<span "+d+' title="'+h[0]+'" locate="'+l.name+"_"+l.value+'"></span>'}}}return e},bindEvents:function(){var a=this}}});