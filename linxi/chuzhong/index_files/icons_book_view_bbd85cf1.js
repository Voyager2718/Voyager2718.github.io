_.Module.define({path:"common/widget/Icons/IconsBookView",requires:["IconsBookTip"],sub:{tabIconsContentCongfig:{},_collect_icon_title:{101:"\u96c6\u9f5032\u4e2a\u56fd\u65d7\u5370\u8bb0\u5956\u52b1\u3010\u8d34\u5427\u4e16\u754c\u676f\u3011\u5370\u8bb0",102:"\u96c6\u9f5012\u4e2a\u661f\u5ea7\u5370\u8bb0\u53ef\u4ee5\u83b7\u5f9712\u4e2a\u9ec4\u91d1\u7248\u661f\u5ea7\u5370\u8bb0",103:"",104:""},initial:function(){},_getTabPanelTpl:function(){var a=['<div id="icon_book_wrap" class="_j_icon_book_wrap">','<div  class="icon_book">','<div class="icon_book_tab">','<ul  class="icon_book_tab_head">',"#{tabHead}","</ul>",'<div id="tab_body"  class="icon_book_tab_body">',"#{tabContent}","</div>","</div>","</div>",'<div class="icon_book_close"></div>',"</div>"].join("");return a},getTabItem:function(a){var l=this;var c=['<li id="tab_head_#{index}" data-categoryId="#{category_id}" class="tab_deactive">','<div class="head_inner #{separator_cls}">','<button type="button" class="tab_button" hidefocus="true"  > ','<a href="javascript:void(0)">#{title}</a></button></div></li>'].join("");var d=['<div id="tab_content_#{index}" class=" tab_body_item ">',"</div>"].join("");var j="",h="";a=a||[];var g=0;for(var k in a){g++}var f=0;for(var k in a){var e={index:f,category_id:k,title:a[k][0],separator_cls:f==g-1?"":"space"};f++;j+=$.tb.format(c,e);h+=$.tb.format(d,e)}var i={tabHead:j,tabContent:h};var b=l._getTabPanelTpl();return $.tb.format(b,i)},getTabContent:function(k,d,b){var f="";var h="";var l=this;var m=0;var e=0;k=k||{};if(k.normal&&!k.advanced){var j=k.normal||[];var g=j.length;m=5;if(g/50<=1){e=10}else{e=g%m==0?Math.floor(g/m):Math.floor(g/m)+1}f+=l._getPositionIconListHtml(j,e,d);h=l._getCommIconWrap(null,m,e,f);l.tabIconsContentCongfig.comm={row:m,col:10,total_col:e};return h}else{if(k.advanced&&k.advanced){var j=k.normal||[];var a=k.advanced||[];var g=j.length;var i=a.length;var c="";m=2;if(g/20<=1){e=10}else{e=g%m==0?Math.floor(g/m):Math.floor(g/m)+1}f+=l._getPositionIconListHtml(j,e,d);h=l._getCommIconWrap(null,m,e,f);l.tabIconsContentCongfig.comm={row:m,col:10,total_col:e};h+=l._getDownArrowHtml();if(i/20<=1){e=10}else{e=g%2==0?Math.floor(i/2):Math.floor(i/2)+1}c+=l._getPositionIconListHtml(a,e,null);h+=l._getAdvancedIconWrap(null,m,e,c,b);l.tabIconsContentCongfig.adv={row:m,col:10,total_col:e};return h}}return h},_getCommIconWrap:function(e,f,d,b){var c={arrow_top:f==5?100:45,arrow_visiblity:d>10?"visible":"hidden",height_cls:f==5?"icon_wrap_5":"",icon_list:b,total_col:d};var a=['<div class="icon_wrap #{height_cls}">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="left_arrow arrow_block" style=" top:#{arrow_top}px;"></div></div>','<div class="icon_view"  total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:#{arrow_top}px;"></div></div>',"</div>"].join("");return $.tb.format(a,c)},_getAdvancedIconWrap:function(g,h,e,c,f){var a=this;var d={title:a._collect_icon_title[f],arrow_visiblity:e>10?"visible":"hidden",icon_list:c,total_col:e};var b=['<div class="collect_icon_wrap">','<div class="collect_icon_title"><span>#{title}</span></div>','<div class="collect_wrap">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="  left_arrow arrow_block" style="top:45px;"></div></div>','<div class="icon_view" total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow  " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:45px;"></div></div>',"</div>","</div>"].join("");return $.tb.format(b,d)},_getDownArrowHtml:function(){return'<div class="wrap_donw_arrow"></div>'},_getPositionIconListHtml:function(o,k,b,f){var h="";var m=this;var d=false;var g=o.length;var n=0;var a=0;for(var e=0;e<g;e++){n=Math.floor(e/k);a=e%k;var j=n*55;var c=a*55;if(b&&b==o[e].name){d=true}else{d=false}var l="";if(o[e].is_advanced==0){l=m._getCommonIconTpl(o[e],j,c,d)}else{l=m._getAdvIconTpl(o[e],j,c,f)}h+=l}return h},_getCommonIconTpl:function(l,k,e,h){var o=this;var n=l.sprite[l.value].split(",");var i=50;var a=n[0];var d=n[1];var f=(3-1)*i;var g=d*i;var m="http://tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png";var b="background: url("+m+"?stamp="+a+") no-repeat -"+g+"px -"+f+"px;";var c={icon_top:k,icon_left:e,name:l.name,in_use:l.in_use,in_use_cls:l.in_use==1?"":" icon_not_use",selected_cls:h?" icon_selected":"",level:l.value,background:b,locked_cls:(l.in_use==0&&l.price==0)?" icon_locked":""};if(o._judgeCommIconInSlot(l.name)){c.locked_cls="icon_locked"}var j=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place #{in_use_cls}" style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{selected_cls} #{locked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(j,c)},_judgeCommIconInSlot:function(d){var a=PageData.new_iconInfo||{};for(var c in a){if(c=="1"&&$.isEmptyObject(a[c])){var b=this._getOldIconinfoInSlot();if(d==b){return true}}if(a[c].name==d){return true}}return false},_getOldIconinfoInSlot:function(){var b=$(".j_icon_slot").first();if(b){var a=b.tbattr("data-slot");return a}return null},_getAdvIconTpl:function(m,l,d,i){var o=m.sprite[m.value].split(",");var h=50;var a=o[0];var e=o[1];var f=(3-1)*h;var g=e*h;var n="http://tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png";var b="background: url("+n+"?stamp="+a+") no-repeat -"+g+"px -"+f+"px;";i=m.is_collected;var k=m.is_collected;var c={icon_top:l,icon_left:d,name:m.name,in_use:m.in_use,clocked_cls:k==1?" ":" icon_locked",level:m.value,background:b};var j=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place " style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{clocked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(j,c)},_judgeAdvIconLocked:function(d,e){var b=this;var a=false;e=parseInt(e);switch(e){case 101:break;case 102:if(!d){a=true}else{for(var c=0;c<d.length;c++){if(!d[c].in_use){a=true;break}}if(c==12&&a==false){a=false}else{a=true}}break;case 103:break;case 104:break}return a}}});