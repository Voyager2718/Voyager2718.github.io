_.Module.define({path:"common/widget/AsideFloatBar",requires:["common/component/InterestSmiley","props/widget/MagicProps"],sub:{initial:function(c){(typeof PDC!="undefined")&&PDC.mark("c_afbavi");this.options=c;this.$root=$('<ul class="tbui_aside_float_bar"></ul>');for(var f=0,a=c.buttons.length;f<a;f++){var e=c.buttons[f];this.addButton(e)}this.$root.appendTo("body");var b=this;b.relocate();$(window).resize(function(){b.relocate()});var d=PageData.product;if(d=="pb"){this.$root.find(".tbui_fbar_favor").on("mouseenter",function(){$.stats.track("PB\u60ac\u6d6e\u7231\u901b\u7684\u5427","\u8d34\u5427PC\u9875\u9762\u4f18\u5316","pb","click");$(this).find(".tbui_aside_favor_list a").one("click",function(){$.stats.track("PB\u60ac\u6d6e\u7231\u901b\u5427\u5c55\u5f00\u5427","\u8d34\u5427PC\u9875\u9762\u4f18\u5316","pb","click")})});this.$root.find(".tbui_fbar_square").on("click",function(){$.stats.track("\u79c0\u5427\u5bfc\u822a","pb_\u5427\u53f3\u4fa7\u5bfc\u822a","pb","click")})}if(d=="frs"){this.$root.find(".tbui_fbar_square").on("click",function(){$.stats.track("\u79c0\u5427\u5bfc\u822a","frs_\u5427\u53f3\u4fa7\u5bfc\u822a","frs","click")})}if(d=="frs"||d=="pb"||d=="pb_bright"){if(d=="frs"){var g=["\u79c0\u5427\u5bfc\u822a","\u53d1\u5e16","\u5237\u65b0","\u5206\u4eab","\u7231\u901b\u7684\u8d34\u5427","\u63a8\u8350\u6e38\u620f","\u5b9e\u9a8c\u5ba4","\u8fd4\u56de\u9876\u90e8"]}else{var g=["\u79c0\u5427\u5bfc\u822a","\u9b54\u6cd5\u9053\u5177","\u795e\u6765\u4e00\u53e5","\u5206\u4eab","\u7231\u901b\u7684\u8d34\u5427","\u63a8\u8350\u6e38\u620f","\u5b9e\u9a8c\u5ba4","\u8fd4\u56de\u9876\u90e8"]}this.$root.delegate(".tbui_aside_fbar_button","mouseenter",function(i){var h=$(i.target),j=h.parent().index();d=d=="pb"||d=="pb_bright"?"pb":"frs";$.stats.track(g[j]+"\u70b9\u51fb\u91cf","FRS/PB\u53f3\u4fa7\u5de5\u5177\u680f\u7edf\u8ba1",d,"click")})}},addButton:function(b){var a=$($.tb.format('<li class="tbui_aside_fbar_button tbui_fbar_#{btnName}"><a href="#"></a></li>',{btnName:b}));var c=this["_"+b];if(c){if(c.call(this,a)){this.$root.append(a)}}},relocate:function(){if($(window).width()<1105){this.$root.addClass("tbui_afb_compact")}else{this.$root.removeClass("tbui_afb_compact")}},_square:function(a){var b=this;a.children().tbattr("href","/show/v");a.children().tbattr("target","_blank");return true},_top:function(a){var d=$(window);if(d.scrollTop()==0){a.css("visibility","hidden")}a.click(function(){var g=null;var f=d.scrollTop();if($.browser.msie){window.scrollTo(0,0)}else{function e(){f=Math.floor(f/2);window.scrollTo(0,f);if(f>2){g=setTimeout(e,40)}else{window.scrollTo(0,0);clearTimeout(g)}}e()}});var c,b=false;d.bind("scroll",function(){if(c){clearTimeout(c)}c=setTimeout(function(){if(d.scrollTop()>0){if(b==false){a.css("visibility","visible");b=true}}else{if(b){a.css("visibility","hidden");b=false}}},500)});return true},_refresh:function(a){a.click(function(){if(window.Path){window.Path.refresh()}else{$.tb.location.reload()}return false});return true},_post:function(a){var b=this;a.children().tbattr("href","#sub");a.click(function(c){c.preventDefault();c.stopPropagation();setTimeout(function(){b.fire("wanna_post")},50)});return true},_share:function(a){var b=$("#bdshare_tb_l");if(b.size()==0){return false}b.delayhover({enterDelay:0,leaveDelay:700,mouseenter:function(){a.clearDelayHoverTimer()},mouseleave:function(){b.fadeOut()}});a.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){if(b.is(":visible")){b.clearDelayHoverTimer()}else{var c=a.offset();c.top-=1;c.left=c.left-b.outerWidth()+1;b.css(c).fadeIn()}},mouseleave:function(){b.fadeOut()}}).click(function(c){c.preventDefault();c.stopPropagation()});return true},_radar:function(a){var b=this;a.find("a").append('<img src="/tb/static-common/img/toolbar/radar.gif" class="tbui_radar_img" />');a.find("a").tbattr({href:$.tb.unescapeHTML(b.options.radarData&&b.options.radarData.link),target:"_blank"});a.on("mousedown","a",function(){$.stats.track("radar","radar_banner")});if($.browser.msie&&$.browser.version==7){a.css("marginBottom","-4px")}if($.browser.msie&&$.browser.version==6){a.append("<div></div>");a.css("marginBottom","-3px")}return true},_tsukkomi:function(a){var b=this;if($.browser.msie&&$.browser.version==7){a.css("marginBottom","-4px")}if($.browser.msie&&$.browser.version==6){a.append("<div></div>");a.css("marginBottom","-3px")}var c=$('<div class="tbui_aside_smiley"></div>');b.interestSmile=this.use("common/component/InterestSmiley",{container:c,smileClass:"t_smile_bg",type:"toolbar",scrollCss:{padding:"9px 0px 0px 0px"},scrollBarHide:function(){c.width(296)},scrollBarShow:function(){c.width(306)},dataPostor:b.options.dataPostor});b.interestSmile.generic();a.append(c);a.children("a").click(function(d){d.preventDefault();d.stopPropagation();if(c.is(":visible")){c.fadeOut()}else{c.fadeIn();if(b.interestSmile.scrollPanel){b.interestSmile.scrollPanel.setHeight(156)}}});return true},_favor:function(a){if(PageData.user.is_login==false){return false}var d=[];if(PageData.user.user_forum_list&&PageData.user.user_forum_list.info){d=PageData.user.user_forum_list.info}if(PageData.user_forumlist&&PageData.user_forumlist.info){d=PageData.user_forumlist.info}if(d.length==0){return false}if($.browser.msie&&$.browser.version==6){a.append("<div></div>");a.css("marginBottom","-3px")}var h=$('<ul class="tbui_aside_favor_list clearfix" id="tbui_aside_favor_list"></ul>');if(d.length>0){var f=d;var b,g=false;if(f.length<=8){b=f.length}else{b=7;g=true}for(var c=0;c<b;c++){var e={kw:encodeURIComponent(f[c].forum_name),forumName:$.tb.subByte(f[c].forum_name,12)};h.append($.tb.format('<li><a href="http://tieba.baidu.com/f?ie=utf-8&kw=#{kw}" target="_blank" class="ui_text_summary">#{forumName}</a></li>',e))}if(g){h.append('<li><a target="_blank" class="ui_text_desc" href="http://tieba.baidu.com/home/forum?id='+PageData.user.portrait+'" class="aside_float_favforum_more">\u66f4\u591a&gt;&gt;</a></li>')}}h.hide().appendTo(a);a.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){h.fadeIn()},mouseleave:function(){h.fadeOut()}}).children("a").click(function(i){i.preventDefault();i.stopPropagation()});h.delegate("a","mousedown",function(){if(PageData&&PageData.forum&&PageData.product){if($(this).hasClass("ui_text_desc")){return}var i={st_mod:"aside_bar",st_type:"enterba",st_from:PageData.product,st_uid:(PageData.user.user_id),st_benba:encodeURIComponent(PageData.forum.forum_name),st_goto:encodeURIComponent($(this).text())};$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/hive.gif",i)}});return true},_lab:function(a){a.children().tbattr("target","_blank").tbattr("href","http://tieba.baidu.com/mo/q/topic_page/219_1");var d=$("<div class='tbui_aside_lab_tip'></div>");a.append(d);$.tb.Storage.remove("close_cm_bubble");if($.tb.Storage.get("close_mt_bubble")!="1"){var c={content:"<span class='ui_text_emphasize'>\u6587\u5b57\u8f6c\u8868\u60c5</span>\u529f\u80fd\u4e0a\u7ebf\u5566\uff0c\u5feb\u6765\u5c1d\u9c9c\u5566~",arrow_dir:"right",bubble_css:{top:0,right:50,width:150},wrap:d,closeBtn:true};var b=new UiBubbleTipBase(c);b.bind("onclose",function(){$.tb.Storage.set("close_mt_bubble","1",(new Date().getTime()+(7*24*3600*1000)));b.closeBubble()});b.j_bubble.show()}return true},_props:function(a){var b=this;if($.browser.msie&&$.browser.version==6){a.append("<div></div>");a.css("marginBottom","-3px")}b.props=this.use("props/widget/MagicProps",{wrap:a,propsData:b.options.propsData});return b.props.visible}}});