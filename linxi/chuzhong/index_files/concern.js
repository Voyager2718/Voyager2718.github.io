_.Module.define({path:"pb/widget/Posts/Concern",sub:{config:{excute:"st_mod=pb&fr=tb0_forum&st_type=add_follow",cancel:"st_mod=pb&fr=tb0_forum&st_type=unfollow"},initial:function(e,n,i){try{this.jdom=e,this.author=n,this.postList=i,this.initConcern()}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/posts/concern.js",method:"",ln:20}),$.se({msg:(t.message||t.description).replace(/\s+/g,"-"),locator:"pb:widget/posts/concern.js",linenum:20})}},initConcern:function(){this.author.is_concerned?this.setConcered():this.setUnConcered()},setConcered:function(){var e=this;if(this.author.id!=PageData.user.id){this.jdom.find("li.l_concern").css("display","block"),this.jdom.find("li.c_concern").css({display:"block",width:"66px"});var n=this.jdom.find("div.p_concern");n.html("<span class='d_followed'></span>"),n.unbind().bind("mouseenter",{user:this},function(){$(this).find("span")[0].className="d_unfollow",$(this).find("span.d_unfollow").unbind().bind("click",function(){try{return PageData.user.is_login&&PageData.user.no_un?TbCom.process("User","buildUnameFrame"):e.cancel(),!1}catch(n){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/posts/concern.js",method:"",ln:48}),$.se({msg:(n.message||n.description).replace(/\s+/g,"-"),locator:"pb:widget/posts/concern.js",linenum:48})}})}),n.bind("mouseleave",{user:this},function(){$(this).find("span")[0].className="d_followed"})}else this.jdom.find("li.l_concern").css("display","none"),this.jdom.find("li.c_concern").css("display","none")},setUnConcered:function(){var e=this;if(this.author.id!=PageData.user.id){this.jdom.find("li.l_concern").css("display","block"),this.jdom.find("li.c_concern").css({display:"block",width:"66px"});var n=2==this.author.gender?"d_follow_her":"d_follow_him";this.jdom.find("div.p_concern").html("<span href='' class='"+n+"'></span>"),this.jdom.find("div.p_concern").unbind(),this.jdom.find("span."+n).bind("click",function(){try{return PageData.user.is_login&&PageData.user.no_un?TbCom.process("User","buildUnameFrame"):e.excute(),!1}catch(n){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/posts/concern.js",method:"",ln:76}),$.se({msg:(n.message||n.description).replace(/\s+/g,"-"),locator:"pb:widget/posts/concern.js",linenum:76})}})}else this.jdom.find("li.l_concern").css("display","none"),this.jdom.find("li.c_concern").css("display","none")},changeConcernState:function(e,n){if(this.author.is_concerned=e,this.is_trigger="undefined"==typeof n?!0:n,this.is_trigger||(e?this.setConcered():this.setUnConcered()),this.is_trigger){for(var i=this,t=0,s=this.postList.length;s>t;t++){var o=this.postList[t],c=o.author,a=o.content;a.is_anonym||c.portrait!=i.author.portrait||o.concern.changeConcernState(e,!1)}this.is_trigger=!1}},excute:function(){var e=this,n={portrait:e.author.portrait,cmd:"follow",tbs:PageData.follow_sign,ie:"utf-8"};$.post("/i/commit?"+e.config.excute,n,function(n){var i=$.parseJSON(n);i&&i.is_done?e.changeConcernState(!0):e.showMessage("加关注",i._info)})},cancel:function(){var e=this,n={portrait:e.author.portrait,cmd:"unfollow",tbs:PageData.follow_sign,ie:"urf-8"};$.post("/i/commit?"+e.config.cancel,n,function(n){var i=$.parseJSON(n);i&&i.is_done?e.changeConcernState(!1):e.showMessage("取消关注",i._info)})},showMessage:function(e,n){var i='<div style="padding:20px 6px 12px 6px;line-height:18px;font-size:14px;text-align:center;">'+n.replace(/\r?\n/gi,"<br>")+"</div>";$.dialog.alert(i,{title:e,width:380})}}});