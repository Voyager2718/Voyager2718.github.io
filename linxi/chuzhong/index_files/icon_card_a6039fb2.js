_.Module.define({path:"common/widget/Icons/IconCard",sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:false,_is_first_show:true,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:true,auto_positon:false,event_target:null,offset:{x:0,y:0},card_leave_display:false,card_hover_show:true,card_leave_hide:false,attr:"",wrap:$("body")},initial:function(b){var a=this;a._option=$.extend(true,{},a._default_option,b);this._buildCard()},_buildCard:function(){var c=this._option;var a=this._genericTpl();var b=c.wrap;this._j_card=$(a);this._j_card.find(".j_content").html(c.content);b.append(this._j_card);delete c.card_css["height"];this._j_card.css(c.card_css);c.card_css.height=this._j_card.find(".j_content").outerHeight(true);this._arrow=this._j_card.find(".j_ui_white_arrow");if(c.arrow_pos.left===undefined){this._arrow_left=c.card_css.width/2-10;this._arrow.css({left:this._arrow_left})}this._arrow.css(c.arrow_pos);if(!c.arrow_req){this._j_card.find(".j_ui_white_arrow").hide()}if(c.auto_positon){this._autoPosition()}},_autoPosition:function(){var h=this._option;var k={},f=$(window).height(),l=$(window).width(),e=$(document).scrollLeft(),b=$(document).scrollTop(),a=h.event_target.innerWidth(),c=h.event_target.innerHeight(),d="";var n={x:h.event_target.offset().left-h.card_css.width/2+(h.event_target.outerWidth(true))/2,y:h.event_target.offset().top-h.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};k.left=n.x;k.top=n.y;var g=h.arrow_pos.left||this._arrow_left;var j=15;var m=l;if(l<$(document).width()){m=$(document).width()}var i=m-(h.card_css.width+j);if(k.left<j){g+=k.left-j;k.left=j}else{if(k.left>i){g+=k.left-i;k.left=i}}if(k.top<b){d="up";k.top+=c+(n.height||0);k.top-=h.offset.y}else{k.top+=((k.top+c)>(b+f)?-c-(n.height||0):0);d="down";k.top+=h.offset.y}this._arrow.removeClass("icon_white_down").removeClass("icon_white_up").addClass("icon_white_"+d).css({left:g});this._j_card.css(k)},_genericTpl:function(){var a=this._option.attr;var c=this._option.arrow_dir;var b=['<div class="icon_card_wrap" '+a+' style="visibility: hidden">','<div class="j_content icon_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow icon_white_'+c+'"></span>',"</div>"].join("");return b},showCard:function(b){var a=this;if(a._close_timer){clearTimeout(a._close_timer)}if(b&&b.type=="delayShow"){if(a._open_timer){clearTimeout(a._open_timer)}a._open_timer=setTimeout(function(){a._showCardDo()},b.time)}else{a._showCardDo()}},closeCard:function(b){var a=this;if(a._open_timer){clearTimeout(a._open_timer)}if(b&&b.type=="delayClose"){a._close_timer=setTimeout(function(){a._closeCardDo()},b.time)}else{a._closeCardDo()}},hideCard:function(b){var a=this;if(a._open_timer){clearTimeout(a._open_timer)}if(b&&b.type=="delayHide"){a._close_timer=setTimeout(function(){a._hideCardDo()},b.time)}else{a._hideCardDo()}},_showCardDo:function(){var a=this;if(a._is_first_show){}this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var a=this;if(this._j_card&&!this._is_show){a._j_card.remove()}},_hideCardDo:function(){var a=this;if(this._j_card&&!this._is_show){a._j_card.css({visibility:"hidden"})}},setContent:function(a){var c=this._option;if(this._j_card!==null){var b=this._j_card.find(".j_content");b.html(a);c.card_css.height=b.outerHeight(true);this._j_card.css({height:c.card_css.height});if(c.auto_positon){this._autoPosition()}}}}});