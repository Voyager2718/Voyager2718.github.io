_.Module.define({path:"ihome/widget/UserVisitCard",requires:["common/widget/Card","UserVisitCardBase","ihome/widget/Interaction","props/widget/Residual"],sub:{_visit_card:null,_visit_card_ajax:null,_option:{width:370},initial:function(a,i){window.Page&&Page.checkLoadedModules("UserVisitCard")||(this.dataObj=a,this._wrap=$("body"),this._util=this.use("userVisitCardBase"),this._interaction=this.use("ihome/widget/Interaction"),this._residual=this.use("props/widget/Residual"),i||this.bindEvents())},bindEvents:function(){var a=this;this._wrap.delegate(".j_user_card","mouseenter",function(){return a.buildCard($(this)),!1}),this._wrap.delegate(".j_user_card","mouseleave",function(){return a._visit_card_ajax&&a._visit_card_ajax.abort(),a._visit_card&&a._visit_card.closeCard({type:"delayClose",time:200}),a._visit_card=null,!1}),this._wrap.delegate(".card_userinfo_close","click",function(){return $("#user_visit_card").remove(),!1})},buildCard:function(a){var i=this;i._visit_card&&(i._visit_card.closeCard(),i._visit_card=null);var t='<div class="user_card_loading"><img src="/tb/static-ihome/img/loading2.gif"/>正在加载，请稍后...</div>',e={content:t,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:a,attr:"id='user_visit_card'",wrap:$("body")};i._visit_card=i.use("common/widget/Card",e),i._visit_card.showCard({type:"delayShow",time:200}),i.buildVisitCard(a)},getVisitCardContent:function(a){var i=this,t={ie:"utf-8"};a.un?t.un=a.un:t.id=a.id,$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data;e.bg_id=a.bg_id;var r=i._util.getVisitCardTpl(1,e,!0);a.wrap.html(r)}else{var r='<div class="user_card_loading">网络错误<a href="#" id="user_card_reload" class="user_card_reload">刷新</a></div>';a.wrap.html(r)}})},buildVisitCard:function(a){var i=this,t={ie:"utf-8"};a.getData().un?t.un=a.getData().un:t.id=a.getData().id,i._visit_card_ajax&&i._visit_card_ajax.abort(),i._visit_card_ajax=$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data,r=e.name==i.dataObj.uname,s=i._util.getVisitCardTpl(r,e,!0);i._visit_card.setContent(s),i._visit_card._j_card.bindData({un:e.name}),i._visit_card.showCard(),i._interaction._resetDataObj({is_login:PageData.user.is_login,un:e.name,tbs:PageData.tbs}),i._residual.showUI({wrap:$("#user_visit_card .userinfo_head_wrap"),props:e.appraise||{}}),$.stats.track("cardinfo","ihome_v1")}else{var s='<div class="user_card_loading">网络错误<a href="#" id="user_card_reload" class="user_card_reload">刷新</a></div>';i._visit_card.setContent(s),$("#user_card_reload").on("click",function(){return i.buildCard(a),!1})}})},bindVisitCardEvent:function(){var a=this;a._visit_card.showCard({type:"delayShow",time:200}),$.stats.track("cardinfo","ihome_v1")}}});
;_.Module.define({path:"ihome/widget/UserVisitCard/UserVisitCardBase",requires:["common/widget/Icons","common/widget/UserHead","common/widget/MemberApi","ihome/widget/MonthIcon"],sub:{countLen:0,initial:function(){},getVisitCardTpl:function(e,a,n){var r=PageData.product||"",i=this.use("common/widget/Icons"),t=this.use("common/widget/UserHead"),s=this.use("ihome/widget/MonthIcon"),o=this.use("common/widget/MemberApi"),_=t.getHeadFrameStyle(a,"105"),c={head_img:"/tb/static-ihome/img/panel_"+a.bg_id+".jpg",concernClass:"0"==a.can_followed?"btn_concern_done":"btn_concern",un:encodeURIComponent(a.name),btn_group:n?this.getBtnGroup(a):"",frameClass:_.hasFrame?"card_userinfo_left_frame":"",frameStyle:_.stylestr,portrait:t.getHeadUrl(a),fr:r,icon_pre:i.getPreIconHtml(a.mParr_props,a.free_flag),member_class:o.getMemberNameClass(a.mParr_props,a.free_flag),name:a.name_show,icon:i.getIconsHtml(a),sex:a.sex,tb_age:"-"==a.tb_age?a.tb_age:a.tb_age+"年",post_num:a.post_num,good_num:a.good_num,honor:s.getMonthIcon(a.tbmall_month_icon,2),honor_margin:this.getHonorMargin()};a.is_verify&&"0"!==a.is_verify&&(c.verify_info=this.getVerifyHTML(a.identify_info));var l="";e||(l='<div class="interaction_wrap interaction_wrap_theme2"><a class="#{concernClass}" target="_blank" href="#" onclick="return false"></a><a class="btn_sendmsg" target="_blank" href="http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un=#{un}"></a></div>');var m=['<div class="card_headinfo_wrap" id="card_headinfo_wrap">','<img class="card_userinfo_img" src="#{head_img}"/>','<a class="card_userinfo_guide" target="_blank" href="/tbmall/home"></a>',l,"</div>",'<div class="card_userinfo_wrap">','<div class="card_userinfo_left #{frameClass}">','<div class="userinfo_head_wrap">','<div class="userinfo_head" style="#{frameStyle}"></div>','<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" class="j_avatar" target="_blank"><img src="#{portrait}"/></a>',"</div>","</div>",'<div class="card_userinfo_middle">','<div class="card_userinfo_title clearfix">','#{icon_pre}<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" target="_blank" class="userinfo_username #{member_class}">#{name}</a>#{icon}',"</div>",'<div class="card_userinfo_num clearfix">','<span class="userinfo_sex userinfo_sex_#{sex}"></span>',"<span>吧龄:#{tb_age}</span>",'<span class="userinfo_split"></span>',"<span>发贴:#{post_num}</span>","</div>",'<div class="card_userinfo_honor honor_margin_#{honor_margin} clearfix">',"#{honor}","</div>","</div>","</div>","#{verify_info}"].join("");return $.tb.format(m,c)},getBtnGroup:function(e){var a="";if(e.id!==PageData.user.id){var n=e.can_begcard,r="";0==n?r='<a class="btn_begcard j_begcard" href="#"></a>':1==n?r='<a class="btn_begcard btn_forbidden">已申请</a>':2==n&&(r='<a class="btn_begcard btn_forbidden">已交换</a>');var i={private_msg:"http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un="+encodeURIComponent(e.name),btn_begcard:r};a=['<div class="card_btn_grounps">','<a class="btn_privatemsg" target="_blank" href="#{private_msg}"></a>',"#{btn_begcard}","</div>"].join(""),a=$.tb.format(a,i)}return a},getIcon:function(e){var a="";return e.identity&&(a+='<span title="贴吧实名认证" class="card_userinfo_icon card_icon_verify"></span>'),e.meizhi_level>0&&(a+='<a href="/p/'+e.meizhi_thread_id+'" target="_blank" title="贴吧妹纸认证" class="card_userinfo_icon meizhi_vip card_icon_meizhi_vip'+e.meizhi_level+'"></a>'),a},getHonor:function(e){if(e.novice)return'<div class="grade_level grade_level_novice" title="贴吧菜鸟">贴吧菜鸟</div>';var a={manager:{title:"吧主",level:19},assist:{title:"小吧主",level:20},picadmin:{title:"图片小编",level:21},videoadmin:{title:"视频小编",level:22},novice:{title:"菜鸟",level:23}},n=e.manager,r=null,i="",t="";this.countLen=0;for(var s in n){r=n[s];var o=r.forum_list.join("、"),_=a[s];o=r.count>2?o+"等吧"+_.title:o+"吧"+_.title,i+=this.getHonorItem(_.level,r.count,o),this.countLen+=String(r.count).length}var c=e.grade,l=[];for(var m in c)l.push(m);l.sort(function(e,a){return a-e});for(var d=0,f=l.length;f>d;d++){r=c[l[d]];var o=r.forum_list.join("、");r.count>2&&(o+="吧等"),t+=this.getHonorItem(l[d],r.count,o),this.countLen+=String(r.count).length}return i+t},getHonorMargin:function(){var e={2:"8px",3:"6px",4:"4px"},a=this.countLen-4;return e[a]||""},getHonorItem:function(e,a,n){var r={level:e,title:n,count:a},i=['<div class="grade_level grade_level_#{level}" title="#{title}">',"<span>#{count}</span>","</div>"].join("");return $.tb.format(i,r)},getVerifyHTML:function(e){for(var a={verify_reason:e[0]&&e[0].v_reason,verify_forums:""},n=['<div class="verify_wrap">','<div class="verify_content">','<div class="verify_desc">',"<span>官方认证：</span>","<span>#{verify_reason}</span>","</div>",'<div class="verify_forum">','<a class="verify_home" href="http://v.tieba.baidu.com/" target="_blank">申请企业官方吧</a>',"<span>入驻吧：</span>","#{verify_forums}","<span>官方吧主</span>","</div>","</div>","</div>"].join(""),r=0;r<e.length;r++)a.verify_forums+=this.getVForumItem(r,e[r].forum_name);return $.tb.format(n,a)},getVForumItem:function(e,a){var n="",r={},i=[];return a.length>5?(n=a.substring(0,5),n+="..."):n=a,r={index:e,verify_forum_name:n,origin_forum_name:encodeURIComponent(a)},i=['<span class="verify_forum_info">','<a target="_blank" class="verify_forum_name_#{index}" href="/f?ie=utf-8&kw=#{origin_forum_name}">#{verify_forum_name}</a>','<a target="_blank" href="http://v.tieba.baidu.com/">','<img class="verify_forum_icon" src="/tb/static-ihome/img/platform_blue_icon14.gif" alt="官方认证图标" title="百度贴吧官方平台认证">',"</a>","</span>"].join(""),$.tb.format(i,r)}}});_.Module.define({path:"common/widget/AudioPlayer",requires:[],sub:{defaultOptions:{src:"http://play.baidu.com/player/static/flash/fmp.swf"},isReady:false,isPlaying:false,isMute:false,volume:undefined,url:"",initial:function(c){var b=this;this.options=$.extend(this.defaultOptions,c);var e=$("<div></div>").css({width:1,height:1,overflow:"hidden"});e.appendTo("body");e.html(this.renderSwf(this.options.src));$swf=e.find("object");var a=$.browser.msie?$swf[0]:$swf.find("embed")[0];this.$container=e;this.$swf=$swf;this.swfObject=a;var d=setInterval(function(){if(b.swfObject.PercentLoaded()===100){clearInterval(d);setTimeout(function(){b.onSwfLoaded()},100)}},100);window.pl=this},onSwfLoaded:function(){this.isReady=true;this.bindEvents();this.trigger("playerloaded",this)},renderSwf:(function(){var a=['<object id="audio_player_core" width="#{width}" height="#{height}" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#4,0,0,0">','<param name="quality" value="high" />','<param name="allowscriptaccess" value="always">','<param name="scale" value="noscale">','<param name="wmode" value="window">','<param name="movie" value="#{srcWithStamp}">','<embed name="audio_player_core" width="#{width}" height="#{height}" allowscriptaccess="always" wmode="window" scale="noscale" src="#{srcWithStamp}" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">',"</object>"].join("");return function(b){return $.tb.format(a,{src:b,srcWithStamp:b,width:1,height:1})}}()),bindEvents:function(){this.bind("reset",this._reset,this);this.bind("load",this._load,this);this.bind("play",this._play,this);this.bind("pause",this._pause,this);this.bind("stop",this._stop,this);this.bind("setmute",this._setMute,this)},_reset:function(){this.stop();this.url="";this.isPlaying=false},_load:function(g,c,a,f){var b=this;this.url=c;this.swfObject.closeStream();this.swfObject.f_load(c);this.failHandler&&clearTimeout(this.failHandler);this.failHandler=setTimeout(function(){f&&f()},5000);this.checkLoadedHandler&&clearTimeout(this.checkLoadedHandler);function d(){var e=b._getLoadedPercent();if(e>0.3){b.trigger("songloaded",e);b.failHandler&&clearTimeout(b.failHandler);a&&a();return true}return false}this.checkLoadedHandler=setTimeout(function(){if(!d()){b.checkLoadedHandler=setTimeout(arguments.callee,50)}},50)},_play:function(h,d,b,a){var c=this;if(this.isPlaying){return}var f=this._getTotalTime();this.swfObject.f_play();this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler);function g(){var e=c._getCurrentPosition();b&&b({percent:e,totalTime:c._getTotalTime(),currentTime:c._getCurrentTime()});if(e==1){c.trigger("playfinish",e);a&&a();return true}return false}this.isPlaying=true;d&&d({totalTime:f});this.checkFinishedHandler=setTimeout(function(){if(!g()){c.checkFinishedHandler=setTimeout(arguments.callee,500)}},1000)},_pause:function(){if(!this.isPlaying){return}this.swfObject.f_pause();this.isPlaying=false},_stop:function(){this.swfObject.f_stop();this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler);this.isPlaying=false},_setMute:function(b,a){this.isMute=a;this.swfObject.setData("mute",a)},_setVolume:function(b,a){this.volume=a;this.swfObject.setData("volume",a)},_setCurrentPosition:function(a){},_getCurrentPosition:function(){return this.swfObject.getData("postionPct")},_getLoadedPercent:function(){return this.swfObject.getData("loadedPct")},_getTotalTime:function(){return this.swfObject.getData("length")},_getCurrentTime:function(){return this.swfObject.getData("currentPosition")}}});_.Module.define({path:"common/widget/Voice",requires:["common/widget/Card","common/widget/AudioPlayer"],sub:{version:"0.1",dialog:null,api:"/voice/index?",pidWhiteList:[40649447103,40649504943,40649558518,40649601183],initial:function(b){if(!PageData.pbVoiceLoaded){PageData.pbVoiceLoaded=true}else{return}var a=this;this.product=PageData.product;if(!this.product){return}this.api=(b&&b.api)||this.api;this.useMd5=b&&b.useMd5;this.canPlay=b&&b.canPlay;this.showClientAd=b&&b.showClientAd;this.showPostorAd=b&&b.showPostorAd;if(this.product==="frs"){this.showClientAd=this.canPlay==1?0:b.frsShowClientAd}$("body").on("click",".voice_player a ",function(c){c.preventDefault()});if(this.showPostorAd==1){this.initPostorAd()}this.initPlayer();$(window).bind("initvoicelength",function(i,h){var d=$(h);var g=d.find(".minute");var c=d.find(".second");if(g.length>0||(c.length>0&&c.text()>=30)){d.width(50+25*3)}else{if(c.length>0){var f=c.text();if(f<=5){d.width(50)}else{d.width(50+(f-5)*3)}}}});$(".voice_player .time").each(function(c){$(window).trigger("initvoicelength",this)});$("body").bind("showvoicedialog",function(d,c){if(a.dialog){a.dialog.show()}else{dialog=new $.dialog({width:398,html:$(".voice_client_ad_template").html(),title:"",draggable:false,show:false});dialog.element.addClass("voice_dialog");if(c){dialog.element.addClass("voice_dialog_post")}dialog.show();dialog.modal.bind("click",function(f){dialog.hide()})}})},initClientAd:function(){var a=this;$("body").on("click",".voice_player a",function(b){$("body").trigger("showvoicedialog")})},initPostorAd:function(){var a=this;$("#j_p_postlist").on("click",".j_lzl_p_sv",function(c){c.stopPropagation();var b=$(this);b.find(".new_icon").remove();$.tb.Storage.set("VoicePostorAdClosed",1);$.stats.track("lzl_poster","pc_voice");$("body").trigger("showvoicedialog",true)})},initPlayer:function(){var a=this;this.player=this.use("common/widget/AudioPlayer");this.player.bind("playerloaded",function(){a.bindPlayerEvent();a.player._setVolume("",100)})},bindPlayerEvent:function(){var c=this;var a=this.animateIcon;var d=this.player;var b=null;$("body").on("click",".voice_player a",function(q){q.preventDefault();$.stats.track("voice_btn_total","pc_voice");var v=$(this).parent(".voice_player");var n=v.find(".speaker");var h=v.find(".time");var j=v.hasClass("voice_player_mini");var k=j?"lzl":c.product;var l;var p;if(c.product==="pb"){l=PageData.thread&&PageData.thread.thread_id;p=j?v.parents(".j_lzl_s_p").getData().spid:v.parents(".l_post").getData().content.post_id}else{if(c.product=="frs"){l=v.parents(".j_thread_list").data("field").id}else{if(c.product=="index"){l=v.data("tid")}}}var f="";if(c.useMd5==1){f=c.api+"?voice_md5="+v.data("md5")+"&kw="+PageData.forum.forum_name+"&tbs="+PageData.tbs}else{f=c.api+"tid="+l+(p?("&pid="+p):"")}if(c.canPlay!=1&&$.inArray(p,c.pidWhiteList)==-1){if(b){d.trigger("stop");c.resetPrevPlayer(b)}$.stats.track("voice_dialog_show","pc_voice");$("body").trigger("showvoicedialog");return}if(v.data("state")==="playing"){d.trigger("stop");v.data("state","");a.reset(n);c.resetTime(h);$.stats.track("voice_stop","pc_voice")}else{c.resetPrevPlayer(b);d.trigger("stop");v.data("state","playing");a.set(n,"loading");$.stats.track("voice_play","pc_voice");var r=h.find(".minute");var o=h.find(".second");var i=r.length>0?+r.html():0;var w=o.length>0?+o.html():0;h.data("time",i*60000+w*1000);function g(e){if(e.totalTime>0&&!h.data("time")){if(e.totalTime!=0){h.data("time",e.totalTime)}}}function u(e){var m=(e.totalTime!=0?e.totalTime:h.data("time"))-e.currentTime;c.updateTime(h,m)}function t(e){v.data("state","");c.resetTime(h);a.reset(n)}d.trigger("load",f,function(){d.trigger("play",g,u,t);a.set(n,"playing")},function(){d.trigger("stop");v.data("state","");a.reset(n);c.resetTime(h);var e=$.tb.alert({title:"\u64ad\u653e\u5931\u8d25",message:"\u6211\u4e0d\u662f\u6545\u610f\u7684\uff0c\u64ad\u653e\u5931\u8d25\u4e86\uff0c\u8bf7\u518d\u8bd5\u4e00\u4e0b\u5427~",buttons:[{text:"\u786e\u8ba4"}],width:310});e.modal.bind("click",function(m){e.hide()})});b=v}})},updateTime:function(c,d){d=d||c.data("time")||0;var e=Math.floor(d/60000);var b=Math.round((d%60000)/1000);var a="";if(e>0){a+=('<span class="minute">'+e+"</span>'")}if(b>0||e>0){a+=('<span class="second">'+b+'</span>"')}c.html(a)},resetTime:function(a){this.updateTime(a)},resetPrevPlayer:function(b){if(!b){return}var a=b.find(".speaker");var c=b.find(".time");b.data("state","");this.resetTime(c);this.animateIcon.reset(a)},animateIcon:(function(){var b={normal:[-1,-20,-39,-58],mini:[1,-12,-25,-38]};var e={normal:20,mini:15};var a={playing:400,loading:100};var d={normal:{playing:-202,loading:-167},mini:{playing:-264,loading:-237}};var i=null;var h=null;function f(k,j){if($.browser.mozilla){var m=k.parent().parent().hasClass("loading")?"loading":"playing";var l=k.parent().parent().parent().hasClass("voice_player_mini")?"mini":"normal";var n=j+"px "+d[l][m]+"px";k.css("background-position",n)}else{k.css("background-position-x",j)}}function g(j,l){h&&c(h);c(j);h=j;j.parent().parent().addClass(l);var k=j.parent().parent().parent().hasClass("voice_player_mini")?"mini":"normal";if(l==="playing"){if(j.parent().parent().hasClass("voice_player_mini")){f(j,-38)}else{f(j,-58)}i=setTimeout(function(){var m=0;return function(){m=(m+1)%4;f(j,b[k][m]);i=setTimeout(arguments.callee,a[l])}}(),a[l])}else{if(l==="loading"){if(j.parent().parent().hasClass("voice_player_mini")){f(j,-1)}else{f(j,-1)}i=setTimeout(function(){var m=0;return function(){m=(m+1)%12;f(j,-1-m*e[k]);i=setTimeout(arguments.callee,a[l])}}(),a[l])}}}function c(j){clearTimeout(i);j.parent().parent().removeClass("loading playing");if(j.parent().parent().parent().hasClass("voice_player_mini")){f(j,-38)}else{f(j,-58)}}return{set:g,reset:c}}())}});_.Module.define({path:"encourage/widget/meizhi_vote",requires:["common/component/Card"],sub:{_visit_card:null,_vote_card:null,_visit_card_ajax:null,_vote_button:null,_visit_card_option:{width:280,height:237},_special_visit_card_option:{width:280,height:210},initial:function(){this._wrap=$("body"),this._is_meizhi=PageData.user.is_login&&PageData.user.meizhi_level>=0?!0:!1,this.bindEvents()},bindEvents:function(){var t=this;this._wrap.delegate(".j_meizhi_vip","mouseenter",function(){return t.buildVisitCard(this),!1}),this._wrap.delegate(".j_meizhi_vip","mouseleave",function(){return t._visit_card_ajax&&t._visit_card_ajax.abort(),t._visit_card&&t._visit_card.closeCard({type:"delayClose",time:200}),t._visit_card=null,!1}),this._wrap.delegate(".j_meizhi_vote","click",function(e){return t._vote_card&&(t._vote_card.closeCard(),t._vote_card=null,t._vote_button==e.target)?(e.preventDefault(),!1):(t.buildVoteCard(this),t._vote_button=e.target,e.preventDefault(),void 0)})},buildVoteCard:function(t){var e=this,i=$(t).getData(),a=i.user_id;$.ajax({type:"post",url:"/encourage/get/meizhi/panel",data:{user_id:a},dataType:"json"}).success(function(i){if(0==i.no){var o=i.data,n=e.buildVoteBtnGroup(o.can_vote,a,o.vote_count),s=$(t),_=s.offset().left-140+s.outerWidth(!0)/2,d=s.offset().top-64-12;e._vote_card&&(e._vote_card.closeCard(),e._vote_card=null),e._vote_card=e.use("common/component/Card",{content:n,card_css:{top:d,left:_,width:280,height:64},attr:"id='meizhi_vote_card'",wrap:$("body")}),e.bindVoteCardEvent()}})},bindVoteCardEvent:function(){var t=this;t._vote_card.showCard(),t._vote_card._j_card.delegate(".j_vote_button","click",function(){$.stats.track("frs_btn","meizhi_vote"),t.vote(this)})},vote:function(t){var e=this,i=$(t),a=i.getData(),o=a.vote_type,n="/encourage/post/meizhi/checkvcode",s="/encourage/post/meizhi/getvcode";_.Module.use("common/component/PostorServiceMeizhi",[],function(t){t.postHandler({data:{content:"",tbs:PageData.tbs,fid:PageData.forum.id||PageData.forum.forum_id,kw:PageData.forum.name,uid:a.user_id,scid:PageData.user.id||0,vtype:o,ie:"utf-8",vcode:""},checkUrl:n,vCodeUrl:s,url:"/encourage/post/meizhi/vote",type:"vote",success:function(t){var a=t,n=$('<img class="add_one_icon" src="/tb/static-encourage/img/meizhi/add_one.gif">');n.appendTo(i).animate({top:"-=20",opacity:0},1e3);var s=e.cutVoteCount(a.vote_count[o]);s=s?s:1,i.find(".j_vote_count").text(s);var _=i.parent();_.find(".j_vote_text").addClass("vote_text_small"),_.find(".j_vote_count").removeClass("hide"),_.siblings(".j_vote_tip").text("投票成功，对该用户每四小时只能投票一次。"),_.addClass("disabled").find(".j_vote_button").removeClass("j_vote_button"),1==a.hasCheckVcode&&e._msgDialog(),$.stats.track("vote_succ","meizhi_vote")}})})},_msgDialog:function(){var t={image:'<img style="border:none;" src="http://tb1.bdstatic.com/tb/img/messageFace.gif">',subMessage:"投票成功",message:"",dialogSet:{width:410,height:50,title:"发起投票"}},e='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: "宋体";"><table style="width:90%"><tbody><tr><td width="60">'+t.image+'</td><td valign="middle" style="font-size:20px;line-height:22px;font-family: "黑体";">'+t.subMessage+"</td></tr></tbody></table>"+t.message+"</div>";$.dialog.alert(e,t.dialogSet)},buildVisitCard:function(t){var e=this,i=$(t).parent().getData(),a=i.user_id;this._visit_card_ajax&&this._visit_card_ajax.abort(),this._visit_card_ajax=$.ajax({type:"post",url:"/encourage/get/meizhi/panel",data:{user_id:a,type:1},dataType:"json"}).success(function(i){if(0==i.no){var o=i.data,n=o.level-1?o.level-1:"",s=e.calPercent(o.vote_count),_="/i/sys/jump?un="+encodeURIComponent(o.uname)+"&ie=utf-8",d=o.group_info.has_group,v=d?'<span class="group_icon" title="快到裙里来">&nbsp;</span>':"",r=d?'<div class="clearfix"><span style="display:inline;float:left;">Ta的群组：</span><a class="group_name" href="/group/index?id='+o.group_info.group_id+'" target = "_blank" >'+o.group_info.group_name+"</a></div>":"",c=["<a href="+_+' title="头像" class="meizhi_avatar" target="_blank"><img src="'+o.avatar+'"></a>','<div class="meizhi_corner"></div>','<div class="meizhi_info">','<h1 class="clearfix"><a class="name" href='+_+' title="名字" target="_blank">'+o.uname+"</a>"+v+"</h1>",r,'<div>等级：<span class="level">MVP'+n+"</span></div>",'<div>所在吧：<span class="forum_name">'+o.forum_name+"吧</span></div>","</div>",'<p><a href = "/p/'+o.thread_id+'" target = "_blank" >看看Ta的认证贴>>></a></p>',"<p>已投票比例：</p>",'<div class="meizhi_vote_weight_wrap">','<span class="vote_weight_meizhi" style="width:'+s.meizhi_orign_percent+'%">'+s.meizhi_need_percent+"</span>",'<span class="vote_weight_weiniang" style="width:'+s.weiniang_orign_percent+'%;">'+s.weiniang_need_percent+"</span>",'<span class="vote_weight_renyao" style="width:'+s.renyao_orign_percent+'%;">'+s.renyao_need_percent+"</span>","</div>"].join(""),l=e._is_meizhi;l||(c+=o.can_vote?'<p class="j_vote_tip">投出无节操的真诚一票！</p>':"<p>投票成功，对该用户每四小时只能投票一次。</p>"),c+=e.buildVoteBtnGroup(o.can_vote,a,o.vote_count),c+=e.addTip(o,l);var u=$(t),p=l?e._special_visit_card_option:e._visit_card_option;e._visit_card&&(e._visit_card.closeCard(),e._visit_card=null),e._visit_card=e.use("common/component/Card",{content:c,card_css:{width:p.width,height:p.height},auto_positon:!0,event_target:u,attr:"id='meizhi_visit_card'",wrap:$("body")}),e.bindVisitCardEvent()}})},addTip:function(t,e){var i;return i=e?'<p class="level_up_tip"><span class="level_up_tip_title">完成度:</span>获得'+t.exp_value+"点经验、"+t.levelup_left+"张妹纸票后升级</p>":'<a class="meizhi_card_tip" href="http://tieba.baidu.com/tb/zt/meizhi/index.html" target="_blank">什么是妹纸认证系统>></a>'},calPercent:function(t){var e=t.meizhi+t.weiniang+t.renyao,i=Math.round(t.meizhi/e*100),a=Math.round(t.weiniang/e*100),o=100-i-a,n=10,s=i>n?i+"%":"",_=a>n?a+"%":"",d=o>n?o+"%":"";$.browser.msie&&$.browser.version<8&&(i>30?i-=1:a>30?a-=1:o>30&&(o-=1));var v={meizhi_orign_percent:i,weiniang_orign_percent:a,renyao_orign_percent:o,meizhi_need_percent:s,weiniang_need_percent:_,renyao_need_percent:d};return v},buildVoteBtnGroup:function(t,e,i){var a;if(this._is_meizhi)a=['<div class="meizhi_vote_button_wrap meizhi_disabled">','<div class="vote_button vote_button_meizhi">','<div class="vote_text vote_text_small">妹纸</div>','<div class="vote_count">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<span class="btn_split"></span>','<div class="vote_button vote_button_weiniang">','<div class="vote_text vote_text_small">伪娘</div>','<div class="vote_count">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<span class="btn_split"></span>','<div class="vote_button vote_button_renyao">','<div class="vote_text vote_text_small">人妖</div>','<div class="vote_count">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("");else if(t){var o={user_id:e,vote_type:"meizhi"},n={user_id:e,vote_type:"weiniang"},s={user_id:e,vote_type:"renyao"};a=['<div class="meizhi_vote_button_wrap">','<div class="j_vote_button vote_button vote_button_meizhi"'+$.tb.dataField(o)+">",'<div class="vote_text j_vote_text">妹纸</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<div class="j_vote_button vote_button vote_button_weiniang"'+$.tb.dataField(n)+">",'<div class="vote_text j_vote_text">伪娘</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<div class="j_vote_button vote_button vote_button_renyao"'+$.tb.dataField(s)+">",'<div class="vote_text j_vote_text">人妖</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("")}else a=['<div class="meizhi_vote_button_wrap disabled">','<div class="vote_button vote_button_meizhi">','<div class="vote_text vote_text_small">妹纸</div>','<div class="vote_count">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<div class="vote_button vote_button_weiniang">','<div class="vote_text vote_text_small">伪娘</div>','<div class="vote_count">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<div class="vote_button vote_button_renyao">','<div class="vote_text vote_text_small">人妖</div>','<div class="vote_count">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("");return a},cutVoteCount:function(t){return t>9999?"9999+":t},bindVisitCardEvent:function(){var t=this;this._visit_card.showCard({type:"delayShow",time:200}),this._visit_card._j_card.delegate(".j_vote_button","click",function(){$.stats.track("card_btn","meizhi_vote"),t.vote(this)})}}});
;var Thread_add_result={resultNo:0,fid:"",tid:"",vid:"",sign:"",bdauditreason:0,bdQueryWordEnc:"",autoMsg:"",is_login:0,init:function(e){if(Thread_add_result&&e.data&&"object"==typeof e.data)for(var a in e.data)Thread_add_result[a]=e.data[a];Thread_add_result.resultNo=e.no},isNeedWaitForCheck:function(){var e=!1;switch(this.resultNo){case 9:case 20:case 23:e=!0}return e},isNeedBindPhone:function(){return 4010==this.resultNo},Action_FocusTitle:"focusTitle",Action_FocusContent:"focusContent",Action_ClearYZM:"clearYZM",Action_FocusUrl:"focusUrl",Action_GoToHead:"goToHead",Action_FlushAndGoToHead:"flushAndGoToHead",getActionType:function(){var e="";switch(this.resultNo){case 10:case 14:case 501:case 15:case 36:case 41:case 42:case 43:case 46:case 9001:case 10010:case 10011:case 10012:case 10013:case 220012:case 220015:case 220035:case 2130001:case 2130007:case 2130008:case 2130009:case 2130011:case 2130012:case 2130014:case 2130005:e=this.Action_FocusContent;break;case 11:case 20:e=this.Action_FocusTitle;break;case 17:case 0:e=this.Action_FlushAndGoToHead;break;case 22:case 9:case 23:case 119:case 44:case 100:case 703:case 704:case 705:e=this.Action_GoToHead;break;case 38:case 39:case 40:e=this.Action_ClearYZM;break;case 1120:case 1121:e=this.Action_FocusUrl}return e},getMessage:function(){var e="",a=null;if(this.resultNo>=901&&this.resultNo<=950)return Thread_add_result.autoMsg;switch(null==a&&(a=PageData.forum?PageData.forum.id:null),null==a&&(a=PageData.forum_id),null==a&&(a=PageData.forumID),this.resultNo){case 10:e="贴子内容包含太少的文字";break;case 11:e="贴子标题和内容太长";break;case 12:e=null!=a?"操作失败，您的账号因违规操作而被封禁&nbsp;&nbsp;<a href='/pmc/main' target=\"_blank\">查看封禁信息</a>":"操作失败";break;case 13:e=null!=a?"操作失败，您的网络地址由于非法操作被封<br/><a href='/upc/userinfo?fid="+a+'\' target="_blank">查看封禁信息</a>':"您的网络地址由于非法操作被封 ";break;case 14:e="您发布的贴子已经存在";break;case 501:case 15:e="请不要发表含有不适当内容的留言<br>请不要发表广告贴";break;case 16:e="对不起，您所输入的贴吧不存在。由于系统升级维护，新建贴吧功能暂停，希望得到您的谅解！";break;case 19:case 200:case 201:case 202:e="您的用户名或者密码填写有误，请确认后再发表";break;case 20:e="您发表的贴子的标题或正文包含太少的文字，请修改后再发表";break;case 17:e="本吧当前只能浏览，不能发贴！";break;case 18:case 21:e="其他未知原因";break;case 22:e="您发表的贴子已经成功提交，由于特殊原因我们需要核实该贴内容是否含有不良信息，我们会在10分钟内确认，请您耐心等待！";break;case 9:e=this.getCheckMessage(this.bdauditreason);break;case 33:e=1==Thread_add_result.is_login?"您发贴太快了:) 请稍后再发":"您发贴速度太快了。为了减少恶意灌水和广告贴，系统对匿名发贴进行严格的控制，登录用户不受影响";break;case 34:e=1==Thread_add_result.is_login?"您说话太快了:) 请先停下来喝杯茶吧，或者可以去别的吧看看哦，一定会发现还有您感兴趣的话题":"您发贴速度太快了。为了减少恶意灌水和广告帖，系统对匿名发贴进行严格的控制，登录用户不受影响";break;case 220034:e="您说话太快了:) 请先停下来喝杯茶吧，或者可以去别的吧看看哦，一定会发现还有您感兴趣的话题";break;case 220035:e="亲，已@不少人了，以免打搅更多人，歇一会吧~";break;case 35:e=1==Thread_add_result.is_login?"亲，已@不少人了，以免打搅更多人，歇一会吧~":"您发贴速度太快了。为了减少恶意灌水和广告贴，系统对匿名发贴进行严格的控制，登录用户不受影响";break;case 36:e="请不要发广告贴！";break;case 37:e="您已尝试提交多次了，请返回后刷新页面，方可重新发贴";break;case 38:e="验证码超时，请重新输入";break;case 39:e="由于您多次输错验证码，请您返回后刷新页面，方可重新发贴";break;case 40:e="验证码输入错误，请您返回后重新输入";break;case 41:e="您的贴子可能包含不合适的内容，请您确定后再提交";break;case 42:e="您的发贴行为被系统认为有发广告嫌疑，请您稍后再发";break;case 43:e="您的发贴行为或贴子内容有广告或不合适的特征，请您确定后再发送";break;case 23:e="您的贴子已经成功提交，但需要系统审核通过后才能建立贴吧";break;case 119:e="对不起，本主题的回复数已经达到上限，感谢您的参与，欢迎您浏览本吧的其它主题";break;case 1120:e="抱歉，您输入的图片、视频链接地址错误，您可以点击<a href='http://www.baidu.com/search/post_img.html' target='_blank'>查看相关帮助</a>或返回修改";break;case 1121:e="抱歉，视频服务升级中，您暂时无法发表带有视频的贴子，给您带来的不便请原谅";break;case 44:e="对不起，本吧暂时限制部分用户发表主题贴子，您可以浏览或回复本吧其它内容，给您带来不便希望得到您的谅解。";break;case 100:e="对不起，本吧暂时限制部分用户使用完整的贴吧功能，您可以浏览本吧其它内容，给您带来不便希望得到您的谅解。";break;case 701:e="为了减少恶意灌水和广告帖，本吧不允许未登录用户发贴，登录用户不受影响，给您带来的不便深表歉意";break;case 702:e="为了减少恶意灌水和广告帖，本吧限制部分用户发贴，给您带来的不便深表歉意";break;case 703:e="为了减少恶意灌水和广告帖，本吧被设置为仅本吧会员才能发贴，给您带来的不便深表歉意。<a href='/f?kw="+this.bdQueryWordEnc+"#1' target=_blank>点此申请加入</a>本吧会员";break;case 704:e="为了减少恶意灌水和广告帖，本吧被设置为仅本吧管理团队才能发贴，给您带来的不便深表歉意";break;case 705:e="本吧当前只能浏览，不能发贴！";break;case 706:e="抱歉，本贴暂时无法回复。";break;case 45:e="抱歉，您提交的贴吧名称含特殊字符，目前无法创建，推荐您使用汉字、字母或数字作为贴吧名称";break;case 46:e="抱歉，您的贴子过长，无法正常提交。建议您精简或分段后重新提交，谢谢!";break;case 800:break;case 801:break;case 802:break;case 803:break;case 804:break;case 805:break;case 806:break;case 807:break;case 808:break;case 809:break;case 814:break;case 815:e="抱歉，您已退出登录或未购买音乐道具，请刷新页面重试";break;case 900:e="为抵御挖坟危害，本吧吧主已放出贴吧神兽--超级静止蛙，本贴暂时无法回复。";break;case 961:e="发贴失败，您输入的图片地址有错误，请检查更正后再次发布：）";break;case 9001:e="由于匿名状态或本吧设置，无法发表带有图片的主题。";break;case 2100:e="内容含有高级字体效果，保持连续签到就能使用哦~~";break;case 4010:e="您的账号存在安全风险暂不能发贴，请先进行手机绑定后再发贴吧。";break;case 9e3:e="您还没有用户名，不能在本吧发贴。请先填写用户名。";break;case 10010:e="您的性别无法进行妹纸认证</br><a style = 'font-size:12px;' href = 'http://www.baidu.com/p/setting/profile/basic' target ='_blank'>去修改我的性别>><a>";break;case 10012:e="请上传至少一张图片。";break;case 10013:e="您发往的吧未开通妹纸认证功能。";break;case 2130001:e="请不要给非妹纸用户投票。";break;case 2130007:e="您的账号已被封禁。";break;case 2130008:e="您已经给该用户投过票。";break;case 2130009:e="投票失败。";break;case 2130005:e="您已经发起过妹纸认证贴</br><a href='/p/"+Thread_add_result.thread_id+"' target = '_blank' >http://tieba.baidu.com/p/"+Thread_add_result.thread_id+"</a>";break;case 2130011:e="妹纸认证用户之间不能相互投票。";break;case 220012:e="您的账号已被封禁。";break;case 220013:e="您的IP已被封禁。";break;case 225001:e="您的账号禁止贴条。";break;case 220015:e="您输入的内容含有敏感信息。";break;case 219e4:e="<p>抱歉您没有贴条道具了不能发布贴条信息。</p><p>PS：发贴,回贴,参加活动都有机会获得贴条道具。</p>";break;case 2130012:e="不能给自己投票。";break;case 2130014:e="不能给男性用户投票";break;case 2190001:e="您说话太快啦，请休息一下。";break;case 2190002:e="抱歉，每10分钟只能抢一次贴条。";break;case 2190003:e="<p>真遗憾~您没有抢到贴条道具。</p><p>PS：等级越高获得道具几率越高哦！</p>";break;case 2190004:e="服务器忙，请稍后重试";break;case 2190005:e="您的账号已被封禁。";break;case 2190006:e="贴条内容不能为空。";break;case 2190007:e="贴条内容过长。";break;case 2190008:e="今天的道具被抢完啦，明天继续加油！";break;default:e="未知错误。"}return e},getCheckMessage:function(e){var a="";switch(e){case-61:a="您的贴子已经成功提交，但为了保证贴子质量，本吧所发的贴子待系统审核通过后才能显示，请您耐心等待";break;case-62:a="您的贴子已经成功提交，但为了保证贴子质量，本吧贴图的贴子需要审核通过后才能显示，请您耐心等待";break;case-74:case-75:case-60:a="您发表的贴子已经成功提交，但系统需要核实该贴子内容是否含有不良信息，贴子在审核通过后才能显示，请您耐心等待";break;case-70:a="您的贴子已经成功提交，但为了控制广告贴，需要通过审核后才能发布。登陆署名发贴不受此限制。";break;case-71:a="您发表的帖子太长了。为了防止灌水，需系统审核后才能显示，请稍后查看";break;default:a="您发表的贴子已经成功提交，但系统需要核实该贴子内容是否含有不良信息，贴子在审核通过后才能显示，请您耐心等待"}return a}};_.Module.define({path:"encourage/widget/WelfareIcon",sub:{_card:null,_isGifing:!1,initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var t=this;this._wrap.on("mouseenter",".j_score_welfare",function(){t._buildCard(this)}).on("mouseleave",".j_score_welfare",function(){return t._card&&t._card.closeCard({type:"delayClose",time:200}),t._card=null,!1}).on("click",".j_score_welfare",function(e){return t.showGif(e),!1})},showGif:function(t){var e=$("<div></div>"),i=this,o="http://tb1.bdstatic.com/tb/r/image/2014-04-11/968642070f6c20e5274ba44b5a75707f.gif",n=$('<img style="position:absolute;z-index: 50000; left: 80px; top: 80px;width:1px;height: 1px;" src="">');this._isGifing||(this._isGifing=!0,e.css({position:"absolute",zIndex:5e4,left:t.pageX-80,top:t.pageY-80}),e.append(n),$("body").append(e),setTimeout(function(){n.tbattr("src",o)},0),n.animate({width:190,height:134,top:0,left:0},300),setTimeout(function(){n.animate({width:1,height:1,top:80,left:80},300,function(){e.remove(),i._isGifing=!1})},3e3))},_buildCard:function(t){var e,i=['<div style="text-align: center">','<p style="font-weight: bold;">【福利印记】</p>',"<p>有效期：2014年12月31日</p></div>"].join(""),o=['<div style="text-align: center">','<p style="font-weight: bold;">【福利印记】</p>',"<p>发福利有机会获得！</p>",'<p style="color:#fc6853">点我！</p></div>'].join(""),n=$(t),s=n.getData();if(s){e=s.user_id!==PageData.user.user_id?o:i;var a=n.offset().left-86+n.outerWidth(!0)/2,d=n.offset().top-64-12;this._card=this.use("common/widget/Card",{content:e,card_css:{top:d,left:a,width:172},auto_positon:!0,event_target:n,wrap:$("body")}),this._card.showCard({type:"delayShow",time:200})}}}});_.Module.define({path:"encourage/widget/achieveCard",requires:["common/component/Card"],sub:{initial:function(){this._wrap=$("body"),this._bindEvent()},_bindEvent:function(){var e=this;this._wrap.on("mouseenter",".j_fighter",function(a){var t=$(a.target),n=t.getData();$.post("/tbmall/gthread/iconbanner",{tbs:PageData.tbs,user_id:n.user_id},function(a){var n=t.offset();if(0===a.no){var i='<div class="achievement_card">    <p class="achievement_card_content">       <img class="achievement_card_img" src="http://tb.himg.baidu.com/sys/portrait/item/'+a.data.portrait+'" alt="" height=66 width=66 />        <span class="achievement_card_uname">'+a.data.user_name+'</span><i class="achievement_card_icon"></i></br>        <span class="achievement_card_medal">首届拳王争霸赛 - '+a.data.icon_name+' </span></br>    </p><a class="achievement_card_link" href="/tbmall/gthread/center" target="_blank">首届贴吧拳王争霸赛>></a></div>';e._medalCard=e.use("common/component/Card",{content:i,card_css:{width:265,"z-index":1e3,top:n.top-117-12,left:n.left-126,card_leave_display:!0},wrap:$("body"),attr:"id='achieve_icon_card'"}),e._medalCard.showCard({type:"delayShow",time:200})}})}).on("mouseleave",".j_fighter",function(a){a.preventDefault(),e._medalCard&&e._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_fighter",function(e){e.preventDefault()})}}});_.Module.define({path:"fanclub/widget/fancard",requires:["common/widget/Card"],sub:{_fancard:null,_fancard_ajax:null,_fancard_data:{},_forum_id:"0",initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var a=this;this._wrap.delegate(".j_fanclub_vip","mouseenter",function(){return $(this).tbattr("title",""),a._getCardData(this),!1}),this._wrap.delegate(".j_fanclub_vip","mouseleave",function(){return a._fancard_ajax&&a._fancard_ajax.abort(),a._fancard&&a._fancard.closeCard({type:"delayClose",time:200}),a._fancard=null,!1})},_getCardData:function(a){var t=$(a).getData();if(t){var n=t.user_id,r=this;this._fancard_ajax=$.ajax({type:"GET",url:"/frsstar/browse/fanclub/fanInfo?userid="+n,dataType:"json",success:function(t){switch(t.no){case 0:r._fancard_data=t,r._buildCard(a)}},error:function(){$(a).tbattr("title","网络错误")}})}},_buildCard:function(a){var t="",n=this._fancard_data.fanclub_array.length;n>3&&(n=3);for(var r=0;n>r;r++)0==r&&(this._forum_id=this._fancard_data.fanclub_array[r].forum_id),t+='<a  target="_blank"  href="/f?kw='+encodeURIComponent(this._fancard_data.fanclub_array[r].name)+'&ie=utf-8" class="fanclub_card_forum_name">'+this._fancard_data.fanclub_array[r].name+' <span class="fanclub_icon fanclub_icon_vip_'+this._fancard_data.fanclub_array[r].level+'"></span></a>',n-1>r&&(t+='<a class="fanclub_card_forum_name_gap">|</a>');var e=['<div id="fanclub_card_container">','<div class="fanclub_card_head">','<a  target="_blank"  href="/i/sys/jump?un='+encodeURIComponent(this._fancard_data.username)+'&ie=utf-8"  ><img src="http://tb.himg.baidu.com/sys/portrait/item/'+this._fancard_data.portrait+'" alt="" /></a>',"</div>",'<div class="fanclub_card_right">','<a target="_blank" href="/i/sys/jump?un='+encodeURIComponent(this._fancard_data.username)+'&ie=utf-8" class="fanclub_card_right_title">'+this._fancard_data.username+'<span class="fanclub_icon fanclub_icon_frs "></span></a>',"<p>加入会员时间:<span>"+this._formatDate(this._fancard_data.entertime)+"</span></p>","<p>已加入粉丝会:<span>"+this._fancard_data.fanclub_count+"个</span></p>","</div>",'<div class="fanclub_card_forum_icon_wrapper" >',t,"</div>",'<div class="fanclub_card_bottom">','<a  target="_blank"  href="http://tieba.baidu.com/p/2676282434">什么是粉丝会员&gt;&gt;</a>',"</div>","</div>"].join(""),_=$(a),i=_.offset().left-140+_.outerWidth(!0)/2,d=_.offset().top-64-12;this._fancard=this.use("common/widget/Card",{content:e,card_css:{top:d,left:i,width:302,height:147},auto_positon:!0,event_target:_,attr:"id='fancard_show'",wrap:$("body")}),this._fancard.showCard({type:"delayShow",time:200})},_buildErrorCard:function(){},_formatDate:function(a){var t=new Date(1e3*a);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}});_.Module.define({path:"common/widget/ten_years",sub:{_srcs:{common:PageUnit.load("ten_years_img_blue_src"),hover:PageUnit.load("ten_years_img_red_src"),close:PageUnit.load("ten_years_img_close_src")},_urls:{common:PageUnit.load("ten_years_img_url")},_isclosed:!1,_product:"",initial:function(e){var s=$.cookie("ten_years");this._product=e,s||PageData&&PageData.forum&&PageData.forum.forum_name&&"贴吧10周年"==PageData.forum.forum_name||(this._buildDialogHTML(),document.body.clientWidth>1024&&this._srcs.common&&this._srcs.hover&&this._srcs.close&&this._urls.common?$("#j_ten_years").show():$("#j_ten_years").hide())},_initEvents:function(e,s,t){var n=this;$(window).resize(function(){document.body.clientWidth>1024&&n._srcs.common&&n._srcs.hover&&n._srcs.close&&n._urls.common?$("#j_ten_years").show():$("#j_ten_years").hide()}),$("#j_ten_years").delegate(".close_btn","click",function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,$.cookie("ten_years","true",{expires:1,path:"/"}),$("#j_ten_years").hide(),!1}),$("#j_ten_years").find(".ten_years").mouseover(function(){$(this).tbprop("src",t)}).mouseout(function(){$(this).tbprop("src",s)}).click(function(){$.stats.sendRequest("ev_type=click&st_mod=button&st_type=ten_years")})},_buildDialogHTML:function(){var e=this._srcs.common,s=this._srcs.hover,t=this._srcs.close,n=this._urls.common,o=[];o.push('<div id="j_ten_years">'),o.push('<img src="'+t+'" alt="close" class="close_btn"/>'),o.push('<div class="tenYearsWrap">'),o.push('<a href="'+n+'" target="_blank" ><img src="'+e+'" alt="red" class="ten_years"/></a>'),o.push("</div></div>"),$("body").append(o.join("")),this._initEvents(n,e,s)}}});_.Module.define({path:"common/widget/EditorPicMeizhi",requires:["common/widget/EditorPicMeizhi/EditorPicMeizhiUpload"],sub:{tempHTML:['<div id="meizhi_img_layer" class="img_layer_content j_content ui_card_wrap hide"><ul class="mz_ul clearfix"><li class="mz_imgUpload_btn" ><a class="mz_uploader_container" href="#" onclick="return false;" ></a><span class="cut_line"></span></li><li class="mz_album_btn"><a class="mz_btn_myalbum" href="#" onclick="return false;"></a><span class="cut_line"></span></li><li class="mz_camera_btn"><a class="mz_btn_camera" href="#" onclick="return false;" ></a></li></ul><span class="ui_white_down arrow"></span></div>'].join(""),count:0,imageLimite:20,initial:function(a){},init:function(a,c){var b=this;b.editor=c;var d=b.getLimitNum();a.before(this.tempHTML);b.j_content=a.siblings(".j_content");b.picUploader=this.use("common/widget/EditorPicMeizhi/EditorPicMeizhiUpload",b.j_content.find(".mz_uploader_container"),c);b.myAlbumHandler(c);b.myCameraHandler(c);b.addImageArray={}},myAlbumHandler:function(b){var a=this;var c=a.j_content.find(".mz_album_btn");c.click(function(){if(a.editorAlbum){a.editorAlbum.run()}else{a.editorAlbum=a.use("common/widget/EditorPicMeizhi/EditorPicMeizhiAlbum",b);a.editorAlbum.run()}})},myCameraHandler:function(b){var a=this;var c=a.j_content.find(".mz_camera_btn");c.click(function(){if(a.editorCamera){a.editorCamera.run()}else{a.editorCamera=a.use("common/widget/EditorPicMeizhi/EditorPicMeizhiCamera",b);a.editorCamera.run()}})},getLimitNum:function(){var a=this;var b=a.editor.config.imageLimite||100,c=b-a.editor.getImageNum();return c},showMaxImage:function(){var a=this;var b=a.editor.config.imageLimite||100,c=b-a.editor.getImageNum();c=Math.max(0,c);a.j_tip.find(".j_image_num").html(c)}}});;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiAlbum",requires:["common/widget/ScrollPanel"],extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{GET_ALBUM_URL:"/photo/interface/alblist",initial:function(b){var a=this;a.editor=b},run:function(){this.selectedPic={};this.albumList={};this.curAlbumId=null;this.myAlbumLayer();this.getAlbumList()},layerHeight:451,layerWidth:683,selectedPic:{},albumList:{},curAlbumId:null,errorHandler:function(b){var a=this;switch(b){case"noalbum":return $('<div class="album_error">\u4e0a\u4f20\u56fe\u7247\u5230\u767e\u5ea6\u76f8\u518c\uff0c\u53d1\u8d34\u914d\u56fe\u968f\u9009\u968f\u7528\uff0c\u65b9\u4fbf\u5feb\u6377\uff01<a href="http://xiangce.baidu.com/home" target="_blank" class="create_album">\u7acb\u5373\u4e0a\u4f20</a></div>');break;case"creatAlbum":return $('<div class="album_error">\u5f00\u901a\u767e\u5ea6\u76f8\u518c\uff0c\u53ef\u4ee5\u53d1\u8d34\u65f6\u76f4\u63a5\u63d2\u5165\u56fe\u7247\uff0c\u65b9\u4fbf\u5feb\u6377~<a href="http://xiangce.baidu.com/home" target="_blank" class="create_album">\u7acb\u5373\u5f00\u901a</a></div>');break;case"login":return $("<div class=\"album_error\">\u60a8\u5df2\u9000\u51fa\u767b\u5f55\u72b6\u6001\uff0c\u8bf7\u91cd\u65b0<a href=\"#\" onclick=\"_.Module.use('common/widget/LoginDialog', ['', '']);\">\u767b\u5f55</a></div>");break;case"systemError":var c=$('<div class="album_error">\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7<a href="#" >\u5237\u65b0</a>\u91cd\u8bd5</div>');c.find("a").click(function(){a.getAlbumList()});return c;break;case"noImage":return'<div class="album_error">\u8be5\u76f8\u518c\u6ca1\u6709\u56fe\u7247\uff0c\u8bf7\u9009\u62e9\u5176\u4ed6\u76f8\u518c\u8bd5\u8bd5~</div>';break}},renderAlbumList:function(f,e){var a=this;var b='<div class="l_album_list"><select class="l_album_select" onmousewheel="event.returnValue=false;return false;" >';for(i=0;i<f;i++){album=e[i];b+="<option "+(album==a.curAlbumId?'selected="selected"':"")+' value="'+album.id+'">';b+=album.name+"</option>";a.albumList[album.id]=album.pic_num}var c=a.getImageLimit(a.albumContainer.find(".l_album_selected_con"));b+='</select>\u8fd8\u53ef\u4ee5\u9009\u4e2d<span class="j_image_num" id="album_max">'+c+"</span>\u5f20</div>";var d=$(b);d.find(".l_album_select").change(function(){a.getPicByUrl($(this).val())});return d},renderAlbumPic:function(d,a){var c=this,e=$('<div class="l_album_pics" ></div>'),b=c.getImgEles(d,1,50);a.append(e);c.l_album_pics=e;a.click(function(f){if(f.stopPropagation){f.stopPropagation()}else{f.cancelBubble=true}});$.JsLoadManager.use("/tb/static-common/lib/jquery-ui-1.10.0.draggable.min.js?v=130307102247",function(){if($.browser.msie&&$.browser.version<8){c.l_album_pics.html(b)}else{c.scrollPanel=c.use("common/widget/ScrollPanel",{container:e,height:350,content:b});c.rightScrollPanel=c.use("common/widget/ScrollPanel",{container:c.albumContainer.find(".l_album_selected_con"),height:350,content:""})}e.delegate(".j_prepage","click",function(){c.getPicByUrl(c.curAlbumId,c.cur_page-1);return false});e.delegate(".j_nextpage","click",function(){c.getPicByUrl(c.curAlbumId,c.cur_page+1);return false});e.delegate(".l_album_small_pics","click",function(){c.selectImage(this);return false});e.delegate(".l_album_small_pics","mouseenter",function(){$(this).addClass("l_hover");return false});e.delegate(".l_album_small_pics","mouseleave",function(){$(this).removeClass("l_hover");return false});c.reloadImage()});return e},reloadImage:function(){var a=this;this.l_album_pics.find(".l_album_pic").each(function(){var c=$(this),b=this,d=c.data("src");c.load(function(){a.resetImg(this,120,120)}).tbattr("src",d)})},addSelected:function(c,d){var b=this,a=$('<a class="i_item_con complete" data-url="'+c+'"><img src="'+d+'"  onload="resizePic_temp(this,84,84)" /></a>');if($.browser.msie&&$.browser.version<8){b.albumContainer.find(".l_album_selected_con").append(a)}else{b.rightScrollPanel.appendContent(a)}return a},removeSelected:function(a){},selectImage:function(d){var a=this;if(d.tagName=="IMG"){d=$(d).parent()}else{d=$(d)}var b=d.tbattr("data-url"),e=d.tbattr("data-surl");this.errDom=$(".i_error_tips");this.errDom.text("");if(!d.hasClass("selected")){var c=a.getImageLimit(a.albumContainer.find(".l_album_selected_con"));if(c<=0){return}if(b.match("priv.hiphotos.baidu.com")){this.errDom.text("\u60a8\u7684\u79c1\u6709\u7167\u7247\u65e0\u6cd5\u5728\u8d34\u5b50\u4e2d\u663e\u793a\uff0c\u8bf7\u4f7f\u7528\u5176\u4ed6\u7167\u7247\u3002");return}d.addClass("selected");a.selectedPic[b]=a.addSelected(b,e)}else{d.removeClass("selected");a.selectedPic[b].remove();delete a.selectedPic[b]}a.updateRemianImage(a.albumContainer)},getAlbumList:function(){var a=this;$.get(a.GET_ALBUM_URL,{_t:(new Date().getTime())},function(k,h){var b=a.albumContainer.find(".l_album_lwrapper");k=$.parseJSON(k);if(k.no=="0"){var j,g=k.data.defalut_album,d=k.data.album_list,l=d.length,c=g.pic_list,m=c.length,e;a.curAlbumId=g.id;if(l==0){j=a.errorHandler("noalbum");b.html(j)}else{var f='<span style="float:right;margin-top:4px">\u624b\u673a\u76f8\u518c\uff0c\u53d1\u8d34\u5fc5\u5907\uff0c<a target="_blank" onclick="sendAlbumRequest()" href="http://xiangce.baidu.com/app/tiebahelp.html">\u7acb\u5373\u4f53\u9a8c</a></span>';b.append(a.renderAlbumList(l,d));a.renderAlbumPic(c,b)}}else{if(k.no=="4049"){var j=a.errorHandler("creatAlbum");b.html(j)}else{if(k.no=="265"){var j=a.errorHandler("login");b.html(j)}else{var j=a.errorHandler("systemError");b.html(j)}}}})},getPicByUrl:function(a,c){var b=this;b.curAlbumId=a;$.get("/photo/interface/piclist",{album_id:a,pn:c,_t:(new Date().getTime())},function(f,d){f=$.parseJSON(f);if(f.no==0){var e=f.data;if($.browser.msie&&$.browser.version<8){b.l_album_pics.html(b.getImgEles(e.pic_list,e.cur_page,e.page_size))}else{b.scrollPanel.setContent(b.getImgEles(e.pic_list,e.cur_page,e.page_size));b.scrollPanel.scrollTopTo(0)}b.reloadImage()}else{b.l_album_pics.html(b.errorHandler("systemError"))}})},getImgEles:function(h,b,g){var d,f="",k=h.length,g=g||50,a,j=this;j.curPagePicNum=k;j.cur_page=b||1;if(k==0){f=this.errorHandler("noImage")}else{f+="<div class='l_album_pics_container'>";for(d=0;d<k;d++){a=this.selectedPic[h[d].big_pic]?"selected":"";f+='<a href="#" onclick="return false" class="l_album_small_pics '+a+'" data-surl="'+h[d].small_pic+'" data-url="'+h[d].big_pic+'"><span class="l_album_pic_hover"></span><span class="l_album_pic_select" title="\u5df2\u9009\u4e2d"></span><img class="l_album_pic" data-src="'+h[d].small_pic+'"/></a>'}f+="</div>";var c=this.albumList[this.curAlbumId];var e=((c-1)/g|0)+1;if(e!=1){f+='<div class="l_album_pic_pager">';if(b!=1){f+='<a href="#"  class="l_album_page j_prepage" >&lt;\u4e0a\u4e00\u9875</a>'}if(b<e){f+='<a href="#"  class="l_album_page j_nextpage" >\u4e0b\u4e00\u9875&gt;</a>'}f+="</div>"}}return f},myAlbumLayer:function(){var c=this;if(c.lDialogOp){return}var a=$("<div></div>");var e=$('<div class="l_album_container"></div>'),b='<div class="l_album_lwrapper"></div><div class="l_album_rwrapper"><div class="l_album_rwrapper_title">\u5f53\u524d\u9009\u4e2d</div><div class="l_album_selected_con"></div></div>';c.albumContainer=e;e.html(b);a.append(e).append(c.layerBottom("showtips"));var d=c.layerWidth;var f={html:a,title:"\u6211\u7684\u76f8\u518c",width:d,height:c.layerHeight,closeable:true};if($.browser.msie&&$.browser.version<7){a.closest(".dialogJcontent").css({padding:"9px 0px 9px 9px;"})}c.editor.overlay.hide();c.lDialogOp=new $.dialog(f);c.lDialogOp.bind("onclose",function(){c.editor.overlay.show();delete (c.lDialogOp)});c.lDialogOp.show()},submit:function(){var a=this;var c=[];for(var b in this.selectedPic){c.push({url:b,pic_id_encode:a.getEncode(b)})}this.editor.insertImage(c);this.lDialogOp.close();this.editor.overlay.show()}}});;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiUpload",requires:["common/widget/image_uploader_manager","common/widget/ScrollPanel","common/component/image_flash_editor"],extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{picItemPath:"http://imgsrc.baidu.com/forum/pic/item/",abpicPath:"http://imgsrc.baidu.com/forum/abpic/item/",layerHeight:460,layerWidth:680,initial:function(a,c){var b=this;b.editor=c;b.j_con=a;b.uploader=b.localUploader(a);b.addImageArray={};Function.prototype.BINDEVENT=function(d){var e=this;return function(){e.apply(d,arguments)}}},localUploader:function(b){var a=this;var c=this.use("common/widget/image_uploader_manager",{container:b,width:b.width(),height:b.height(),queueLen:100,fid:PageData.forum.forum_id||PageData.forum.id,isAutoUp:false});c.bind("onFileSelected",function(m,l){var e=a.dealWithData(l.imageList);var n=e.filterId;for(var g=0,k=n.length;g<k;g++){c.deleteFile(n[g])}var o=a.getImageLimit(a.imageContainer),h=e.imageList.length,d=h-n.length;if(d>o){for(var f=o;f<h;f++){c.deleteFile(e.imageList[f].id)}e.imageList=e.imageList.splice(0,o)}c.startUpload();a.startRender(e.imageList,"upload")});c.bind("onProgressListen",function(d,e){a.progressHandler(e)});c.bind("onComplete",function(d,e){a.uploadComplete(e)});c.bind("onError",function(e,d){});return c},imageHandler:function(d,h){var g=d.id,f=h.filter('[data-id="'+g+'"]'),c=f.find("b"),a=d.response,e=d.percent,b=this;if(f.hasClass("complete")){return}c.css({width:e+"%"});if(e==100){b.renderItem(a,f)}},renderItem:function(m,j){var k=this;var l=j.find("b");if(m!=null&&m.error_code==0){var e=m.info.pic_id_encode,a=m.info.fullpic_width,i=m.info.fullpic_height,d=m.info.pic_water,b=j.find("img")[0];b.src="/tb/static-common/editor_img/layer/i.gif";var f=a,c=i;if(a<200||i<200){k.errorBigHandler(j.find("img"));l.parent().hide();return false}j.removeClass("uploading").addClass("complete");j.tbattr("data-url",k.picItemPath+e+".jpg");j.tbattr("href","#");j.tbattr("data-water-url",d);j.tbattr("data-width",a);j.tbattr("data-height",i);j.tbattr("data-id-encode",e);new Image().src=k.picItemPath+e+".jpg";var g=new Image();g.onload=function(){b.style.backgroundImage="url("+k.abpicPath+e+".jpg)";l.parent().hide()};g.src=k.abpicPath+e+".jpg";if(d){new Image().src=d}}else{k.errorHandler(j.find("img"));l.parent().hide()}},errorHandler:function(b){b.tbattr("src","/tb/static-common/editor_img/layer/upload_fail.png");var a=b.parent();a.removeClass("uploading").addClass("i_up_error")},errorBigHandler:function(b){b.tbattr("src","/tb/static-common/editor_img/layer/upload_fail.png");var a=b.parent();a.removeClass("uploading").addClass("i_up_error_big")},addImageArray:{},dealWithData:function(e){var j=[],k=[],c=this.addImageArray;for(var f=0,g=e.length;f<g;f++){var h=e[f],d=h.id,b=h.name,l=h.size,a=b+l;if(c[a]==a){k.push(d)}else{j.push(h);c[a]=a}}return{imageList:j,filterId:k}},renderContinueUpload:function(){var c=this.getImageLimit(this.imageContainer),b="";if(c==0){b="i_upload_limit"}var a='<a class="i_continue_add '+b+'"><div class="i_continue_upbtn"></div><span class="i_image_remain">\u8fd8\u53ef\u4ee5\u6dfb\u52a0<span class="j_image_num">'+c+"</span>\u5f20</span></a>";return a},addDragger:function(){},startRender:function(c,h){var j=this;var e=c;if(j.lDialogOp){if(e.length>0){var f=j.genericImageCon(e,"continue");j.continueUploader.before(f);if($.browser.msie&&$.browser.version<8){}else{j.scrollPanel._resizeHeight();j.scrollPanel.scrollTopTo(20000);j.updateRemianImage(j.container,function(){j.continueUploader.addClass("i_upload_limit")},function(){j.continueUploader.removeClass("i_upload_limit")});j.addDragger()}}return}var i=$('<div class="l_image_container clearfix"></div>');j.imageContainer=i;j.imageContainer.css({width:667});var d=$('<div class="l_image_upcontainer"></div>');var f=j.genericImageCon(e,"first");j.imageContainer.delegate(".close","click",function(){var n=$(this).parent(),k=n.tbattr("data-name"),l=n.tbattr("data-size"),o=n.tbattr("data-id"),m=n.tbattr("data-uptype");if(m=="first"){j.uploader.deleteFile(o)}else{if(m=="continue"){j.conUploader.deleteFile(o)}}delete (j.addImageArray[k+l]);n.remove();j.updateRemianImage(j.container,function(){j.continueUploader.addClass("i_upload_limit")},function(){j.continueUploader.removeClass("i_upload_limit")})});j._layerBottom=j.layerBottom("upload");d.append(j.imageContainer).append(j._layerBottom);var b=j.layerWidth;var a={html:d,holderClassName:"meizhi_uploader",title:"\u63d2\u5165\u56fe\u7247",width:b,height:j.layerHeight,show:false,closeable:true};j.editor.overlay.width(1);j.editor.overlay.height(1);j.lDialogOp=new $.dialog(a);j.lDialogOp.bind("onclose",function(){j.uploader&&j.uploader.stopUpload();j.uploader&&j.uploader.clearList();try{j.conUploader&&j.conUploader.stopUpload();j.conUploader&&j.conUploader.clearList()}catch(k){}j.destroyJquery(j.imageContainer);window.PicUploaderShow=false;j.editor.overlay.width(680);j.editor.overlay.height(460);delete (j.lDialogOp)});d.closest(".dialogJcontent").css("padding","0");window.PicUploaderShow=true;if(j.uploader.uploader.flash){var g=j.lDialogOp.element;j.lDialogOp.element=j.lDialogOp.element.add(j.uploader.uploader.flash.parentNode);j.lDialogOp.show();j.lDialogOp.element=g}else{j.lDialogOp.show()}j.container=d;if($.browser.msie&&$.browser.version<8){j.imageContainer.html(f);j.imageContainer.append(j.renderContinueUpload());j.continueUploader=j.imageContainer.find(".i_continue_add");j.addContinueUploader()}else{$.JsLoadManager.use("/tb/static-common/lib/jquery-ui-1.10.0.draggable.min.js?v=130307102247",function(){j.scrollPanel=j.use("common/widget/ScrollPanel",{container:j.imageContainer,height:388,content:f});j.scrollPanel.appendContent(j.renderContinueUpload());j.continueUploader=j.imageContainer.find(".i_continue_add");j.addDragger();j.addContinueUploader()})}j.initPictureEditor()},initPictureEditor:function(){var a=this;a.$pictureEditorContainer=$("<div class='pic_editor_container' id='picture_editor_container'></div>");a.container.append(a.$pictureEditorContainer);this.pictureEditor=this.use("common/component/image_flash_editor",{container:a.$pictureEditorContainer,width:678,height:461},{uploadURL:"http://upload.tieba.baidu.com/upload/pic?tbs=4f165305af36ccdc013751701760125500_1&fid="+PageData.forum.forum_id||PageData.forum.id});this.imageContainer.delegate(".j_editor_button","click",function(){var b=$(this).closest(".i_item_con");a.showPictureEditor(b)});this.pictureEditor.bind("upload_complete",function(b,c){a.hidePictureEditor();a.renderItem(c,a.pictureEditor.$item)});this.pictureEditor.bind("cancel",function(){a.hidePictureEditor()})},showPictureEditor:function(a){this.pictureEditorOpen=true;this.lDialogOp.setTitle("\u56fe\u7247\u7f16\u8f91");this.pictureEditor.$item=a;this.pictureEditor.loadRemoteImage(a.tbattr("data-url"));this.$pictureEditorContainer.animate({left:-1},500)},hidePictureEditor:function(){this.pictureEditorOpen=false;this.lDialogOp.setTitle("\u63d2\u5165\u56fe\u7247");this.$pictureEditorContainer.animate({left:684},500)},addContinueUploader:function(){var a=this;a.conUploader=a.localUploader(a.continueUploader.find(".i_continue_upbtn"))},uploadComplete:function(f){var b=this,e=f.imageList,g=b.imageContainer.find(".i_item_con");for(var d=0,a=e.length;d<a;d++){var c=e[d];b.imageHandler(c,g)}},progressHandler:function(d){var b=this,f=d.imageList,g=b.imageContainer.find(".i_item_con");for(var e=0,a=f.length;e<a;e++){var c=f[e];b.imageHandler(c,g)}},submit:function(){var a=this;var c=a._layerBottom.find(".i_checkbox")[0];var b=c.checked?"1":"0";$.cookie("WATER_CHECK",b,{expires:30});a.closeUploadLayer();var d=a.getURLs(b,a.imageContainer,"obj");a.editor.insertImage(d);a.lDialogOp.close();a.editor.overlay.width(680);a.editor.overlay.height(500);delete (a.lDialogOp)},closeUploadLayer:function(){this.j_con.closest(".j_content").addClass("hide")}}});;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiCamera",extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{id:"mz_camera_flash",layerHeight:460,layerWidth:680,initial:function(b){var a=this;a.editor=b},run:function(){this.cameraPicLayer()},cameraPicLayer:function(){var b=this;if(b.lDialogOp){return}var a=$("<div></div>");b.cameraContainer=$('<div class="l_camerapic_container"></div>');b._layerBottom=b.layerBottom("showtips");a.append(b.cameraContainer).append(b._layerBottom);var c={html:a,title:"\u6444\u50cf\u5934\u62cd\u7167",width:b.layerWidth,height:b.layerHeight,closeable:true};b.editor.overlay.hide();b.lDialogOp=new $.dialog(c);b.scrollOff();b.lDialogOp.bind("onclose",function(){b.scrollOn();b.editor.overlay.show();delete (b.lDialogOp)});a.click(function(d){if(d.stopPropagation){d.stopPropagation()}return false});if($.browser.msie&&$.browser.version<7){a.closest(".dialogJcontent").css({padding:"9px 0px 9px 9px;"})}b.lDialogOp.show();b._loadTBS()},_showErrorTips:function(a){if(!this.errDom){this.errDom=$(".i_error_tips")}switch(a){case"compressed":this.errDom.text("\u56fe\u7247\u538b\u7f29\u6210\u529f");break;case"already":this.errDom.text("\u6444\u50cf\u5934\u51c6\u5907\u5b8c\u6bd5\uff0c\u8bf7\u6309\u4e0b\u786e\u5b9a\u62cd\u7167");break;case"not_support":this.errDom.text("\u6444\u50cf\u5934\u672a\u88ab\u5b89\u88c5\u6216\u5f53\u524d\u7cfb\u7edf\u4e0d\u652f\u6301");break;case"busy":this.errDom.text("\u6444\u50cf\u5934\u5f53\u524d\u6b63\u88ab\u5360\u7528");break;case"error":this.errDom.text("\u51fa\u73b0\u5185\u90e8\u9519\u8bef");break;default:break}},_loadTBS:function(){var a=this;uploadURL="http://upload.tieba.baidu.com/upload/pic",tbsURL="http://tieba.baidu.com/dc/common/imgtbs",img_tbs=$.ajax({url:tbsURL,dataType:"json"});img_tbs.done(function(b){if(Number(b.no)===0){uploadURL+="?tbs="+b.data.tbs;a._loadCameraFlash(uploadURL)}else{alert("tbs error")}})},_loadCameraFlash:function(b){var a=this;var c={id:a.id,container:".l_camerapic_container",width:660,height:414,params:{wmode:"window"},vars:{imageWidth:800,imageHeight:600,maxSize:3,maxWidth:3000,maxHeight:3000,uploadURL:b},callBacks:{completeInterface:function(d){var e=[];e.push({pic_id_encode:a.getEncode(d.info.pic_water),url:d.info.pic_water});a.editor.insertImage(e);a.lDialogOp.close();a.scrollOn();a.editor.overlay.show()},compressInterface:function(){a._showErrorTips("compressed")},errorInterface:function(){a._showErrorTips("error")},cameraStatus:function(d){switch(d){case"ready":a._showErrorTips("already");break;case"not_support":a._showErrorTips("not_support");break;case"busy":a._showErrorTips("busy");break;default:break}}}};new $.swf("/tb/static-common/editor_img/FlashCameraPrinter.swf?dt=0724",c);this.flash=document[this.id]||window[this.id]},submit:function(){var a=this;this.flash.print();this.flash.startUpload()}}});;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",requires:[],sub:{layerHeight:515,layerWidth:810,initial:function(a){},genericImageCon:function(e,d){var c="";for(var b=0,a=e.length;b<a;b++){var f=e[b].id;c+='<a href="" unselectable="on" onclick = "return false;" class="uploading i_item_con"  data-name="'+e[b].name+'" data-uptype="'+d+'" data-size="'+e[b].size+'" data-id="'+f+'" draggable="false"><img class="i_item_bg" src="/tb/static-common/editor_img/layer/unload.png"><span class="progress"><b></b></span><span class="close" title="\u5220\u9664\u6b64\u56fe"></span><span class="button_bar"><span class="j_editor_button edit_button">\u7f8e\u5316\u56fe\u7247</span></span><span class="error">\u4e0a\u4f20\u5931\u8d25</span><span class="error_big">\u56fe\u7247\u8fc7\u5c0f</span><span class ="error_big_more">\u8bf7\u4e0a\u4f20\u5927\u56fe</span></a>'}return c},destroyJquery:function(a){var b=this;a.remove();a=null},imageHandler:function(){},checkURL:function(a){a=a.trim();if(a.length<=0){return false}if(a.search(/http:\/\/|https:\/\//)!==0){a+="http://"}var b=/(.gif|.jpg|.jpeg|.png)$/i;if(!b.test(a)||a.getByteLength()>this.urlLength){return false}return a},layerBottom:function(e){var b="",a=this,d=e=="upload"?"\u63d2\u5165\u56fe\u7247":"\u786e \u5b9a",h=$('<div class="i_layer_bottom"></div>'),g=$('<a href="#" style="float:left;margin-right:10px;" class="ui_btn ui_btn_m"><span><em>'+d+"</em></span></a>"),f=$(' <a href="#" style="float:left" class="ui_btn ui_btn_sub_m"><span><em>\u53d6 \u6d88</em></span></a>');var c=$('<div class="i_layer_btn"></div>');c.append(g).append(f);h.append(c);if(e=="upload"){b='<div class="i_layer_water"><input class="i_checkbox" checked type="checkbox" /><span style="float:left;">\u6dfb\u52a0\u672c\u5427\u6c34\u5370(gif\u683c\u5f0f\u6216\u8fc7\u5c0f\u7684\u56fe\u7247\u65e0\u6cd5\u6dfb\u52a0)</span></div>';h.append(b)}else{if(e=="showtips"){b='<div class="i_error_tips"></div>';h.append(b)}}h.width(this.layerWidth-2);if($.browser.msie&&$.browser.version<7){h.css({bottom:6})}g.click(function(){a.submit();return false});f.click(function(i){try{a.lDialogOp.close()}catch(i){alert(i.message)}e=="upload"&&a.closeUploadLayer();return false});return h},getURLs:function(d,a,h){var g=[],e,f=a.find(".i_item_con");for(var c=0;c<f.length;c++){e=f.eq(c);if(h=="obj"){var b={};if(e.hasClass("complete")&&e.tbattr("data-url")){if(d=="1"&&e.tbattr("data-water-url")!=""&&e.tbattr("data-water-url")!="undefined"){b.url=e.tbattr("data-water-url")}else{b.url=e.tbattr("data-url")}b.width=e.tbattr("data-width")||0;b.height=e.tbattr("data-height")||0;b.pic_id_encode=e.tbattr("data-id-encode")||0;g.push(b)}}else{if(e.hasClass("complete")&&e.tbattr("data-url")){if(d=="1"&&e.tbattr("data-water-url")!=""&&e.tbattr("data-water-url")!="undefined"){g.push(e.tbattr("data-water-url"))}else{g.push(e.tbattr("data-url"))}}}}return g},remainImage:function(e,b){var d=this;var f=d.getImageLimit(b);var c='\u8fd8\u53ef\u4ee5\u6dfb\u52a0<span class="j_image_num">'+f+"</span>\u5f20\u56fe\u7247";var a=$('<div class="i_image_tip"></div>');if(e=="upload"){c+=',<span class="i_image_continue">\u7ee7\u7eed\u6dfb\u52a0:</span><span style="color:#1D53BF">\u672c\u5730\u4e0a\u4f20</span><div class="i_uploader_con" ></div>';a.html(c);d.conUploader=d.localUploader(a.find(".i_uploader_con"))}else{a.html(c)}d.jCon=a;return d.jCon},resetImg:function(c,b,e){var d=c.width,a=c.height,i,g=0,f=0;if(d>b||a>e){i=d>=a?b/d:b/a;f=(b-d*i)/2;g=(e-a*i)/2;$(c).css({height:a*i,width:d*i,top:g,left:f,visibility:"visible"})}else{f=(b-d)/2;g=(e-a)/2;$(c).css({top:g,left:f,visibility:"visible"})}},updateRemianImage:function(a,e,c){var b=this,d=b.getImageLimit(a);a.find(".j_image_num").html(d);if(d==0){if(e){e()}}else{if(c){c()}}},getImageLimit:function(a){var b=this;var c=b.getImageNum(a),d=b.editor.getImageNum()-c;d=Math.max(0,d);return d},onStartDrag:function(c,a){var b=a.holder;b.style.left=b.offsetLeft+"px";b.style.top=b.offsetTop+"px";a.holder.style.position="absolute";b.parentNode.insertBefore(this.placeHolder,b);b.parentNode.appendChild(b);this.currentIndex=parseInt(b.offsetLeft/this.width);this.currentIndex=Math.min(this.currentIndex,this.index-1)},onDragging:function(d,a){var c=a.left;var b=Math.min(parseInt(c/this.width),this.index-1);if(b!==this.currentIndex){this.swapNode(this.list[b],this.list[this.currentIndex]);this.currentIndex=b}},onStopDrag:function(b,a){a.holder.style.position="relative";a.holder.style.left="0";a.holder.style.top="0";this.swapNode(a.holder,this.placeHolder);this.placeHolder.parentNode.removeChild(this.placeHolder)},swapNode:function(c,b){var e=c.parentNode,d=b.parentNode,a=c.cloneNode(false);e.replaceChild(a,c);d.replaceChild(c,b);e.replaceChild(b,a)},getImageNum:function(a){var b=0;b=a&&a.find(".i_item_con").size()||b;return b},getEncode:function(a){var b=a.split("/");var c=b[b.length-1];return c.slice(0,c.indexOf("."))},scrollOn:function(){document.body.parentNode.style.overflow="scroll"},scrollOff:function(){document.body.parentNode.style.overflow="hidden"}}});;_.Module.define({path:"postor/widget/MeizhiPostor",requires:["common/widget/LoginDialog","common/widget/EditorPicMeizhi"],sub:{containerHTML:["<div>",'<div id="mz_post_wrapper">','<div id="#{meizhi_tip}" class="meizhi_tip">\u6e29\u99a8\u63d0\u793a\uff1a\u83b7\u5f9710\u4e2a\u59b9\u7eb8\u6295\u7968\uff0c\u4f60\u5c06\u88ab\u8ba4\u8bc1\u4e3a\u59b9\u7eb8\uff01\u7537\u6027\u7528\u6237\u65e0\u6cd5\u8fdb\u884c\u59b9\u7eb8\u8ba4\u8bc1\u3002<a class="tip_close" onclick="return false;" href="#"></a></div>','<form id="#{meizhi_post}"  method="post"  autocomplete="off">','<table  width="100%" border="0" cellspacing="0" cellpadding="3">','<tr id="#{title_tr}"> <td class = "label_wrapper" valign="top"  nowrap style="line-height:32px;">\u6807\u9898:</td> <td> <div id = "#{title_div}" class="input_wrapper"><span class ="input_prefix">\u3010\u59b9\u7eb8\u6c42\u8ba4\u8bc1\u3011</span> <input type="text" id="#{title}" class="title_input" name="title" value="" autocomplete="off"  /> </div> <div id="#{titleError}" class="postErrorTitle"></div> </td> </tr>','<tr id="#{content_tr}"> <td class = "label_wrapper" valign="top"  nowrap >\u5185\u5bb9:</td> <td> <textarea class="content_input"></textarea> <div id="#{contentError}" class="postErrorContent"></div> </td> </tr>','<tr id="pic_tr"> <td class = "label_wrapper" valign="top"  nowrap >\u7167\u7247:</td> <td> <div id="#{pic_wrapper}" class="pic_wrapper clearfix"> <div id="#{pic_editor}" class="pic_add"> <div class="pic_remain_back"> <div class="pic_remain">\u8fd8\u53ef\u6dfb\u52a0<span class="pic_remain_num">30</span>\u5f20</div></div></div></div></td></tr>','<tr id="#{vcode_tr}" style="display:none;"> <td nowrap="nowrap" valign="top"  class="pt_valid"> <label for="captcha" style="line-height:24px;">\u9a8c\u8bc1\u7801:</label> </td> <td valign="middle" align="left" nowrap="nowrap"> <div id="#{vcode_div}" class="vcode"></div> </td> </tr>','<tr id="#{like_tr}" ><td class = "label_wrapper like_label" valign="top" nowrap >\u53d1\u8868\u5230:</td><td><select class="like_wrapper"></select></td></tr>','<tr id="#{submit_tr}"><td>&nbsp;</td><td class="submit"> <input type="submit" id="#{submit}" alog-alias="richpostor" class="subbtn_bg" value=" \u53d1 \u8868 "/> <span class="pt_posting_status j_posting_status"></span><span id="#{postError}" class="post_error"></span> </td> </tr>',"</tbody> </table> </form></div>","</div>"].join(""),successHTML:['<div class="mz_post_success">','<p class="success_title">\u5df2\u6210\u529f\u53d1\u8d77\u8ba4\u8bc1\uff01</p>','<p class="success_tip">\u83b7\u5f9710\u4e2a\u59b9\u7eb8\u6295\u7968\uff0c\u4f60\u5c06\u88ab\u8ba4\u8bc1\u4e3a\u59b9\u7eb8\uff01</p>','<p class="success_relocation"><span class="success_relocation_timeout"></span>\u540e\u5c06\u81ea\u52a8\u8df3\u8f6c\u5230\u59b9\u7eb8\u8ba4\u8bc1\u5e16</p>',"</div>"].join(""),config:{imageLimite:30},initial:function(){var b=this;this._data_postor={};this._option={forum:PageData.forum,tbs:PageData.tbs,user:PageData.user};this._event={};var c=this.containerHTML;this._generi_dom_id();c=$.tb.format(c,this._dom_id);this.container=$(c);var a=this._option.user.is_login;this._statInit(a)},_statInit:function(a){if(!a){this._cannotPost();return}else{this._canPost();return}},_cannotPost:function(){this.use("common/widget/LoginDialog","","userBar")},_canPost:function(){this._dialogInit();this._initTitleAndContent();this._editorInitPic(this.picWrapper);this._postBtnInit();this._hasTip()},_dialogInit:function(){var a={html:this.container.html(),title:"\u53d1\u8d77\u59b9\u7eb8\u8ba4\u8bc1\u5e16",width:680,height:500};this.overlay=new $.dialog(a);this.title=$("#"+this._dom_id.title_div).find(".title_input");this.content=$("#"+this._dom_id.content_tr).find(".content_input");this.picEditor=$("#"+this._dom_id.pic_editor);this.picWrapper=$("#"+this._dom_id.pic_wrapper);this.submit_tr=$("#"+this._dom_id.submit_tr);this._likeInit()},_pic_wrapper_toggle:function(){var a=this;var b=$("#meizhi_img_layer");var c=this.picEditor.find(".pic_remain_back");c.bind("click",function(d){if(a.getImageNum()!=0){if(b.hasClass("hide")){b.removeClass("hide");$(document).one("click",function(f){b.addClass("hide")})}else{b.addClass("hide")}}else{b.addClass("hide")}});c.bind("click",function(d){d.stopPropagation()})},_initTitleAndContent:function(){var b="\u6211\u662f\u771f\u5fc3\u59b9\u7eb8\uff0c\u6c42\u5927\u5bb6\u4e0d\u8981\u624b\u6296...",a="\u4e0a\u4f20\u4e09\u5f20\u9753\u7167\uff0c\u7acb\u5373\u8fdb\u5165\u672c\u5427\u59b9\u7eb8\u8ba4\u8bc1\u4e13\u533a~";_.Module.use("common/widget/Placeholder",[this.title,b,{left:95,"font-size":14}],function(){});_.Module.use("common/widget/Placeholder",[this.content,a,{"font-size":14}],function(){})},_likeInit:function(){var c,b,a,e=this.sel=$("#"+this._dom_id.like_tr).find("select"),d=this._option.forum.name;e.append('<option value="'+d+'">'+d+"</option>");e.tbattr("disabled","disabled")},_editorInitPic:function(b){var a=this;if(this.imageLayer){this.imageLayer.init(b,this)}else{this.imageLayer=this.use("common/widget/EditorPicMeizhi");this.imageLayer.init(b,this)}this._pic_wrapper_toggle();this._picBoxEvents();return false},_postBtnInit:function(c){var b=this,d=this._dom_id,a=$("#"+d.submit);a.tbattr("disabled",false);a.className="subbtn_bg";b._postBtnEvent()},_postBtnEvent:function(){var b=this,d=this._dom_id,a=$("#"+d.submit),c=$("#"+d.meizhi_post);if(!a.hasClass("bubbtn_bg_banned")){a.mouseover(function(){$(this).tbattr("class","subbtn_bg_hover")});a.mouseout(function(){$(this).tbattr("class","subbtn_bg")});a.mousedown(function(){$(this).tbattr("class","subbtn_bg_active")})}c.submit(function(){b._submit();return false});c.keydown(function(f){var g=f||window.event;if((g.ctrlKey&&g.keyCode==13)||(g.altKey&&g.keyCode==83)){if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}}})},_generi_dom_id:function(){var a=new Date().valueOf();this._dom_id={meizhi_tip:"mt"+a,meizhi_post:"mp"+a,title_tr:"tt"+a,title_div:"td"+a,titleError:"te"+a,content_tr:"ct"+a,contentError:"ce"+a,pic_wrapper:"pw"+a,pic_editor:"pe"+a,like_tr:"lt"+a,vcode_tr:"vt"+a,vcode_div:"vd"+a,submit_tr:"st"+a,submit:"sm"+a,postError:"pr"+a}},getImageNum:function(){return this.config.imageLimite-this.picWrapper.find(".pic_box").length},setStatsRequest:function(b){var a=new Image();window["bd_pv_"+(new Date).getTime()]=a;a.src="http://static.tieba.baidu.com/tb/img/pv.gif?fr=tb0_forum&st_mod=frspb&st_type=editor&st_value="+b+"&t="+(new Date).getTime();a=null},insertImage:function(c){var d=this;for(var e=0,b=c.length;e<b;e++){var a=$('<div class = "pic_box" ><div class = "pic_box_close"><a href="#" onclick="return false"></a></div><img unselectable="on" style="display:none;" data-id = "'+c[e].pic_id_encode+'" class="tmp_image" src="'+c[e].url+'"/></div>');a.insertAfter(this.picEditor).find("img").one("load",function(){d.resizePicSize($(this));d.cutPic($(this),100);$(this).show();d._resizePos()})}},resizePicSize:function(a){var c=560,d=a.width(),b=a.height();if(d>560){var e=c/d;d=560;b*=e}a.tbattr({width:d,height:Math.floor(b)})},cutPic:function(c,b){var a=c.width();var e=c.height();if(a>e&&e>=b){a=a/e*b;e=b;var f=Math.round((a-e)/2);var d=Math.round(a-e-f);c.css({width:a,height:e,marginLeft:-1*f,marginRight:-1*d})}else{if(e>a&&a>=b){e=e/a*b;a=b;c.css({width:a,height:e})}}},_resizePos:function(){var a=$("#"+this._dom_id.pic_wrapper+">div");a.each(function(b){if($(this).hasClass("pic_add")){this.className="pic_add"}else{this.className="pic_box"}if((b+1)%5==0){$(this).addClass("right_end")}if(b>4){$(this).addClass("bottom_end")}});this.picWrapper.find(".pic_remain_num").text(this.getImageNum())},_picBoxEvents:function(){var a=this;this.picWrapper.find(".pic_box").live("mouseenter",function(b){$(this).find(".pic_box_close").show()}).live("mouseleave",function(b){$(this).find(".pic_box_close").hide()});this.picWrapper.find(".pic_box_close").live("click",function(){$(this).parent(".pic_box").remove();a._resizePos()})},successDialog:function(c){var a=this;var b={html:this.successHTML,width:500,height:150,title:"\u53d1\u8d77\u59b9\u5b50\u8ba4\u8bc1\u5e16"};if(this.overlay){this.overlay.close()}this.overlay=new $.dialog(b);this._setRelocationTime(c);this.overlay.bind("onclose",function(){clearInterval(a._time);a._time=null})},_setRelocationTime:function(c){var a=this,b=$(".mz_post_success .success_relocation_timeout").text("3s");i=3;this._time=setInterval(function(){if(i==0){clearInterval(this._time);$.tb.location.setHref("http://tieba.baidu.com/p/"+c.thread_id);return false}i-=1;b.text(i+"s")},1000)},_hasTip:function(){var b=this;var a=$.cookie("meizhiTipIsClosed")=="1";var d=$("#"+this._dom_id.meizhi_tip);var c=d.find(".tip_close");if(a){d.hide()}c.click(function(f){$.cookie("meizhiTipIsClosed","1",{empires:365,path:"/"});d.hide();f.stopPropagation()})},bind:function(b,a,c){var d={stat:c?true:false,fun:a};if(this._event[b]){this._event[b].push(d)}else{this._event[b]=[];this._event[b].push(d)}},triggerEvent:function(b){var a=Array.prototype.slice.call(arguments,0);a.shift();if(this._event[b]){var d=this._event[b];for(var c=0;c<d.length;c++){if(d[c].fun){d[c].fun.apply(this,a)}if(!d[c].stat){return false}}}return true},setPostorData:function(a,c){var b=this._data_postor;b[a]=c},getPostorData:function(a){var b=this._data_postor;return b[a]},removePostorData:function(a){var b=this._data_postor;delete b[a]},setPostingStatus:function(b){var a=this.submit_tr.find(".j_posting_status");if(b){a.addClass("pt_posting_loading")}else{a.removeClass("pt_posting_loading")}},_getData:function(){var c=this._data_postor;var d=this._dom_id;var b=this._option;var e=this.picWrapper.find(".tmp_image"),a=[];e.each(function(h){var f=this,k=$(this),g={},j=k.tbattr("data-id");v_url=k.tbattr("src");if(j){g.pid=j;g.url=v_url;g.width=k.tbattr("width");g.height=k.tbattr("height");a.push(g)}});c.pic_info=a;c.like=this.sel.find("option:selected").val();c.title="\u3010\u59b9\u7eb8\u6c42\u8ba4\u8bc1\u3011"+this.title.val();c.content=this.content.val();c.tbs=this._option.tbs;c.forum_id=PageData.forum.id||PageData.forum.forum_id;c.user_id=this._option.user.id;if(!c.vcode){c.vcode=""}return c},_validator:function(){if(!this._validFrsPostTitle()){return false}if(!this._validRichEditorContent()){return false}if(!this._validPicEditor()){return false}return true},_validFrsPostTitle:function(){var c=this.title,e=c.val().trim();if(e==""){this._errorTipShow("\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a");c.focus();return false}else{var a=e.getByteLength();var b=60;if(a>b){var d="\u62b1\u6b49\uff0c\u60a8\u7684\u6807\u9898\u8d85\u8fc7"+(b/2)+"\u5b57\uff0c\u5efa\u8bae\u60a8\u7cbe\u7b80\u540e\u518d\u63d0\u4ea4";this._errorTipShow(d);c.focus();return false}}return true},_validRichEditorContent:function(){var f=this._dom_id,e=this.content,g=this.content.val(),c=this;if((g.trim()==""||g.replace(/<[^>]*>|(&nbsp;)|[\s\u3000]*/g,"")=="")){this._errorTipShow("\u53d1\u8d34\u5185\u5bb9\u9700\u5305\u542b\u6587\u5b57");e.focus();return false}var a=g.getByteLength();var b=10000;if(a>b){var d="\u62b1\u6b49\uff0c\u60a8\u7684\u8d34\u5b50\u8d85\u8fc7"+(b/2)+"\u5b57\uff0c\u5efa\u8bae\u60a8\u7cbe\u7b80\u6216\u5206\u6bb5\u540e\u518d\u63d0\u4ea4";c._errorTipShow(d);return false}return true},_validPicEditor:function(){var a=this.picWrapper.find(".pic_box").length;if(a===0){this._errorTipShow("\u8bf7\u9009\u62e9\u81f3\u5c11\u4e00\u5f20\u7167\u7247");return false}return true},_errorTipShow:function(b){var c=this._dom_id,a=this;var d=$("#"+this._dom_id.postError);d.css("display","");d.get(0).innerHTML=b},_errorTipHide:function(){var a=$("#"+this._dom_id.postError);a.css("display","none")},_submit:function(){var b=this;if(this._validator()){this.setPostingStatus(true);var d=$("#"+this._dom_id.submit);d.tbattr("disabled",true);d.removeClass("subbtn_bg").addClass("subbtn_bg_banned");var e=this._getData();var a={anonymous:0,content:e,fid:PageData.forum.id||PageData.forum.forum_id,ie:"utf-8",kw:PageData.forum.name,rich_text:1,tbs:PageData.tbs};var f=$.extend(a,e||{});var c="/encourage/post/meizhi/thread?ie=utf-8";_.Module.use("common/component/PostorServiceMeizhi",[],function(g){g.postHandler({data:f,url:c,type:"thread",success:function(h){b.successDialog(h)}});d.tbattr("disabled",false);d.removeClass("subbtn_bg_banned").addClass("subbtn_bg");b.setPostingStatus(false)});return false}}}});_.Module.define({path:"frs/widget/frs_stamp_notice",sub:{initial:function(){try{var s=PageData.forum.id,e=$.cookie("fudai_"+s),t=$.cookie("bless_post_"+s),a=PageData.userfortune;a&&1==a.has_fortune_bag&&!e&&1==t&&PageData.userfortune.data_fortune_bag.first_post&&this.showPrintDialog()}catch(o){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:12}),$.se({msg:(o.message||o.description).replace(/\s+/g,"-"),locator:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",linenum:12}),console.log("errormsg:"+(o.message||o.description).replace(/\s+/g,"-"),"locator:frs:widget/frs_stamp_notice/frs_stamp_notice.js","linenum:12")}},showPrintDialog:function(){$.stats.track("stamp_flower_postor","fudai","frs/pb","click");var s=this,e=PageData.forum.id;$.cookie("bless_post_"+e,2,1);var t='<div class="content_1">恭喜你达成<span class="notice_color">本吧今日首次发贴任务</span>，获得<img src="'+PageData.userfortune.data_fortune_bag.icon+'" width=15 height=15 class="flower_img"><span class="notice_color">+'+PageData.userfortune.data_fortune_bag.first_post+"</span>奖励</div>",a='<p class="notice_app">同时如果通过客户端回贴，可以额外获得奖励哦！</p>',o='<img src="'+PageData.userfortune.data_fortune_bag.icon+'" width=15 height=15 class="flower_img"><a class="j_print_flower print_flower" href="http://tieba.baidu.com/p/2916765309" target="_blank">印花是什么？</a>',i='<div class="print_button"><a href="#" class="ui_btn ui_btn_m j_print_ok"><span><em>好 的</em></span></a><a href="#" class="ui_btn_disable ui_btn_m_disable print_flower_tips j_print_no"><span><em>不再提示</em></span></a></div>',r='<div class="frs_stamp_notice">'+t+a+o+i+"</div>",n=$.dialog.open(r,{width:428,noTitle:!0,modal:!1});$(".j_print_ok").click(function(s){try{s.preventDefault(),n.close()}catch(s){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:28}),$.se({msg:(s.message||s.description).replace(/\s+/g,"-"),locator:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",linenum:28}),console.log("errormsg:"+(s.message||s.description).replace(/\s+/g,"-"),"locator:frs:widget/frs_stamp_notice/frs_stamp_notice.js","linenum:28")}}),$(".j_print_no").click(function(s){try{s.preventDefault(),n.close(),$.cookie("fudai_"+e,!0,365)}catch(s){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:33}),$.se({msg:(s.message||s.description).replace(/\s+/g,"-"),locator:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",linenum:33}),console.log("errormsg:"+(s.message||s.description).replace(/\s+/g,"-"),"locator:frs:widget/frs_stamp_notice/frs_stamp_notice.js","linenum:33")}}),$(".j_print_flower").click(function(){try{s.trackFlower()}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:36}),$.se({msg:(e.message||e.description).replace(/\s+/g,"-"),locator:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",linenum:36}),console.log("errormsg:"+(e.message||e.description).replace(/\s+/g,"-"),"locator:frs:widget/frs_stamp_notice/frs_stamp_notice.js","linenum:36")}})},trackFlower:function(){$.stats.track("stamp_flower_show","fudai","frs/pb","click")}}});window.Common_GoTop=function(o){var n=!1,i={id:"goTop","class":"goTop goTop_self",href:"#"},e="<style>html{_background:url(about:blank) fixed;}</style>";$.browser.msie&&$.browser.version<7&&(i["class"]+=" goTop_ie6",$("body").append(e)),$("<a>").attr(i).bind("click",function(){return Common_ToTop(o),!1}).appendTo("body");var l=$("#goTop"),t=$("#container").offset().left-l.width()-5;0>t&&l.addClass("goTop_1024");var r;setTimeout(function(){$(window).bind("scroll",function(){r&&clearTimeout(r),r=setTimeout(function(){$(window).scrollTop()>0?n||(l.fadeIn(500),n=!0):n&&(l.fadeOut(),n=!1)},500)})},500)},window.Common_ToTop=function(o){function n(){e=Math.floor(e/2),window.scrollTo(0,e),e>2?i=setTimeout(n,40):(window.scrollTo(0,0),clearTimeout(i))}var i=null,e=$(window).scrollTop();$.browser.msie||o?window.scrollTo(0,0):n()};_.Module.define({path:"comforum/widget/Comtrial",sub:{initial:function(a){this.dataObj=a,this._initAD(),this._initPbFlashAd()},_initAD:function(){var a=this,t=a.dataObj;$("#search_fengchao")[0]&&"search"==t.page&&0==t.hide_searchad&&(window.arrBaiduAds=window.arrBaiduAds||{},$.JsLoadManager.use(["http://a.baidu.com/ecom?di=779&tm=baiduASPT779S&word="+t.query_encode+"&tn=SE_ecomt01_b7az25cz"],function(){$("#search_fengchao").html(arrBaiduAds[779])})),$.JsLoadManager.use(["http://cbjs.baidu.com/js/m.js"],function(){var t=a.dataObj,n=PageData.forum?PageData.forum.forum_id:0;window.BAIDU_DAN_config={zIndex:1},$("#pb_adbanner").length>0&&(BAIDU_CLB_addOrientation("tbid",n+""),BAIDU_CLB_fillSlotAsync(613519,"pb_adbanner")),$("#union_mod")[0]&&"pb"==t.page&&(BAIDU_CLB_addOrientation("tbid",n+""),BAIDU_CLB_fillSlotAsync(666982,"union_mod")),$("#search_union_mod")[0]&&"search"==t.page&&0==t.hide_searchad&&(BAIDU_CLB_fillSlotAsync(696315,"search_union_mod"),$("#search_union_mod").show())}),$("#search_bottomad")[0]&&"search"==t.page&&0==t.hide_searchad&&($("#search_bottomad").html($.tb.format($("#comtrial_search_bottomad").html(),null)),$("#search_bottomad").show())},_initPbFlashAd:function(){var a=PageUnit.load("tope_pbbanner_swf");a&&new $.swf(a,{id:"chart",container:"#banner_pb_customize",width:960,height:90,params:{wmode:"transparent"}})}}});_.Module.define({path:"comforum/widget/SkinAd",sub:{initial:function(){this._calcAdWidth(),this._bindEvents()},_calcAdWidth:function(){var i=$(".com_skinad_left,.com_skinad_right"),n=$(window).width(),t=1380>n?(n-980)/2:200;i.css("width",t)},_bindEvents:function(){var i=this;$(window).on("resize",i._calcAdWidth),$(".com_skinad_left,.com_skinad_right").on("click",function(){$.stats.hive("skin_ad")})}}});_.Module.define({path:"comforum/widget/GamePopWindow",sub:{nextDay:new Date((new Date).getTime()+864e5-1e3*(60*(new Date).getHours()*60+60*(new Date).getMinutes()+(new Date).getSeconds())),tmp:['<div id="game_pop_window">','<div class="pop_head">','<a class="pop_head_close" href="#" onclick="return false;"></a>',"</div>",'<div class="pop_body">','<div class="game_info">','<a class="game_image" href="#{game_link}" target="_blank">','<img src="#{game_image}" />',"</a>",'<p class="game_name">','<a href="#{game_link}" target="_blank">#{game_name}</a>',"</p>",'<div class="game_hot clearfix">#{game_hot}</div>',"</div>",'<div class="game_reco">','<div class="game_icon"></div>','<p class="game_reco_info">#{game_reco_info}</p>',"</div>",'<a class="game_btn" href="#{game_link}" target="_blank"></a>','<p class="game_desc clearfix">',"<span>#{game_desc_text}</span>",'<a href="#{game_desc_link}" target="_blank">详情介绍</a>',"</p>","</div>","</div>"].join(""),initial:function(e){e&&PageData.user.is_login&&(this.game_name=e.game_name,this.popWindow=null,this.buildTmp(e),this.bindEvents(e),this.runStrategy(e))},bindEvents:function(e){var a=this,t=1==e.pop_type?"吧推荐弹窗":"用户推荐弹窗",o="frs"==PageData.product?"frs页_":"pb页_";$("#game_pop_window").on("click",".pop_head_close",function(){$.stats.track(o+"弹窗_关闭弹窗","个性化弹窗实验","","click",{obj_type:"游戏",obj_subtype:t,obj_game:a.game_name}),a.hidePop(),a.clearStrategy()}).on("click",".game_name a",function(){$.stats.track(o+"弹窗_进入游戏","个性化弹窗实验","","click",{obj_type:"游戏",obj_subtype:t,obj_name:"游戏名称",obj_game:a.game_name}),a.hidePop(),a.clearStrategy()}).on("click",".game_image",function(){$.stats.track(o+"弹窗_进入游戏","个性化弹窗实验","","click",{obj_type:"游戏",obj_subtype:t,obj_name:"游戏图标",obj_game:a.game_name}),a.hidePop(),a.clearStrategy()}).on("click",".game_btn",function(){$.stats.track(o+"弹窗_进入游戏","个性化弹窗实验","","click",{obj_type:"游戏",obj_subtype:t,obj_name:"游戏按钮",obj_game:a.game_name}),a.hidePop(),a.clearStrategy()}).on("click",".game_desc a",function(){$.stats.track(o+"弹窗_详情介绍","个性化弹窗实验","","click",{obj_type:"游戏",obj_subtype:t,obj_name:"游戏按钮",obj_game:a.game_name})}).on("click",".forum_title",function(){$.stats.track(o+"弹窗_推荐吧点击","个性化弹窗实验","","click",{obj_type:"游戏",obj_subtype:t,obj_name:$(this).getData().forum_name,obj_game:a.game_name})}).on("click",".user_link",function(){$.stats.track(o+"弹窗_推荐用户点击","个性化弹窗实验","","click",{obj_type:"游戏",obj_subtype:t,obj_name:$(this).getData().user_name,obj_game:a.game_name})})},buildTmp:function(e){var a="",t={game_name:$.tb.subByte(e.game_name,16),game_image:e.game_image,game_link:e.game_link,game_hot:this.buildGameHot(e),game_reco_info:this.buildGameRecoInfo(e),game_desc_text:$.tb.subByte(e.game_desc,44),game_desc_link:e.game_desc_link};a=$.tb.format(this.tmp,t),this.popWindow=$(a).appendTo("body")},runStrategy:function(e){var a=$.cookie("game_pop_window");!a||0>a||a>3?(this.resetStrategy(),this.stepStrategy()):3==a?(this.showPop(e),this.resetStrategy()):0==a||this.stepStrategy()},resetStrategy:function(){$.cookie("game_pop_window",1,{expires:this.nextDay})},stepStrategy:function(){var e=$.cookie("game_pop_window");$.cookie("game_pop_window",++e,{expires:this.nextDay})},clearStrategy:function(){$.cookie("game_pop_window",0,{expires:this.nextDay})},showPop:function(e){var a=this,t=1==e.pop_type?"吧推荐弹窗":"用户推荐弹窗",o="frs"==PageData.product?"frs页_":"pb页_",n=setTimeout(function(){a.popWindow.show().css("bottom","-280px").animate({bottom:0},500),clearTimeout(n),n=null},2e3),i=setTimeout(function(){a.hidePop(),clearTimeout(i),i=null},12e3);$.stats.track(o+"弹窗_展现","个性化弹窗实验","","view",{obj_type:"游戏",obj_subtype:t,obj_game:a.game_name})},hidePop:function(){this.popWindow.animate({bottom:"-280px"},500,function(){$(this).hide()})},buildGameHot:function(e){var a=0,t="",o=parseInt(e.game_hot)||0,n=o>9?9:o;for(a;n>a;++a)a%2!=1&&(t+='<span class="full"></span>');for(a%2==0&&(t+='<span class="half"></span>'),a;10>a;++a)a%2!=1&&(t+='<span class="empty"></span>');return t+='<span class="score">'+e.game_hot+"</span>"},buildGameRecoInfo:function(e){var a,t="";if(1==e.pop_type){var o=$.tb.dataField({forum_name:e.forum_name});t+='<a class="forum_title" href="/f?kw='+e.forum_name+'&ie=utf8" '+o+' target="_blank" >'+$.tb.subByte(e.forum_name,12)+"吧</a>里已经有<span>"+e.user_num+"</span>位贴吧小伙伴在玩这款游戏，马上加入到他们的行列！"}else if(2==e.pop_type){for(a=0;a<e.user_info.length&&!(a>3);++a){var n=$.tb.dataField({user_name:e.user_info[a]});t+='<a class="user_link" href="/home/main/?ie=utf8&un='+e.user_info[a]+'"'+n+' target="_blank" >'+$.tb.subByte(e.user_info[a],12)+"</a>、"}t=t.slice(0,t.length-1),t+="等多位贴吧小伙伴在玩这款游戏，马上跟他们一起玩！"}return t}}});_.Module.define({path:"pb/widget/UrlCheck",sub:{url:"/f/urlcheck",urlToBeChecked:"",b_option:{content:"",arrowReq:!1,closeBtn:!1},initial:function(){try{this._bindEvent()}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:35}),$.se({msg:(e.message||e.description).replace(/\s+/g,"-"),locator:"pb:widget/url_check/url_check.js",linenum:35}),console.log("errormsg:"+(e.message||e.description).replace(/\s+/g,"-"),"locator:pb:widget/url_check/url_check.js","linenum:35")}},_bindEvent:function(){var e=this;$("#j_p_postlist").on({mouseenter:function(){var t=$(this),c=t.parents("div.l_post"),n=c.getData(),a=n.content.id;t.data("handler",null);var l=null,r=!0;if(t.data("level")){var o=setTimeout(function(){e._show(t)},25);t.data("handler",o)}else{e.urlToBeChecked=t.tbattr("href");var s={urls:[t.tbattr("href")],ie:"utf8",post_id:a},i=function(){$.tb.get(e.url,s,function(c){if(-1!=c.no){var n=15;0==c.no&&c.data&&c.data.url_info&&(n=c.data.url_info[0].whitetype||15),t.data("level",n),r&&(l=setTimeout(function(){e._show(t)},25))}})};i()}t.on("mouseleave",function(){r=!1,clearTimeout(l),clearTimeout(t.data("handler")),o=setTimeout(function(){e._hide(t)},25),t.data("handler",o)})},click:function(e){try{{var t=$(this),c=t.data("level");t.tbattr("href")}11!=c&&12!=c&&15!=c&&void 0!=c&&e.preventDefault()}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:110}),$.se({msg:(e.message||e.description).replace(/\s+/g,"-"),locator:"pb:widget/url_check/url_check.js",linenum:110}),console.log("errormsg:"+(e.message||e.description).replace(/\s+/g,"-"),"locator:pb:widget/url_check/url_check.js","linenum:110")}}},".j_d_post_content a:not(.at), .j_lzl_s_p .lzl_content_main a:not(.at)")},_show:function(e){var t=this;if(!e.data("bubble")){var c,n,a=e.data("level"),l=e.tbattr("href"),r=e.text(),o=e.position();switch(a){case 11:case 12:return;case 13:c="unsecure",n="可信度低，不建议访问";break;case 14:c="danger",n="危险网站，千万别访问";break;case 15:default:return}t._sendStats("bbshow");var s=['<a href="http://guanjia.qq.com"  class="icon_link" target="_blank" >&nbsp;</a>','<div class="url_check_bubble_wrap '+c+'">','<p class="text">'+n+"</p>",'<p class="control"><a href="http://guanjia.qq.com/online_server/complain_url.html?url='+encodeURIComponent(r)+'" class="j_argue_url" target="_blank">申诉</a> <a href="'+l+'" class="open_url j_open_url" target="_blank">打开</a>',"</div>"].join(""),i=$.extend({},this.b_option);i.content=s,i.wrap=e.parents(".p_content");var u=o.top-55-e.height();i.bubble_css={left:o.left,top:u,width:258,height:72};var d={zIndex:$.getcurzIndex()},h=new UiBubbleTipBase(i);h.showBubble(d),h.j_bubble.addClass("url_check_bubble_container"),h.j_bubble.on({mouseenter:function(){h.j_bubble.find("a.j_argue_url");clearTimeout(e.data("handler"))},mouseleave:function(){hdl=setTimeout(function(){t._hide(e)},25),e.data("handler",hdl)}}),h.j_bubble.find("a.icon_link").on({click:function(){try{t._sendStats("iconclick")}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:199}),$.se({msg:(e.message||e.description).replace(/\s+/g,"-"),locator:"pb:widget/url_check/url_check.js",linenum:199}),console.log("errormsg:"+(e.message||e.description).replace(/\s+/g,"-"),"locator:pb:widget/url_check/url_check.js","linenum:199")}}}),h.j_bubble.find("a.j_argue_url").on({click:function(){try{t._sendStats("argueclick")}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:203}),$.se({msg:(e.message||e.description).replace(/\s+/g,"-"),locator:"pb:widget/url_check/url_check.js",linenum:203}),console.log("errormsg:"+(e.message||e.description).replace(/\s+/g,"-"),"locator:pb:widget/url_check/url_check.js","linenum:203")}}}),h.j_bubble.find("a.j_open_url").on({click:function(){try{t._sendStats("openclick")}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/url_check/url_check.js",method:"",ln:207}),$.se({msg:(e.message||e.description).replace(/\s+/g,"-"),locator:"pb:widget/url_check/url_check.js",linenum:207}),console.log("errormsg:"+(e.message||e.description).replace(/\s+/g,"-"),"locator:pb:widget/url_check/url_check.js","linenum:207")}}}),e.data("bubble",h)}},_sendStats:function(e){var t=this;$.stats.sendRequest("bubble=urlcheck&page=pb&function="+e+"&url="+t.urlToBeChecked)},_hide:function(e){var t=e.data("bubble");t&&(t.closeBubble(),e.removeData("bubble"))}}});var PopWidowHandle=function(t){var o={url:{P_GET:"/app/pop/bws/popup",P_POST:"/app/pop/commit/click"},delay:15,from_forum:"",page:""};this._option=$.extend(!0,o,t),this._init()};PopWidowHandle.prototype={constructor:PopWidowHandle,_init:function(){var t=this;$(document).ready(function(){setTimeout(function(){t._getPopWindow()},1e3*t._option.delay)})},_getPopWindow:function(){var t=this._option,o=this;$.tb.get(t.url.P_GET,{from_forum:t.from_forum,position:t.page},function(t){0==t.no&&t.data.task_id&&o._showPopWindow(t.data)})},_showPopWindow:function(t){this.data=t;var o=this._option,n={styleId:t.style_id,templateObj:{title:t.title,content:t.content,button:t.button,note:t.note,link:t.link}};this.popWindow=new PopWindow(n);var i=this.popWindow;i.bind("closeSuccess",function(){$.tb.post(o.url.P_POST,{task_id:t.task_id,type:1,count:t.count},function(){})},!0),i.bind("clickBtn",function(){$.tb.post(o.url.P_POST,{task_id:t.task_id,type:2,count:t.count},function(){})},!0),i.showPop()}};_.Module.define({path:"frs/widget/DlBubble",sub:{initial:function(){try{var e={content:'<p class="bubble_dl">'+PageUnit.load("dl_bubble_txt")+"</br>"+PageUnit.load("dl_bubble_link")+"</p>",arrow_dir:"down",bubble_css:{width:140,height:90,"z-index":$.getcurzIndex(),top:-90,left:-50},arrow_pos:{left:68},wrap:$(".tbui_aside_float_bar"),closeBtn:!0,level:1,arrowReq:!0},l=new UiBubbleTipBase(e),b=$.cookie("dlBubbleFlag");1!=b&&"1"==PageUnit.load("dl_bubble_switch")&&l.showBubble(),l.bind("onclose",function(){$.cookie("dlBubbleFlag",1,{expire:1}),l.closeBubble()}),$(window).on("resize",function(){var e=$(".tbui_aside_float_bar").css("left");"auto"==e?$(".j_dl_bubble").css({right:-22,left:"auto"}):$(".j_dl_bubble").css("left","50%")})}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/dl_bubble/dl_bubble.js",method:"",ln:44}),$.se({msg:(t.message||t.description).replace(/\s+/g,"-"),locator:"frs:widget/dl_bubble/dl_bubble.js",linenum:44}),console.log("errormsg:"+(t.message||t.description).replace(/\s+/g,"-"),"locator:frs:widget/dl_bubble/dl_bubble.js","linenum:44")}}}});window.__discarding&&__discarding("props/component/residual"),_.Module.define({path:"props/component/Residual",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions()},initOptions:function(){this.options={1070001:"worship",1070002:"egg"}},getResidualKey:function(i){for(var e=i.props||{},n=null,s="",t=["1070002","1070001"],a=0;a<t.length;a++)if(n=e[t[a]],n&&n.num>0&&n.end_time>Env.server_time/1e3){s=this.options[t[a]];break}return s},showUI:function(i){var e=i.wrap,n="",s=null,t=i.key||this.getResidualKey(i);t&&(n="residual_wrap residual_wrap_"+t,s=e.find(".residual_wrap"),s[0]?s.removeClass().addClass(n):(s=$('<div class="'+n+'"></div>'),e.append(s)))}}});_.Module.define({path:"props/component/Guide",sub:{initial:function(){},initMagicGuide:function(){var i=$.cookie("PROPS_MAGIC_GUIDE");i||($.cookie("PROPS_MAGIC_GUIDE","true",{expires:30}),this.showMagicGuide())},showMagicGuide:function(i){this.propsId=i,this.builGuideUI(),this.buildGuideEvents(),this.initGuideFlash()},initPreviewUI:function(){this.builGuideUI(),this.buildGuideEvents()},builGuideUI:function(){this.$mask=new $.modal({show:!0});var i=$('<div class="guide_wrap"></div>'),e=$('<div class="guide_content"></div>'),s=$('<a href="#" class="guide_close"></a>');i.append(e).append(s),$("body").append(i),i.css({"z-index":$.getzIndex()}),this.$guideWrap=i,this.$guideContent=e,this.$guideClose=s},buildGuideEvents:function(){var i=this;this.$mask.bind("click",function(){i.closeGuide()}),this.$guideClose.bind("click",function(){return i.closeGuide(),!1})},closeGuide:function(){this.$guideWrap.remove(),this.$mask.remove()},initGuideFlash:function(){this.buildFlashUI(),this.buildFlashEvents()},buildFlashUI:function(){{var i=this,e="1070002"==this.propsId?"egg":"worship",s="/tb/static-props/swf/guide_"+e+".swf?t=140112";new $.swf(s,{container:i.$guideContent,width:980,height:600,params:{wmode:"transparent"}})}this.$guideWrap.addClass("guide_wrap_magic")},buildFlashEvents:function(){var i=this,e={};e.finishPlay=function(){i.closeGuide()},window.MagicProps=e}}});window.__discarding&&__discarding("props/component/magic_props"),_.Module.define({path:"props/component/MagicProps",requires:["props/component/Residual","props/component/Guide"],sub:{initial:function(t){this.$wrap=t.wrap,this.dataObj=t.propsData,this.visible=!1,this.initOptions(),this.loadComponent(),this.buildProps()},initOptions:function(){this.propsOptions={1070001:{key:"worship",name:"魔拜",flashOptions:{width:320,height:390,marginLeft:0,marginTop:0}},1070002:{key:"egg",name:"魔蛋",flashOptions:{width:900,height:600,marginLeft:384,marginTop:70}}},this.mallurl="/tbmall/propslist?category=107",this.poolSize=5;var t=window.navigator.userAgent.match(/chrome/i);this.page=t?$(document.body):$(document.documentElement)},loadComponent:function(){this.residual=this.use("props/component/Residual"),this.guide=this.use("props/component/Guide")},buildProps:function(){this.initPropsData(),this.propsList.length>0&&(this.visible=!0,this.initPropsUI(),this.bindPropsEvents())},initPropsData:function(){for(var t=this.dataObj.owner||{},i=null,a=null,s=[],e={},o=["1070001","1070002"],r=0;r<o.length;r++)a=o[r],i={id:a,count:t[a]&&t[a].left_num||0},$.extend(i,this.propsOptions[a]),s.push(i),e[a]=i;this.propsList=s,this.propsMap=e},initPropsUI:function(){for(var t=this,i=$('<ul class="tbui_aside_props_list clearfix" id="tbui_aside_props_list"></ul>'),a=new Array,s=null,e=0;e<t.propsList.length;e++)s=t.propsList[e],a.push('<li class="props_item props_item_'+s.id+'">'),s.count>0?a.push('<a class="j_props_btn props_item_btn" href="#" data-id="'+s.id+'"><img src="/tb/static-props/img/props/'+s.key+'.png"/></a>'):a.push('<a class="props_item_btn" target="_blank" href="'+t.mallurl+'" data-id="'+s.id+'"><img src="/tb/static-props/img/props/'+s.key+'.png"/><span class="props_buy_icon"></span></a>'),a.push('<p class="props_item_title">'),a.push("<span>"+s.name+"</span>"),s.count>0&&(a.push('<span class="props_item_sign">'+String.fromCharCode(215)+"</span>"),a.push('<span class="props_item_num">'+s.count+"</span>")),a.push("</p>"),a.push("</li>");i.html(a.join("")),i.hide().appendTo(t.$wrap),t.$propsList=i},bindPropsEvents:function(){var t=this;t.$wrap.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){t.$propsList.fadeIn(),t.guide.initMagicGuide()},mouseleave:function(){t.$propsList.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),t.$propsList.delegate(".j_props_btn","click",function(){var i=$(this).data("id"),a=t.propsMap[i];return t.propsObj=a,a.count>0&&("pb"==PageData.product?t.buildPostArea():"ihome"==PageData.product&&t.buildIhomeArea(),t.buildMask(),t.initFlashCallbacks()),!1})},buildIhomeArea:function(){var t={jdom:$("div.userinfo_wrap"),userId:this.dataObj.home_user_id,propsData:this.dataObj.home_user_props,propsType:0},i=$("#headinfo_wrap"),a=i.offset().left,s=i.offset().top,e=a+i.width(),o={marginLeft:a,marginRight:e,marginTop:s,marginBottom:$("body").height()-28};$.extend(t,o),this.limitArea=o,this.areaList=[t]},buildPostArea:function(){for(var t=$("#j_p_postlist"),i=t.find(".l_post"),a=null,s=null,e=[],o=t.offset().left,r=t.offset().top,p=o+t.width(),n=0;n<i.length;n++)a=$(i[n]),s=a.getData(),this.doPostItem(a,s,o,p,e);var l={marginLeft:o,marginRight:p,marginTop:r,marginBottom:r+t.height()};this.limitArea=l,this.areaList=e},doPostItem:function(t,i,a,s,e){var o=null,r=null,p=null,n=t.offset().top,l=n+t.height(),h={userId:i.author.id,postId:i.content.id,propsData:i.content.props,marginTop:n,marginBottom:l};r={},o=t.find(".d_author"),r.jdom=o,r.marginRight=a+130,r.marginLeft=a,$.extend(r,h),e.push(r),p={},o=t.find(".d_post_content_main"),p.jdom=o,p.marginRight=s,p.marginLeft=a+130,$.extend(p,h),e.push(p)},buildMask:function(){this.flashPool=[],this.currScrollTop=0,this.currAreaObj=null,this.initMask(),this.setMaskPosition(0,0,0,0),this.bindMaskEvents()},initMask:function(){var t=$('<div class="mask_layer mask_top"></div>'),i=$('<div class="mask_layer mask_right"></div>'),a=$('<div class="mask_layer mask_bottom"></div>'),s=$('<div class="mask_layer mask_left"></div>'),e=$('<div class="mask_layer light_area"></div>'),o=$('<div id="mask_wrap" class="mask_wrap mouse_'+this.propsObj.key+'"></div>');o.append(t).append(i).append(a).append(s).append(e).css({"z-index":$.getzIndex()}),$("body").append(o),this.$maskWrap=o,this.maskMap={topMask:t,rightMask:i,bottomMask:a,leftMask:s,lightArea:e}},setMaskPosition:function(t,i,a,s){var e=this.maskMap;e.topMask.css({height:i}),e.rightMask.css({left:t+a,top:i,width:$("body").width()-(t+a),height:s}),e.bottomMask.css({top:i+s,height:$("body").height()-(i+s)}),e.leftMask.css({top:i,width:t,height:s}),e.lightArea.css({left:t,top:i,width:a,height:s})},bindMaskEvents:function(){var t=this;$("body").bind("contextmenu",function(){return!1}),$(document).bind("keydown",function(i){if(27==i.which&&null!=t.$maskWrap){if(t.disabledMove)return!1;t.clear()}}),t.$maskWrap.mousedown(function(i){if(3==i.which){if(t.disabledMove)return!1;t.clear()}return!1});var i=50,a=$("body").width()-i,s=0;t.$maskWrap.mousemove(function(i){if(t.$bulletLayer||(t.$bulletLayer=t.buildBulletLayer(),t.$maskWrap.append(t.$bulletLayer)),s=i.pageX,s>a&&(s=a),t.$bulletLayer.css({left:s,top:i.pageY}),t.disabledMove)return!1;var e=null,o=t.limitArea;if(t.isInArea=i.pageX>=o.marginLeft&&i.pageX<=o.marginRight&&i.pageY>=o.marginTop&&i.pageY<=o.marginBottom?!0:!1,t.isInArea)for(var r=0;r<t.areaList.length;r++)e=t.areaList[r],i.pageX>=e.marginLeft&&i.pageX<=e.marginRight&&i.pageY>=e.marginTop&&i.pageY<=e.marginBottom&&(t.setMaskPosition(e.marginLeft,e.marginTop,e.marginRight-e.marginLeft,e.marginBottom-e.marginTop),e.propsType=r%2,t.areaObj=e);else t.setMaskPosition(0,0,0,0)})},buildBulletLayer:function(){var t=this,i=$('<div class="bullet_layer"><span class="bullet_layer_tip">右键取消</span></div>');return i.click(function(){t.isInArea?t.propsObj.count>0?t.flashPool.length<=t.poolSize&&(t.updatePosition(),t.post()):t.showTomallDialog():t.clear()}),i},clear:function(){this.clearPool(),this.$maskWrap.remove(),this.$maskWrap=null,this.$bulletLayer=null,setTimeout(function(){$("body").unbind("contextmenu")},300)},post:function(){var t=this,i="/tbmall/post/useAppraiseProps",a={props_id:t.propsObj.id,target_user_id:t.areaObj.userId||"",type:t.areaObj.propsType,post_id:t.areaObj.postId||"",tbs:PageData.tbs};$.tb.post(i,a,function(i){i&&0==i.no&&t.updatePage()})},updatePage:function(){var t=this.propsObj.id,i=".props_item_"+t;this.updatePropsBtnNum(t,i),("ihome"==PageData.product||"1"==this.areaObj.propsType)&&this.updatePostAreaNum(t,i)},updatePropsBtnNum:function(t,i){var a=$("#tbui_aside_props_list "+i),s=this.propsObj.count-1;s=s>0?s:0,this.propsObj.count=s,s>0?a.find(".props_item_num").text(s):(a.find(".props_item_btn").removeClass("j_props_btn").tbattr("target","_blank").tbattr("href",this.mallurl).append('<span class="props_buy_icon"></span>'),a.find(".props_item_sign").remove(),a.find(".props_item_num").remove())},updatePostAreaNum:function(t,i){var a=this.areaObj.propsData||{};a[t]||(this.areaObj.propsData={},this.areaObj.propsData[t]={num:0});var s=this.areaObj.propsData[t].num+1;s=s>0?s:0,this.areaObj.propsData[t].num=s;var e=this.areaObj.jdom.find("ul.props_appraise_wrap"),o=e.find(i);o[0]?o.find(".props_item_num").text(s):(htmlArr=[],htmlArr.push('<li class="props_item props_item_split"><span class="userinfo_split"></span></li>'),htmlArr.push('<li class="props_item props_item_'+t+'">'),htmlArr.push('<a href="#" data-postid="'+(this.areaObj.postId||"")+'" data-id="'+t+'" class="props_item_icon"></a>'),htmlArr.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),htmlArr.push('<span class="props_item_num">'+s+"</span></li>"),"1070001"==t?e.prepend($(htmlArr.join(""))):"1070002"==t&&e.append($(htmlArr.join(""))))},updatePosition:function(){var t=this,i=this.propsOptions[this.propsObj.id].flashOptions,a=($(window).height()-i.height)/2;a=150>a?150:a;var s=this.areaObj.jdom.offset().top-a;this.disabledMove=!0;var e=$(window).scrollTop();0==e||e!=this.currScrollTop||this.currAreaObj&&this.currAreaObj.marginTop!=this.areaObj.marginTop?(this.currAreaObj=this.areaObj,this.currScrollTop=e,t.page.animate({scrollTop:s},300,"swing",function(){t.buildFlash(s)})):t.buildFlash(s)},buildFlash:function(t){var i=this,a=0,s=0,e=$('<div class="props_flash_wrap"></div>'),o=this.propsOptions[this.propsObj.id].flashOptions,r=($(window).width()-o.width)/2,p=t+o.marginTop;r=r>0?r:0,p=p>0?p:0,"0"==i.areaObj.propsType&&"1070002"==i.propsObj.id&&("ihome"==PageData.product?(a=100,s=-15):(a=60,s=-20),r=r-(r+o.marginLeft-i.areaObj.jdom.offset().left)+a,p+=s),e.css({width:o.width,height:o.height,left:r,top:p,"z-index":$.getzIndex()});{var n="/tb/static-props/swf/"+this.propsObj.key+".swf?t=140107";new $.swf(n,{container:e,width:o.width,height:o.height,params:{wmode:"transparent"}})}i.flashPool.push(e),i.$maskWrap.append(e),i.topzIndex=$.getzIndex(),i.$bulletLayer.css({"z-index":i.topzIndex})},buildPlusOne:function(){var t=this,i="plusone_"+this.propsObj.key;$.browser.msie&&6==$.browser.version&&(i+="_png8"),i="/tb/static-props/img/"+i+".png";var a=$('<div class="props_plusone"><img src="'+i+'"/></div>'),s=0,e=0;"ihome"==PageData.product?(s=t.areaObj.marginLeft+70,e=t.areaObj.marginTop+300):(s=t.areaObj.marginLeft+(t.areaObj.marginRight-t.areaObj.marginLeft)/2-18,e=t.areaObj.marginTop+100),a.css({left:s,top:e,"z-index":t.topzIndex+1}),t.$maskWrap.append(a),a.animate({top:"-=100px",opacity:.8},800,"swing",function(){a.remove()})},clearPool:function(){for(var t=this,i=t.flashPool,a=null,s=0;s<i.length;s++)a=i.shift(),a.remove();t.disabledMove=!1},initFlashCallbacks:function(){var t=this,i={},a=null;i.finishPlay=function(){if(t.flashPool.length>0){t.buildPlusOne();var i=t.flashPool.shift();i.remove(),t.flashPool.length<=0&&(t.disabledMove=!1,"0"==t.areaObj.propsType&&("ihome"==PageData.product?a=t.areaObj.jdom.find(".userinfo_left"):"pb"==PageData.product&&(a=t.areaObj.jdom.find(".icon_relative")),t.residual.showUI({wrap:a,key:t.propsObj.key})))}},window.MagicProps=i},showTomallDialog:function(){var t=this,i=new $.dialog({title:"提示",html:'<div class="props_buy_dialog"><p class="buy_dialog_content">你目前没有可用的道具了，快去商城购买吧</p><a class="buy_dialog_link" target="_blank" href="'+t.mallurl+'">去购买>></a><div>',width:400,height:80});i.element.find(".buy_dialog_link").on("click",function(){t.clear(),setTimeout(function(){t.showBuyDialog(t.mallurl)},200)})},showBuyDialog:function(t){var i='<p class="buy_txt">道具购买成功后即可使用！</p><div class="buy_dialog_btns"><a href="#" class="ui_btn ui_btn_m btn_success"><span><em>购买成功</em></span></a><a href="#{href}" target="_blank"  class="ui_btn ui_btn_sub_m btn_failure"><span><em>购买失败，重新购买</em></span></a></div>',a=new $.dialog({title:"提示",html:$.tb.format(i,{href:$.tb.unescapeHTML(t)}),width:400,height:80});a.bind("onclose",function(){$.tb.location.reload()}),a.element.find(".btn_success").on("click",function(t){t.preventDefault(),$.tb.location.reload()})}}});_.Module.define({path:"props/widget/Feedback",requires:[],sub:{initial:function(t){this.dataObj=t,this.initOptions(),this.initCallbacks(),this.initData(),this.play()},initOptions:function(){this.options={1070001:{id:"1070001",key:"worship",name:"膜拜",flashOptions:{width:250,height:220,marginLeft:120,marginTop:95}},1070002:{id:"1070002",key:"egg",name:"臭鸡蛋",flashOptions:{width:410,height:260,marginLeft:195,marginTop:30}}}},initData:function(){for(var t=this.dataObj.appraise||{},i=null,e=null,a=[],n=["1070001","1070002"],s=0;s<n.length;s++)i=t[n[s]],i&&i.notice>0&&(e=this.options[n[s]],$.extend(e,i),a.push(e));this.playList=a},play:function(){var t=this.playList;t.length>0&&(t.sort(function(t,i){return i.notice!=t.notice?i.notice-t.notice:parseInt(i.id)-parseInt(t.id)}),this.index=0,this.buildFlash(),this.clearNotice())},buildFlash:function(){if(this.index<this.playList.length){var t=$('<div class="props_flash_wrap"></div>');$("body").append(t);var i=this.playList[this.index],e=this.getFlashData(i);t.css({width:e.width,height:e.height,left:e.marginLeft,top:e.marginTop,"z-index":e.zindex});{var a="/tb/static-props/swf/"+e.feedbackName+"?t=0101";new $.swf(a,{id:"props_flash_content",name:"props_flash_content",container:t,width:e.width,height:e.height,params:{wmode:"transparent"}})}i.wrap=t}},getFlashData:function(t){var i=t.flashOptions,e=0,a=0,n=0,s=0,o=PageData.product;switch(o){case"pb":case"frs":n=40,e=$("#user_info").offset().left,a=$("#user_info").offset().top;break;case"ihome":n=92,e=$("#userinfo_wrap").offset().left,a=$("#userinfo_wrap").offset().top;break;case"index":n=45,e=$("div.user-wraper").offset().left,a=$("div.user-wraper").offset().top}e=e-i.marginLeft+n,a=a-i.marginTop+s;var r=t.notice>1?"more":"single";return feedbackName="feedback_"+t.key+"_"+r+".swf",{key:t.key,feedbackName:feedbackName,width:i.width,height:i.height,marginLeft:e,marginTop:a,zindex:$.getzIndex()}},clearNotice:function(){var t="/tbmall/post/clearAppraiseNotice",i={type:0,tbs:PageData.tbs};$.tb.post(t,i,function(t){t&&0==t.no})},initCallbacks:function(){var t=this,i={};i.finishPlay=function(){t.playList[t.index].wrap.remove(),t.index++,t.buildFlash()},window.MagicProps=i}}});_.Module.define({path:"tbmall/component/NetProxy",sub:{_buyPropUrl:"/tbmall/post/buyprops",_mBuyPropUrl:"/tbmall/post/mbuyprops",_usePropUrl:"/tbmall/post/openProps",_mUsePropUrl:"/tbmall/post/mopenProps",_cancelPropUrl:"/tbmall/post/closeProps",initial:function(){},buyProp:function(t,o){var p=this;t.tbs=PageData.tbs,$.tb.post(p._buyPropUrl,t,o)},mBuyProp:function(t,o){var p=this;t.tbs=PageData.tbs,$.tb.post(p._mBuyPropUrl,t,o)},useProp:function(t,o){var p=this;$.tb.post(p._usePropUrl,{props_id:t,tbs:PageData.tbs},o)},mUseProp:function(t,o){var p=this;t.tbs=PageData.tbs,$.tb.post(p._mUsePropUrl,t,o)},cancelProp:function(t,o){var p=this;$.tb.post(p._cancelPropUrl,{props_id:t,tbs:PageData.tbs},o)}}});window.__discarding&&__discarding("common/component/user_head");_.Module.define({path:"common/component/UserHead",sub:{initial:function(){this.initOptions()},initOptions:function(){this.options={gif:["1100001","1100002","1100003","1100013","1100015","1100016","1100017","1100019"],filter:[]}},getImgFormat:function(a){var b="png";if($.inArray(a,this.options.gif)!=-1){b="gif"}return b},getHeadUrl:function(a){var c=(a.mParr_props&&a.mParr_props["portrait"])||"";var b="";if(c.end_time>Env.server_time/1000){b=c.url}else{b="http://tb.himg.baidu.com/sys/portrait/item/"+a.portrait}return b},getHeadFrameStyle:function(b,c){var f=(b.mParr_props&&b.mParr_props["avatarframe"])||"";var d="",a=null;var e={hasFrame:false,stylestr:""};if(f.end_time>Env.server_time/1000){d=f.props_id;a=["width:"+c+"px","height:"+c+"px","padding:10px","background:url(/tb/static-common/img/props/"+c+"/"+d+"."+this.getImgFormat(d)+") no-repeat","border:none","left:-6px","top:-6px"];e={hasFrame:true,stylestr:a.join(";")}}return e}}});_.Module.define({path:"tbmall/component/UseController",requires:["tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/component/util"],sub:{buy_number:0,initial:function(){this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util")},doUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"贴吧商城",PageData.page,"点击使用"),o.netProxy.useProp(t,function(a){var e="";if(0==a.no)e="使用成功！";else switch(a.no){case 2270005:e="哎呀，T豆不足";break;case 2270001:e="已经买过啦";break;case 2270004:e="您已经拥有了更高级的勋章，无需购买本勋章！";break;case 2270006:e="本道具不可重复购买";break;default:e="哎呀，服务器抽风了。请稍等一会~~"}o.wrap&&o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})},cancelUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"贴吧商城",PageData.page,"取消使用"),o.netProxy.cancelProp(t,function(a){var e="";if(0==a.no)e="取消使用成功！";else switch(a.no){case 2270005:e="哎呀，T豆不足";break;case 2270001:e="已经买过啦";break;case 2270004:e="您已经拥有了更高级的勋章，无需购买本勋章！";break;case 2270006:e="本道具不可重复购买";break;default:e="哎呀，服务器抽风了。请稍等一会~~"}o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})}}});_.Module.define({path:"tbmall/component/HeadPreview",requires:["common/component/UserHead","tbmall/component/util","props/component/Guide","tbmall/component/UseController","ihome/widget/UserVisitCard"],sub:{initial:function(){this.initOptions(),this.initUI(),this.initFlashCallbacks(),this.guide=this.use("props/component/Guide"),this.visitCard=this.use("ihome/widget/UserVisitCard"),this.useC=this.use("tbmall/component/UseController"),this.util=this.use("tbmall/component/util")},initOptions:function(){this.options={1090001:{pngCount:3},1090002:{pngCount:5},1090003:{pngCount:5},1090004:{pngCount:4},1090005:{pngCount:5},1090006:{pngCount:5},1090007:{pngCount:5},1090008:{pngCount:4},1090009:{pngCount:5},1090010:{pngCount:5},1090011:{pngCount:5}},this.winHeight=$(window).height()-50},propIdForProp:{101:"bub",104:"font",108:"card",116:"card",117:"card",118:"card",114:"card",103:"printer"},stylesForAllPreview:{110:"frame",109:"frame"},doPreview:function(t){{var e=this,i=$.json.encode($(t).closest("li.item").data("field")),a=$(t).closest("li.item").getData(),s=a.props_category,r=a.props_id;e.stylesForAllPreview[s]}if("107"==s)e.$loading.remove(),e.guide.showMagicGuide(r);else if("109"==s)e.guide.initPreviewUI(),e.guide.$guideContent.html(e.getHtmlFor109(r)),e.guide.$guideWrap.addClass("guide_wrap_"+s),e.hasFrame&&(e.guide.$guideClose.css({right:"10px",top:"10px"}),e.guide.$guideContent.find(".head_preview_wrap").css({width:350,height:205,backgroundPosition:"105px 40px",backgroundColor:"#fff"}));else if("110"==s)e.guide.initPreviewUI(),e.guide.$guideContent.html(e.getHtmlFor110(a.props_id)),e.guide.$guideWrap.addClass("guide_wrap_"+s),e.guide.$guideContent.find(".head_preview_wrap").css({backgroundPosition:"105px 40px",backgroundColor:"#fff"});else if("113"==s){if(!PageData.user.is_login)return void _.Module.use("common/widget/LoginDialog");e.guide.initPreviewUI(),e.guide.$guideContent.html(e.getHtmlForOther(a.props_id)),e.visitCard.getVisitCardContent({un:PageData.user.user_name,id:PageData.user.portrait,wrap:e.guide.$guideContent.find(".card_preview"),bg_id:a.props_id}),e.guide.$guideWrap.addClass("guide_wrap_"+s)}else e.guide.initPreviewUI(),e.guide.$guideContent.html(e.getHtmlForOther(a.props_id)),e.guide.$guideWrap.addClass("guide_wrap_"+s);var o=("0"==a.props_type?a.free_user_level:2,e.util.getFreeInfo(a)),n=e.initBuyInfo(i);e.guide.$guideContent.append(n),"107"!=s&&e.guide.$guideContent.append(o),"1080001"===r&&$(".guide_wrap_108").css({height:"430px","margin-top":"-215px"}),this.initToBuy(),this.initUse()},initUI:function(){this.$portraitWrap=$('<div id="portrait_wrap" class="portrait_wrap"></div>'),this.$portraitFlash=$('<div class="portrait_flash"></div>'),this.$loading=$('<img class="portrait_loading" src="/tb/static-tbmall/img/loading.gif"/>'),this.$portraitWrap.append(this.$portraitFlash).append(this.$loading)},getHtmlForOther:function(t){var e=this,i=t.slice(0,3),a="",s="png",r="",o={1170001:"-1~2",1170002:"0~3",1170003:"2~5",1170004:"5~8",1170005:"10~15"};("1040003"===t||"1040011"===t)&&(s="gif",r="padding: 30px 76px 30px;");var n=["http://tb1.bdstatic.com/tb/cms/tbmall/",e.propIdForProp[i],"/pc/"+t,"."+s].join("");switch(a+="113"===i?'<div class="card_preview"><img class="card_loading" src="/tb/static-tbmall/img/loading.gif"/></div><div class="card_mask">':"117"===i?['<div class="preview">','<img src="http://tb1.bdstatic.com/tb/cms/tbmall/card/pc/1170001.png" alt=""/>'].join(""):"108"===i?"1080001"===t?['<div class="preview">','<img src="http://tb1.bdstatic.com/tb/cms/tbmall/card/pc/1080001.png" alt=""/>'].join(""):['<div class="preview">','<img src="http://tb1.bdstatic.com/tb/cms/tbmall/card/pc/1080001.gif" alt=""/>'].join(""):['<div class="preview">','<img src="'+n+'" alt="图片预览" style="'+r+'" />'].join(""),i){case"108":a+="<p>连续签到神器。麻麻再也不用担心我漏签了！</p>";break;case"117":a+="<p>为楼主挽尊，被挽尊用户经验值增加("+o[t]+")。</p>";break;case"116":a+="<p>给女神告白，叫基友回家吃饭，让你的发言掷地有声！</p>";break;case"118":a+="<p>会员吧主专属金色置顶，不可隐藏，尊贵身份，立刻彰显。</p>"}return a+="</div>"},getHtmlFor109:function(t){var e=this,i="portrait="+PageData.user.portrait+"&props_id="+t+"&png_count="+e.options[t].pngCount,a="/tb/static-tbmall/swf/GIFMaker.swf?t=14010902",s='<embed width="150" height="150" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+i+'" allowfullscreen="true" wmode="transparent" allowscriptaccess="always" quality="high" bgcolor="#FFFFFF" src="'+a+'" type="application/x-shockwave-flash">';this.$portraitFlash.html(s),this.userHead||(this.userHead=this.use("common/component/UserHead"));var r=this.userHead.getHeadFrameStyle(PageData.user,"150"),o=e.$portraitWrap[0].outerHTML;return r.hasFrame&&(o='<div style="'+r.stylestr+'" class="head_preview_wrap">'+o+"</div>",e.hasFrame=!0),o},getHtmlFor110:function(t){this.userHead||(this.userHead=this.use("common/component/UserHead"));var e=["background:url(/tb/static-common/img/props/150/"+t+"."+this.userHead.getImgFormat(t)+") no-repeat"],i=e.join(";"),a='<a style="'+i+'" class="head_preview_wrap"><img src="'+this.userHead.getHeadUrl(PageData.user||{})+'"/></a>';return a},initFlashCallbacks:function(){window.finishMerge=function(){$("#portrait_wrap .portrait_loading").remove()}},initBuyInfo:function(t){var e=this,i=$.json.decode(t),a="";a=PageData.user.is_login?e._buyInfoTpl(i):['<a class="ui_btn ui_btn_sub_s j_buy_button1">',"<span><em>购&nbsp;&nbsp;买</em></span>","</a>"].join("");var s="0"===i.props_type?e.util.convertToDay(i.time_interval):"1个";return['<div class="j_buy_wrapper" data-field = '+t+">",'<p class="cost_info">',i.scores,"T豆/",s,"</p>",a,"</div>"].join("")},_buyInfoTpl:function(t){var e=this.util.getBuyInfo(t);return e},initToBuy:function(){var t=this;$(".guide_wrap").delegate(".j_buy_button1","click",function(e){e.preventDefault();var i=$(this).closest(".j_buy_wrapper").getData();t.guide.closeGuide(),t.use("tbmall/component/BuyController",$(this),i)})},initUse:function(){var t=this;$(".guide_wrap").delegate(".j_use","click",function(e){var i=$(this).closest(".j_buy_wrapper").getData();t.guide.closeGuide(),t.useC.doUse($(this),i),e.preventDefault()}),$(".guide_wrap").delegate(".j_cancle_use","click",function(e){var i=$(this).closest(".j_buy_wrapper").getData();t.guide.closeGuide(),t.useC.cancelUse($(this),i),e.preventDefault()}),$(".guide_wrap").delegate(".j_get_button1","click",function(e){t.guide.closeGuide(),t.use("tbmall/widget/getProp",$(this)),e.preventDefault()})}}});_.Module.define({path:"tbmall/component/BuyController",requires:["tbmall/component/captcha_payment","tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/widget/ContSignCard","tbmall/component/util","tbmall/component/HeadPreview","tbmall/component/UseController","tbmall/widget/paykey_dialog"],sub:{buy_number:0,set_pass_tpl:'<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">立即设置支付密码</a>，降低T豆被盗风险!</p></div>',buy_tpl0:'<div class="buy_tpl clearfix"> <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div></div> <div class="buy_tpl_right"><div class="price_tip">您需要<span class="strong_txt">#{price}</span>T豆购买道具</div> #{TbeanCharge}<a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>确认购买</em></span></a><div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">立即设置支付密码</a>，降低T豆被盗风险!</p></div></div></div> ',buy_tpl1:['<div class="buy_tpl buy_count_tpl clearfix">',' <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div>','</div> <div class="buy_tpl_right">','<p class="count_tip">您要购买的数量</p>','<div class="count_wrap clearfix"><span class="count_number">数量：</span>','<span class="counter"><button class="j_minus minus"></button><input type="text" class="j_count" value="1"/><button class="j_plus plus"></button></span><span>个</span>',"</div>",'<div class="count_tip count_sub_tip">需要T豆：<span class="t_dou_needed strong_txt">#{price}</span>个  您目前T豆：<span class="cur_t_dou">#{cur_t_dou}</span>个</div>',"#{TbeanCharge}",'<div class="buy_and_tip"><a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>确认购买</em></span></a><span class="error_tip"></span></div>','<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">立即设置支付密码</a>，降低T豆被盗风险!</p></div>'," </div></div> "].join(""),initial:function(e,a){this.data=a,$.stats.track(this.data.props_id,"贴吧商城",PageData.page,"点击购买"),this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util"),this.headPreview=this.use("tbmall/component/HeadPreview"),this.useController=this.use("tbmall/component/UseController");this.isAvailable()&&this.doBuy(e),$(e).data("clicked",!1)},isAvailable:function(){var e=this.data,a=this,t=parseInt(PageData.scores.scores_total),s=Math.min(parseInt(PageData.scores.scores_fetch),parseInt(a.data.fetch_scores_limit||0)),n=parseInt(t+s);return PageData.user.is_login?PageData.user.no_un?(TbCom.process("User","BuildUnameFrame","填写用户名","有用户名才可以在T豆商城购物噢~"),!1):n<parseInt(e.scores)?(a.dialog.dialog("<p class='dialog_content'>T豆余额不足，购买道具需要<span class='charge_bean_interaction_orange_tip' >"+e.scores+"</span>T豆</p><div class='charge_bean_interaction_dialog_btn_wrap'><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_charge_btn' id='j_tcharge_dialog_tbmall'>充值T豆</a><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_close_dialog'>取消</a></div>"),$("#j_tcharge_dialog_tbmall").on("click",function(){_.Module.use("common/widget/tcharge_dialog")}),!1):!0:(TbCom.process("User","buildLoginFrame"),!1)},bindCountEvent:function(e){var a=this,t=a._buyDialog,s=t.element.find(".j_count");t.element.on("click",".j_minus",function(){var t=parseInt(s.val())||1;t=Math.max(1,t-1),t=Math.min(999,t),s.val(t),$(".t_dou_needed").text(e*t);var n=Math.min(PageData.scores.scores_fetch,(a.data.fetch_scores_limit||0)*t);$(".Tbean_num").text(n),a.checkCountError()}).on("click",".j_plus",function(){var t=parseInt(s.val())||1;t++,t=Math.min(999,t),s.val(t),$(".t_dou_needed").text(e*t);var n=Math.min(PageData.scores.scores_fetch,(a.data.fetch_scores_limit||0)*t);$(".Tbean_num").text(n),a.checkCountError()}),s.on("input propertychange",function(){var t=/^[1-9]\d*$/,n=s.val();(n&&!t.test(n)||t.test(n)&&n>999)&&(n=n.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),n=Math.min(999,n),s.val(n)),$(".t_dou_needed").text(e*n),a.checkCountError()}).on("blur",function(){var t=s.val()&&parseInt(s.val())>0&&parseInt(s.val())||1;t=Math.min(999,t),s.val(t),$(".t_dou_needed").text(e*t),a.checkCountError()})},checkCountError:function(){var e=this,a=e._buyDialog,t=a.element.find(".t_dou_needed"),s=a.element.find(".error_tip"),n=a.element.find(".j_count"),i=n.val(),l=a.element.find(".j_buy_button"),r=parseInt(PageData.scores.scores_total),c=Math.min(parseInt(PageData.scores.scores_fetch),parseInt(e.data.fetch_scores_limit||0)),o=parseInt(r+c);return 999==i?(s.text("单次限购999个"),s.show()):s.hide(),o<parseInt(t.text())?(s.text("T豆余额不足"),s.show(),l.addClass("ui_btn_disable ui_btn_m_disable").removeClass("ui_btn ui_btn_sub_m j_confirm_buy"),!1):(s.hide(),l.addClass("ui_btn ui_btn_sub_m j_confirm_buy").removeClass("ui_btn_disable ui_btn_m_disable"),!0)},doBuy:function(){var e,a=this.data,t=this,s="",n="",i=parseInt(a.fetch_scores_limit,10)||0,l=PageData.scores.scores_fetch;n=0===i||0===l?"":['<div class="TbeanCharge_container">','<input id="j_charge_checked" type="checkbox" name="TbeanCharge_check" />','可使用<span class="icon_Tbean_num"></span><span class="Tbean_num">',Math.min(l,i),"</span>豆票抵用T豆","</div>"].join(""),"0"==a.props_type?(PageData.user.setpass&&(t.buy_tpl0=t.buy_tpl0.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(t.buy_tpl0,{price:a.scores,price_unit:a.scores+"T豆/"+t.util.convertToDay(a.time_interval),title:a.name,imgsrc:a.imgsrc,level:a.free_user_level,TbeanCharge:n}),e=480):"1"==a.props_type&&(PageData.user.setpass&&(t.buy_tpl1=t.buy_tpl1.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(t.buy_tpl1,{price:a.scores,price_unit:a.scores+"T豆/1个",title:a.name,imgsrc:a.imgsrc,cur_t_dou:PageData.scores.scores_total,level:2,TbeanCharge:n}),e=560);var r=220;PageData.user.setpass&&(r=200),t._buyDialog=new $.dialog({html:s,title:"购买道具",width:e,height:r}),PageData.user.setpass?t._buyDialog.element.find(".buy_tpl_right").append(t.util.getFreeInfo(a)):t._buyDialog.element.find(".buy_tpl_left").append(t.util.getFreeInfo(a)),"1"==a.props_type&&t.bindCountEvent(a.scores),t._buyDialog.element.one("click",".j_confirm_buy",function(){var e={props_id:a.props_id};if("1"==a.props_type&&!t.checkCountError())return void t._buyDialog.element.one("click",".j_confirm_buy",arguments.callee);"1"==a.props_type&&(e.buy_num=t._buyDialog.element.find(".j_count").val()),i>0&&$("#j_charge_checked").length&&$("#j_charge_checked")[0].checked&&(e.use_fetch_scores=$(".Tbean_num").text()),$.stats.track(a.props_id,"贴吧商城",PageData.page,"确定购买");var s=function(n){n&&$.extend(e,n),t.netProxy.buyProp(e,function(n){var i="",l="";if(0==n.no){switch(a.props_category){case"107":l='在贴吧详情页点击<img style="vertical-align:middle;" src="/tb/static-tbmall/img/magic_show_icon.png" />使用';break;case"108":"1080001"==a.props_id&&(l="在签到页面使用");break;case"101":case"104":l="在发贴框中使用";break;case"105":l="您已成功拥有该勋章对应的道具特权，快去使用吧！";break;case"109":case"110":l="在当前页面使用";break;case"113":l="在个人中心使用"}i="1"==a.props_type?"购买"+e.buy_num+"个<span class='orange_txt'>"+n.data.title+"</span>成功！<br>"+l:"购买<span class='orange_txt'>"+n.data.title+"</span>成功！有效期至<span class='orange_txt'>"+t.util.formatDate(n.data.end_time)+"</span><br>"+l}else switch(n.no){case 2270005:i="哎呀，T豆不足";break;case 2270001:i="领取成功`(*∩_∩*)′";break;case 2270004:i="您已经拥有了更高级的勋章，无需购买本勋章！";break;case 2270006:i="本道具不可重复购买";break;case 360007:case 2150040:var r=t.use("tbmall/component/captcha_payment",{data:n});return void r.showCaptcha(s);case 2270018:case 1990005:case 2190005:n.data=n.data||{};var c=t.use("tbmall/widget/paykey_dialog",{showType:2,errType:n.no,errTime:n.data.wrongtime});return void c.showDialog(s,function(){},t);default:i="哎呀，服务器抽风了。请稍等一会~~"}0==n.no&&($.inArray(a.props_category,["109","110","114"])>-1||"1080002"==a.props_id)?t.dialog.confirm('<div class="tip">'+i+"</div>",{button:[{txt:"立即使用",extraclass:"j_nameplate_recast1",callback:function(){t.dialog.close(),"1080002"==a.props_id?t.use("tbmall/widget/ContSignCard"):"1140001"==a.props_id?$(".j_nameplate_recast").trigger("click"):t.useController.doUse(parseInt(n.data.props_id))}},{txt:"稍后使用",callback:function(){t.dialog.close(),$.tb.location.reload()}}]}):(t.dialog.info('<div class="tip">'+i+"</div>"),0==n.no&&t.dialog.bind("onInfoClose",function(){$.tb.location.reload()}))})};t._buyDialog.close();var n=e.buy_num,l=a.scores;if(l=Number(l*n),l>=3e4&&!PageData.user.setpass){var r=t.use("tbmall/widget/paykey_dialog",{showType:1});r.showDialog(s,t)}else s()})}}});_.Module.define({path:"tbmall/widget/NameplateRecast",requires:["tbmall/component/Dialog","tbmall/component/BuyController"],sub:{_cdCount:0,_dialog:null,_npContainer:null,_npId:null,_npArr:[],_timer:null,_recastData:null,initial:function(a,t){this._cdCount=a,this._recastData=t,this._bindEvent()},_bindEvent:function(){var a=this;$("body").on("click",".j_nameplate_recast",function(){var t=$(this).data("nameplate");t=a._formatNpData(t),t.cdCount=a._cdCount;var n=$.tb.format(a._tpl,t);a._dialog=new $.dialog({html:n,title:"铭牌重铸",draggable:!1,holderClassName:"np_dialog",width:550,height:265}),a._npContainer=a._dialog.element.find(".j_container"),a._bindNpEvent()}),$("body").on("click",".j_buy_recast",function(t){if(t.preventDefault(),!$(this).data("clicked")){$(this).data("clicked",!0);var n=a._recastData[0];n=$.extend(n,{name:n.title,imgsrc:n.example_url}),a._dialog.close(),a.use("tbmall/component/BuyController",$(this),n)}})},_tpl:['<div class="np_dialog_bg j_container">','<div class="np_bg">#{fmt_title}</div>','<p class="np_tips">请选择喜爱的助词，并修改浅色字体的文字</p>','<p class="np_tips" style="font-size: 12px;">需要消耗 <span class="orange_text">1</span> 张重铸卡，修改后原铭牌消失</p>','<a class="np_dialog_btn j_dialog_btn disabled" href="javascript:;">开始重铸</a>','<p class="np_dialog_btm"><a class="j_buy_recast" href="#" onclick="return false">我拥有#{cdCount}张重铸卡,我要买&gt;&gt;</a></p>','<div class="np_rst_msg j_np_msg"></div>',"</div>"].join(""),_formatNpData:function(a){var t="",n=this,e=$.tb.unescapeHTML(a.title);a.titleArr=[],this._npId=a.props_id;for(var i=0,s=a.pattern.length;s>i;i++)switch(n._npArr[i]=e.charAt(i),parseInt(a.pattern[i],10)){case 1:t+=e.charAt(i);break;case 2:t+='<a class="np_selected j_selected" href="javascript:;" data-arr="'+i+'" data-optional="'+$.json.encode(a.optional_word).replace(/\"/g,"&quot;")+'"></a>';break;case 3:t+='<input class="np_input j_input" maxlength="1" data-arr="'+i+'" type="text" value="'+e.charAt(i)+'" />'}return a.fmt_title=t,a},_checkNp:function(){var a=this,t=a._npArr.join(""),n=function(n){var e="",i=a._npContainer.find(".j_dialog_btn");switch(n.no){case 0:e='<i class="np_rst_ok"></i>',0!=a._cdCount?i.removeClass("disabled"):"";break;case 2270022:e='<a href="/tbmall/propslist?category=112&ps=24&kw='+encodeURIComponent(t)+'&ie=utf-8">此牌可用,去换牌>></a>',i.addClass("disabled");break;case 2270023:e='<p style="color: red;">此铭牌已有其他用户使用</p>',i.addClass("disabled");break;case 2270024:e='<p style="color: red;">用词不当,请重新输入</p>',i.addClass("disabled");break;case 2270025:e='<p style="color: red;">用词不当,请重新输入</p>',i.addClass("disabled");break;default:e='<p style="color: red;">有点卡,数据疯狂读取中...</p>',i.addClass("disabled")}$(".j_np_msg").html(e)};$.get("/tbmall/get/check",{id:a._npId,new_title:t,ie:"utf-8",_:(new Date).getTime()},n)},_bindNpEvent:function(){var a=this;a._npContainer.find(".j_selected").on("click",function(){var t=$(this).data("arr");if(a._npContainer.find(".j_op_container").length>0)a._npContainer.find(".j_op_container").show();else{for(var n=this,e=$(this).data("optional"),i="string"==typeof e?$.parseJSON(e):e,s=a._npContainer.offset().left,l=$(this).offset().left,o='<div class="np_op_container j_op_container"><ul class="np_op_ul">',r=0,c=i.length;c>r;r++)o+="<li "+(0==r?'class="np_op_wd_1"':"")+'><a class="np_op_wd j_op_wd" href="javascript:;" data-op="'+i[r]+'">'+i[r]+"</a></li>";o+='</ul><i class="np_op_arrow"></i></div>',a._npContainer.append(o);var d=a._npContainer.find(".j_op_container");d.css("left",l-s-d.width()/2+10),d.find(".j_op_wd").on("click",function(){var e=$(this).data(e);a._npArr[t]=e.op,$(n).text(e.op).removeClass("np_selected").addClass("np_blank"),d.hide(),a._checkNp()})}}),a._npContainer.find(".j_input").on("keyup change paste",function(){var t=$(this).data("arr"),n=$(this).val(),e=function(){$(".j_np_msg").html(""),a._npContainer.find(".j_dialog_btn").addClass("disabled")};return 0==$.trim(n).length?($(this).val(""),a._npArr[t]="",void e()):/[a-zA-Z\u4E00-\u9FA5]/.test(n)?(n=n.toLowerCase(),a._npArr[t]=n,$(this).val(n),a._timer&&clearTimeout(a._timer),void(a._timer=setTimeout(function(){a._checkNp()},500))):($(this).val(""),a._npArr[t]="",void e())}).on("click",function(){$(this).select().css({color:"#333"})}),a._npContainer.find(".j_dialog_btn").on("click",function(){var t=$(this),n=a._npArr.join("");if(!t.hasClass("disabled")){var e=a.use("tbmall/component/Dialog");e.confirm('<div class="tip">铭牌将被修改为: <span class="orange_txt">'+a._npArr.join("")+"</span></div>"),e.bind("yes",function(){var t=$(this);if(!t.data("clicked")){t.data("clicked",!0);var i={ie:"utf-8",new_title:n,id:a._npId,tbs:PageData.tbs};$.post("/tbmall/post/recast",i,function(a){t.data("clicked",!1),e.close();var n="";switch(parseInt(a.no,10)){case 0:n="铭牌重铸成功";break;default:n="哎呀，服务器抽风了。请稍等一会~~"}e.info('<div class="tip">'+n+"</div>"),0==a.no&&e.close(),e.bind("onInfoClose",function(){$.tb.location.reload()})})}}),e.bind("no",function(){e.close(),$(this).data("clicked",!1)})}}),a._npContainer.on("click",function(t){var n=t.target;if(!$(n).hasClass("np_op_container")&&!$(n).hasClass("np_selected")&&!$(n).hasClass("np_blank")){var e=a._npContainer.find(".j_op_container");e&&e.hide()}})}}});_.Module.define({path:"tbmall/widget/tshow_out_date_warn",sub:{initial:function(t){var o=this;setTimeout(function(){t.show_pre?o.buildPreHtml.call(o):t.show_suf&&o.buildSufHtml.call(o)},3e3)},buildPreHtml:function(){var t=this,o=$("#tshow_out_date_warn_pre_html").html(),e={html:o,title:"提醒",draggable:!1,width:601};this._dialog=new $.dialog(e),$.cookie("tshow_out_hide",1,1),this._dialog.onclose(function(){$.cookie("tshow_out_hide",1,1)}),$("#tshow_out_date_warn_pre_buy_btn").click(function(){t._dialog.close(),$.cookie("tshow_out_hide",1,1)})},buildSufHtml:function(){var t=$("#tshow_out_date_warn_suf_html").html(),o=$("#com_userbar"),e=$("#com_userbar_message"),i=parseInt(o.css("top")),a=parseInt(e.css("top"));$(t).css("height",0).prependTo("body").animate({height:100},500,"swing",function(){$(window).trigger("resize")}),$.cookie("tshow_out_hide",1,1),o.parent().hasClass("search_form")?o.parent().hasClass("core_title")&&(o.css({top:6}),e.animate({top:125},500)):(o.animate({top:100+i},500),e.animate({top:125},500)),$(window).on("scroll",function(){$.cookie("tshow_out_hide")||(setTimeout(function(){o.css(o.parent().hasClass("search_form")?{top:i}:o.parent().hasClass("core_title")?{top:6}:{top:100+i})},2),setTimeout(function(){e.hasClass("ui_bubble_wrap_fixed")||e.css({top:125})},10))}),$("#tshow_out_date_warn_close_btn").click(function(){$("#tshow_out_date_warn").animate({height:0},500,"swing",function(){$("#tshow_out_date_warn").remove(),$(window).trigger("resize")}),o.animate({top:i},500),e.animate({top:a},500),$.cookie("tshow_out_hide",1,1)}),$("#tshow_out_date_warn_btn").click(function(){$("#tshow_out_date_warn").animate({height:0},500,"swing",function(){$("#tshow_out_date_warn").remove(),$(window).trigger("resize")}),o.animate({top:i},500),e.animate({top:a},500),$.cookie("tshow_out_hide",1,1)})}}});_.Module.define({path:"tbmall/widget/TshowEnterBtn",requires:["tbmall/component/util"],sub:{_stack:{0:{left:0,top:0},1:{left:115,top:0},2:{left:0,top:115},3:{left:115,top:115}},_body:null,_bodyCache:null,_$tbworld:null,_type:0,_isTypeChange:!1,_mouseAction:0,_iconMap:{tbworld_lv2:{text:"高级贴吧会员",img:"http://tieba.baidu.com/tb/cms/tbmall/wxxz_icon.png"},tbworld_lv1:{text:"贴吧会员",img:"http://tieba.baidu.com/tb/cms/tbmall/jzxz_icon.png"}},initial:function(){this.util=this.use("tbmall/component/util"),this._bindEvent()},_animate:function(){var t=this;this._body.find(".tbmall_btn_floatlayer_center_background").animate({width:92,height:92,top:0,left:0},100),setTimeout(function(){t._body.find(".tbmall_btn_floatlayer_block").each(function(e){var a=$(this);a.animate({left:t._stack[e].left,top:t._stack[e].top},150)}),t._body.find(".tbmall_btn_floatlayer_background").animate({width:230,height:230,left:0,top:0},150)},100)},_bindEvent:function(){var t=this,e=!1,a=t._isDuringActive();a&&this._bindFoolishEvent(),$("body").delegate(".icon_tbworld","mouseenter",function(l){e=!1;var o=this,i=$(o).parent();e=setTimeout(function(){return(i.hasClass("frs_bright_preicon")||i.hasClass("d_name_icon"))&&a?(t._changeTypeStatu(1),t._$tbworld=$(o),t._foolishBuild(l,o),void $.stats.track("愚人节浮层展示","贴吧商城")):void(a||(t._changeTypeStatu(0),t._build(l,o)))},200)}).delegate(".icon_tbworld","mouseleave",function(){e&&clearTimeout(e)}).delegate(".tbmall_btn_floatlayer_wrapper,.tbmall_btn_foolish_floatlayer_wrapper","mouseenter",function(){t._mouseAction=1}).delegate(".tbmall_btn_floatlayer_wrapper,.tbmall_btn_foolish_floatlayer_wrapper","mouseleave",function(){if(1==t._mouseAction){var e=t._body.eq(0);setTimeout(function(){e.stop(),e.fadeOut("fast",function(){e.detach()}),t._mouseAction=0},200)}})},_build:function(t,e){this._bodyCache||(this._bodyCache=$("#tbmall_btn_floatlayer_template").html()),this._body=$(this._bodyCache),e=$(e),$("body").append(this._body),"高级贴吧会员"==e.tbattr("title")?(this._body.find(".tbmall_btn_floatlayer_center_img")[0].src=this._iconMap.tbworld_lv2.img,this._body.find(".tbmall_btn_floatlayer_center_img_title").html(this._iconMap.tbworld_lv2.text)):(this._body.find(".tbmall_btn_floatlayer_center_img")[0].src=this._iconMap.tbworld_lv1.img,this._body.find(".tbmall_btn_floatlayer_center_img_title").html(this._iconMap.tbworld_lv1.text)),this._body.css({left:t.pageX-113,top:t.pageY-97}),this._body.fadeIn(50);this._animate()},_changeTypeStatu:function(t){this._type!==t?(this._type=t,this._isTypeChange=!0,this._body&&this._body.remove()):this._isTypeChange=!1},_resultCode:{101:'这都被你猜到了，不要告诉别人哦，作为交换告诉你一个小秘密：使用连续签到卡可以连续所有累计签到天数，<a target="_blank" href="http://tieba.baidu.com/tbmall/propslist?category=108">这种大杀器赶紧来一发</a>',102:'被看穿了么？皇冠勋章，红名特权瞬间高大上，<a target="_blank"  href="http://tieba.baidu.com/tbmall/tshow">赶紧跟我一起去弄一个真会员玩玩</a>',103:'啊哈~~哈~~今天天气不错呦，听说T豆商城有全新春意盎然主题，<a target="_blank"  href="http://tieba.baidu.com/tbmall/hotopic">赶紧去抢一套~~~遁~~</a>',104:'竟然被你猜对了，我是要水到18级的大神，怎么能在这里倒下。快来跟我互刷挽尊卡，<a target="_blank"  href="http://tieba.baidu.com/tbmall/propslist?category=117" >有刷必回</a>',105:'太厉害了，<a target="_blank"  href="http://tieba.baidu.com/tbmall/propslist?category=116">快用贴条把这光辉战绩告诉全体吧友</a>',201:'不要灰心哦，成为会员，马上变红名，<a target="_blank"  href="http://tieba.baidu.com/tbmall/tshow">迅速高大上。</a>',202:'虎摸一下，赶快来星座勋章馆将本月勋章收入囊中，<a target="_blank"  href="http://tieba.baidu.com/tbmall/monthicon">提升超高幸运值</a>',203:'我可是纯正血统高级会员，快来和我成为小伙伴，<a target="_blank"  href="http://tieba.baidu.com/tbmall/tshow ">一起享受海量会员特权</a>',204:'战斗力只有5，待我去领个铭牌再来跟你大战三百回合，全吧唯一铭牌，<a target="_blank"  href="http://tieba.baidu.com/tbmall/propslist?category=112&ps=25">大家都在抢，高级会员免费赠送呦</a>',205:'经鉴定，你已有丰富的上当经验，写成攻略，说不定会被吧主使用置顶卡进行额外置顶哦。<a target="_blank"  href="http://tieba.baidu.com/tbmall/tshow?tab=detail">了解置顶卡</a>',301:'你真是万中无一的绝世高手，拯救世界，抱走大奖的重任就靠你了! <a target="_blank"  href="http://tieba.baidu.com/tbmall/lottery">快来试试手气</a>',401:'哎呀呀，上当啦！赌场失意，情场得意，<a target="_blank"  href="http://tieba.baidu.com/tbmall/lottery">超级大奖正等着和你一见钟情呦</a>',501:"未知错误"},_answerRightCode:[101,102,103,104,105,301],_isDuringActive:function(){return Env.server_time>13962816e5&&Env.server_time<1396368e6},_foolishBuild:function(t){this._body=!this._isTypeChange&&this._body||$($("#tbmall_btn_foolish_floatlayer_template").html()),$("body").append(this._body);var e=this._body.eq(0);e.css({left:t.pageX-116,top:t.pageY-142}),e.fadeIn(50),this._body.filter(".tbmall_btn_foolish_floatlayer_result").hide(),this.util.getMaxLevel()>0&&e.addClass("tbmall_btn_foolish_isvip")},isLogin:function(){return PageData.user.is_login?!0:(_.Module.use("common/widget/LoginDialog"),!1)},removeTbWorldByUserId:function(t){for(var e=$("body").find(".icon_tbworld"),a=0,l=e.length;l>a;a++){var o=e.eq(a).getData();o&&o.user_id===t&&this.removeTbworld(e.eq(a))}},removeTbworld:function(t){var e=t.parent(),a=e.parent();a.removeClass("no_icon_author"),e.remove(),a.find(".vip_red").removeClass("vip_red")},_bindFoolishEvent:function(){var t=this;$("body").delegate(".tbmall_btn_foolish_floatlayer_btn","click",function(){var e=$(this),a=e.data("answer");if(t.isLogin()){var l={fool_uid:t._$tbworld.getData().user_id,is_red:a,tbs:PageData.tbs,ie:"utf-8"};$.stats.track("愚人节猜"+(a?"真":"假"),"贴吧商城"),$.post("/tbscore/guess",l,function(e){var o=t._body.filter(".tbmall_btn_foolish_floatlayer_result"),i=$(window),_=o.find(".tbmall_btn_foolish_floatlayer_result_content_bd"),n=t._resultCode[e.no];$.inArray(e.no,t._answerRightCode)>-1?(o.addClass("tbmall_btn_result_right"),o.find(".j_succ_tip").remove(),0===a&&(o.find(".tbmall_btn_foolish_floatlayer_result_content_success").append('<p class="j_succ_tip" style="font-size:14px;">你揭穿了他的真面目噢~</p>'),t.removeTbWorldByUserId(l.fool_uid))):o.removeClass("tbmall_btn_result_right"),_.html(n),t._body.eq(0).hide(),o.css("top",i.scrollTop()+i.height()/2),o.show()})}}).delegate(".tbmall_btn_foolish_floatlayer_btn_close","click",function(){t._body.detach()}).delegate(".tbmall_btn_foolish_floatlayer_link","click",function(){$.stats.track("愚人节开通会员","贴吧商城"),_.Module.use("common/widget/JoinVipDialog",[],function(t){t.getMemberDialog()})})}}});