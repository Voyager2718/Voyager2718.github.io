(function(){define("lib/user",[],function(){return{isLogin:function(){return typeof window.ukey=="undefined"&&(ukey=!1),ukey?!0:!1},toLogin:function(e){document.location.href=e}}}),define("lib/G",[],function(){"use strict";var e=!!document.all&&navigator.userAgent.indexOf("Opera")===-1,t=e&&!("maxHeight"in document.body.style),n=e&&"prototype"in Image,r=e&&!t&&!n,i=window,s=i.document,o={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};return{ua:{isIE:e,isIE6:t,isIE8:n,isIE7:r,isFF:!!s.getBoxObjectFor||"mozInnerScreenX"in i,isOP:!!i.opera&&!!i.opera.toString().indexOf("Opera"),isOP9:/^function \(/.test([].sort),isWK:!!i.devicePixelRatio,isSF:/a/.__proto__=="//",isCR:/s/.test(/a/.toString),isIpad:/iPad/.test(navigator.userAgent),isIphone:/iPhone/.test(navigator.userAgent)},isHtml:function(e){var t=/^[^<]*(<[\w\W]+>)[^>]*$/;return t.test(e)},format:function(e,t,n){if(typeof t=="string"){var r=n?t:"{v}",i=n||t;return e.replace(r,""+i)}var s=t,i;return e.replace(/\{([^{}]+)\}/g,function(e,t){return i=s[t],i!==undefined?""+i:""})},each:function(e,t,n){var r,i,s,o=Array.prototype.forEach,u=Object.prototype.hasOwnProperty;n=n||this;if(e==null)return;if(o&&e.forEach===o)e.forEach(t,n);else if(e instanceof Array)for(i=0,s=e.length;i<s;i++)t.call(n,e[i],i,e);else for(var a in e)u.call(e,a)&&t.call(n,e[a],a,e)},scriptOnload:function(e,t){window.addEventListener?(e.addEventListener("load",t,!1),e.addEventListener("error",function(){t()},!1)):e.attachEvent("onreadystatechange",function(){var n=e.readyState;(n==="loaded"||n==="complete")&&t()})},loadScript:function(e,t){var n=s.createElement("script"),r=this.loadScript.head=this.loadScript.head||s.getElementsByTagName("head")[0];return this.scriptOnload(n,function(){t&&t.call(n);try{if(n.clearAttributes)n.clearAttributes();else for(var e in n)delete n[e]}catch(i){}r.removeChild(n)}),n.async=!0,n.src=e,r.insertBefore(n,r.firstChild)},type:function(e){return e==null?String(e):o[Object.prototype.toString.call(e)]||"object"},isFun:function(e){return this.type(e)==="function"}}}),define("lib/support",["lib/G"],function(e){"use strict";var t=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n="Webkit Moz O ms Khtml".split(" "),r=document.createElement("div");return{fixed:function i(){if(typeof i.r!="undefined")return i.r;var t=!0;if(e.ua.isIpad||e.ua.isIphone)t=navigator.userAgent.match(/[5-9]_[0-9]/)!==null;else{var n=document.createElement("div"),r=document.createElement("div");n.style.position="absolute",n.style.top="200px",r.style.position="fixed",r.style.top="100px",n.appendChild(r),document.body.appendChild(n),r.getBoundingClientRect&&r.getBoundingClientRect().top==n.getBoundingClientRect().top&&(t=!1),document.body.removeChild(n),n=null,r=null}return i.r=t,t},touchEvent:function s(){if(typeof s.r!="undefined")return s.r;var e=!0,t=["touchstart","touchmove","touchend","touchcancel"];for(var n=0,i=t.length;n<i;n++){var o=t[n];o="on"+o;var u=o in r;u||(r.setAttribute(o,"return;"),u=typeof r[o]=="function");if(!u){e=!1;break}}return s.r=e,e},cssanimation:function o(){if(typeof o.r!="undefined")return o.r;var e=!1,t=r.style,i="animationName",s=i.charAt(0).toUpperCase()+i.substr(1),u=(i+" "+n.join(s+" ")+s).split(" ");for(var a in u)if(t[u[a]]!==undefined){e=!0;break}return o.r=e,e}}}),define("lib/Base",[],function(){"use strict";var e=function(){};return e.extend=function(e,t){var n=t||this;for(var r in n)n.hasOwnProperty(r)&&r!=="prototype"&&(e[r]=n[r]);for(var i in n.prototype)n.prototype.hasOwnProperty(i)&&(e.prototype[i]=n.prototype[i])},e}),define("lib/Event",["lib/Base"],function(e){"use strict";function o(){}var t=Array.prototype.slice,n=Object.prototype.toString,r=function(e){return typeof e=="object"?e===null?"null":/\[object (\w+)\]/.exec(n.call(e))[1].toLowerCase():typeof e},i=function(e,t,n){var i,s,o,u=Array.prototype.forEach;n=n||this;if(e==null)return;if(u&&e.forEach===u)e.forEach(t,n);else if(r(e)==="array")for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e);else for(var a in e)ObjectProto.hasOwnProperty.call(e,a)&&t.call(n,e[a],a,e)},s=function(e,t,n){var i,s,o,u,a=Array.prototype.filter;n=n||this;if(e==null)return;if(a&&e.filter===a)return e.filter(t,n);if(r(e)==="array"){u=[];for(s=0,o=e.length;s<o;s++)t.call(n,e[s],s,e)&&u.push(e[s])}else{u={};for(var f in e)ObjectProto.hasOwnProperty.call(e,f)&&t.call(n,e[f],f,e)&&(u[f]=e[f])}return u};return o.prototype.on=function(e,t,n,r){return this.eventQueue=this.eventQueue||{},this.eventQueue[e]=this.eventQueue[e]||[],this.eventQueue[e].push({callback:t,context:n,once:r}),this},o.prototype.off=function(e,t){this.eventQueue=this.eventQueue||{};if(this.eventQueue[e]==null)return;return t?(this.eventQueue[e]=s(this.eventQueue[e],function(e,n){return e.callback!==t}),this.eventQueue[e].length===0&&delete this.eventQueue[e]):delete this.eventQueue[e],this},o.prototype.fire=function(e,n){this.eventQueue=this.eventQueue||{};var r=this.eventQueue[e],s=!0;if(r){var o=t.call(arguments,1);i(r,function(t){t.callback.apply(t.context,o)===!1&&(s=!1),t.once&&this.off(e,t.callback)},this)}return s},e.extend(o),o}),define("lib/Overlay",["lib/support","lib/Event","lib/G"],function(e,t,n){"use strict";function y(e){var t,n;e?(t=(u.height()-h.height())/2+(document.documentElement.scrollTop||window.pageYOffset||0),n=(u.width()-h.width())/2+(document.documentElement.scrollLeft||window.pageXOffset||0)):(t=(u.height()-h.height())/2,n=(u.width()-h.width())/2),h.css({top:t,left:n})}function b(e,t){v&&v.length&&v.css({opacity:e||.5,"background-color":t||"#000"}).show()}function w(){v&&v.length&&v.hide()}function E(){v.css({top:document.documentElement.scrollTop||window.pageYOffset||0,left:document.documentElement.scrollLeft||window.pageXOffset||0})}function S(){v.css({width:u.width(),height:u.height()})}function x(){n.ua.isIE6&&v&&v.length&&(v.css({position:"absolute",bottom:"auto",right:"auto"}),S(),E())}function T(t){if(T.inited)return;T.inited=!0,i=t||"gui",s='<div id="blockWindow" class="'+i+'-block">                           <div class="'+i+'-block-b">                               <h4 class="'+i+'-block-hd">                                   <span id="blockTitle"></span>                                   <a class="blockClose '+i+'-block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="'+i+'-block-bd"></div>                           </div>                       </div>',h=$(s),h.appendTo("body"),p=$(a),d=$(f),g=[h,p],navigator.userAgent.match(/iPad|iPhone/i)!==null?c=navigator.userAgent.match(/[5-9]_[0-9]/)!==null:(c=e.fixed(),u.resize(function(){m&&m.pos()})),n.ua.isIE6&&u.resize(function(){v&&v.length&&m&&S()}).scroll(function(){v&&v.length&&m&&E()}),h.delegate(l,"click",function(e){e.preventDefault(),m&&m.close()})}function N(e,t,n,r){this._isOpen=!1,T.call(this,r),this._fixed=c,this._coverNeedShowed=!1,this._initedCover=!1,e&&!r&&this.open(e,t,n)}var r=0,i,s='<div id="blockWindow" class="gui-block">                           <div class="gui-block-b">                               <h4 class="gui-block-hd">                                   <span id="blockTitle"></span>                                   <a class="blockClose gui-block-close" href="#" title="关闭">X</a>                               </h4>                               <div id="blockContent" class="gui-block-bd"></div>                           </div>                       </div>',o='<iframe src="{v}" id="blockIframe" frameborder="0" width="100%"></iframe>',u=$(window),a="#blockContent",f="#blockTitle",l=".blockClose",c,h,p,d,v,m,g;return N.prototype={openCallBack:function(e){return e&&this.on("open",e,this),this},closeCallBack:function(e){return e&&this.on("close",e,this),this},afterClose:function(e){return e&&this.on("afterClose",e,this),this},afterOpen:function(e){return e&&this.on("afterOpen",e,this),this},isOpen:function(){return this._isOpen},close:function(){return this._isOpen?this.fire("close",g)?(h.hide(),this._isOpen=!1,m=null,this.fire("afterClose",g),this):this:this},open:function(e,t,r){return this.fire("open",g)?(m&&m!==this&&m.close(),m=this,this.undelegate(),t&&this.delegate(t),e&&!n.isHtml(e)&&(e=n.format(o,e)),p.html(e||""),this._title&&d.html(this._title),this._width&&h.width(this._width),h.css("position",!this._fixed||!c?"absolute":"fixed"),this.pos(),h.show(),this._isOpen=!0,r&&r.call(this,p),this.fire("afterOpen",g),this):this},delegate:function(e){if(!e.length){p.delegate(e.selector,e.event,e.func);return}return n.each(e,function(e){this.delegate(e.selector,e.event,e.func)},p),this},undelegate:function(){return p.undelegate(),this},pos:function(){return y(!this._fixed||!c),n.ua.isIE6&&this._cover&&this._cover.length&&this._cover.css(),this},title:function(e){return this._title=e,this._isOpen&&d.html(e),this},width:function(e){return this._width=e,this._isOpen&&(h.width(e),this.pos()),this},pin:function(){if(this._fixed||!c)return;return this._fixed=!0,this._isOpen&&(h.css("position","fixed"),this.pos()),this},unpin:function(){if(!this._fixed)return;return this._fixed=!1,this._isOpen&&(h.css("position","absolute"),this.pos()),this},showCover:function(e,t){if(!v||!v.length)v=$('<div style="position:fixed;top:0;left:0;right:0;bottom:0;display:none;z-index:'+((parseInt(h.css("z-index"),10)||0)-1)+';"></div>').appendTo("body"),x();if(!this._initedCover){var n=this;this.on("afterClose",function(){n._coverNeedShowed&&w()}).on("afterOpen",function(){n._coverNeedShowed&&b(n._coverOpacity,n._coverColor)}),this._initedCover=!0}return typeof e=="string"&&(t=e,e=null),e&&(this._coverOpacity=e),t&&(this._coverColor=t),b(e||this._coverOpacity,t||this._coverColor),this._coverNeedShowed=!0,this},hideCover:function(){return w(),this._coverNeedShowed=!1,this}},t.extend(N),N}),define("lib/bdShare",[],function(){var e='分享到：                            <a data-cmd="douban" class="share-db" href="#" title="分享到豆瓣">豆瓣</a>                            <a data-cmd="tsina" class="share-sina" href="#" title="分享到新浪微博">新浪微博</a>                            <a data-cmd="qzone" class="share-qzone" href="#" title="分享到QQ空间">QQ空间</a>                            <a data-cmd="weixin" class="share-wx" href="#" title="分享到微信">微信</a>                            <a data-cmd="tqq" class="share-qqmb" href="#" title="分享到腾讯微博">腾讯微博</a>                            <div class="counter"><b><s></s></b><span class="bds_count share_counter" data-cmd="count"></span></div>',t;return function(n,r){t=$(n);var i=r||e;t.html(i)}}),define("lib/jquery/easing",[],function(){jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,r,i){return t<i/2?jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n:jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}})}),define("lib/scrollto",["lib/jquery/easing"],function(e){"use strict";function n(e){var t=window.scrollX||window.pageXOffset||document.documentElement.scrollLeft,n=window.scrollY||window.pageYOffset||document.documentElement.scrollTop,r=n+(window.innerHeight||document.documentElement.clientHeight),i=t+(window.innerWidth||document.documentElement.clientWidth),s=e.scrollLeft,o=e.scrollTop,u=s+(e.width||0),a=o+(e.height||0),f=!1,l=!1;if(s!=null&&s<t||u>i)f=!0;if(o!=null&&o<n||a>r)l=!0;return f&&l?3:l?2:f?1:0}var t=$("html,body");return function(e,r,i,s){function h(){t.animate(a,l||1e3,"easeInOutCirc",r?function e(){e.exed&&r(),e.exed=!0}:null)}var o=typeof e=="number",u=o?{top:e,left:e}:e.offset?e.offset():e,a={},f,l,c;typeof i=="number"?(l=i,c=typeof s=="string"?s:"top"):typeof i=="string"?(l=1e3,c=i):(l=1e3,c=o?"top":"all");switch(c){case"all":a.scrollTop=u.top,a.scrollLeft=u.left;break;case"top":a.scrollTop=u.top;break;case"left":a.scrollLeft=u.left;break;default:return}e.jquery&&(a.width=e.width(),a.height=e.height()),f=n(a),e.jquery&&(delete a.width,delete a.height);switch(f){case 0:return r&&r(),!1;case 1:return delete a.scrollTop,h(),!0;case 2:return delete a.scrollLeft,h(),!0;case 3:return h(),!0;default:}}}),define("lib/toolTip",["lib/scrollto","lib/G"],function(e,t){"use strict";var n='<div class="{klass}" style="position:absolute;z-index:{zIndex};">                    {msg}                    <b class="{klassArrow}" style="{pointBStyle}"><s class="{klassArrow}" style="{pointSStyle}"></s></b>                </div>',r={up:"left",down:"left",right:"top",left:"top"},i={up:"top:-20px;border-bottom-style:solid;",down:"bottom:-20px;border-top-style:solid;",right:"right:-20px;border-left-style:solid;",left:"left:-20px;border-right-style:solid;"},s={up:"top:-8px;left:-9px;border-bottom-style:solid;",down:"top:-10px;left:-9px;border-top-style:solid;",right:"top:-9px;left:-10px;border-left-style:solid;",left:"top:-9px;left:-8px;border-right-style:solid;"},o=function(o,u,a){function y(){g.css({top:l[0],left:l[1],width:d}),$("b",g).css(r[h],p),v.append(g)}function b(){g.remove(),a&&a()}var f=u.msg,l=u.position,c=$(u.coordinates),h=u.direction||"up",p=u.offset||0,d=u.width,v=$(o),m=v.offset(),g=$(t.format(n,{msg:f,direction:h,zIndex:u.zIndex||999,klass:u.klass||"tooltip",klassArrow:(u.klass||"tooltip")+"-"+h,pointSStyle:"position:absolute;border-width:9px;border-color:transparent;border-style:dashed;width:0;height:0;font-size:0;"+s[h],pointBStyle:"position:absolute;border-width:10px;border-color:transparent;border-style:dashed;width:0;height:0;font-size:0;"+i[h]}));return v.css("position","relative"),c.length&&(c=c.position(),l[0]+=c.top,l[1]+=c.left),y(),u.noscroll||e({top:l[0]+m.top+(h==="up"?-10:0),left:l[1]+m.left+(h==="left"?-10:0)}),{remove:b,$toolTip:g}};return o}),define("lib/tmpl",[],function(){function e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var t={entities:e};return function(n,r){/\W/.test(n)||(n=document.getElementById(n).innerHTML);var i=new Function("funcs, obj","var p=[],print=function(){p.push.apply(p,arguments);};with(funcs){with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',entities($1),'").replace(/\t:=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}}return p.join('');");return r?i(t,r):function(e){return i(t,e)}}}),define("lib/placeholder",[],function(){"use strict";function t(e,t){var n=e.attr("type");if(e.val()==="")if(n!=="password")e.data("origColor",e.css("color")).val(t).css("color","#BBB");else{var r=parseInt(e.css("margin-right")),i=parseInt(e.css("border-right-width")),s=parseInt(e.css("padding-right")),o=e.width(),u=r+i+s+o,a=e.css("font-size"),f=e.outerHeight(),l=$('<span class="_input_placeholder">'+t+"</span>").insertAfter(e).css({color:"#BBB",fontSize:a,lineHeight:f+"px",height:f+"px",marginLeft:"-"+u+"px"});l.css("margin-right",u-l.width()+"px")}}function n(e,t){var n=e.attr("type"),r=e.val();n!=="password"&&r===t?e.val("").css("color",e.data("origColor")):n=="password"&&r===""&&e.next("span._input_placeholder").remove()}var e=document.createElement("textarea").placeholder==="";return{init:function(r){if(!e){var i=$(r),s=i.attr("placeholder");t(i,s),i.focus(function(){n(i,s)}).blur(function(){t(i,s)})}return this},submit:function(t,n,r){var i=$(t),s=$(n);return e?s.submit(r):s.submit(function(){var e=i.attr("placeholder"),t=i.val();return t===e&&i.val(""),r.apply(this,arguments)}),this},support:e}}),define("lib/toolBar",["lib/bdShare","lib/scrollto","lib/toolTip","lib/Overlay","lib/tmpl","lib/placeholder"],function(bdShare,scrollto,toolTip,Overlay,tmpl,placeholder){return toolBar=function($container,groups,questions,homesite){var resultHtml='<ul id="toolBar" class="toolBar-wrap">',html='<li class="tool-{class}"><a {gaevent} id="{id}Tool" class="{class}" href="javascript:void(0);" title="{title}"></a></li>',gaevent="";if(groups)for(var a in groups){if(typeof g_page_name!==undefined&&g_page_name==="groupPostContentPage")switch(a){case"commentTitle":gaevent='data-gaevent="post_toolbar_new:post"';break;case"gotopTitle":gaevent='data-gaevent="post_toolbar_top:post"';break;case"mygroupsTitle":gaevent='data-gaevent="post_toolbar_love:post"';break;case"replyTitle":gaevent='data-gaevent="post_toolbar_comment:post"';break;case"shareTitle":gaevent='data-gaevent="post_toolbar_share:post"'}resultHtml+=html.replace("{title}",groups[a]).replace(/{class}/g,a.substr(0,a.length-5)).replace("{id}",a.substr(0,a.length-5)).replace("{gaevent}",gaevent)}else if(questions)for(var a in questions){if(typeof g_page_name!==undefined&&g_page_name==="askContentPage")switch(a){case"questionTitle":gaevent='data-gaevent="question_toolbar_ask:question"';break;case"shareTitle":gaevent='data-gaevent="question_toolbar_share:question"';break;case"gotopTitle":gaevent='data-gaevent="question_toolbar_top:question"'}resultHtml+=html.replace("{title}",questions[a]).replace(/{class}/g,a.substr(0,a.length-5)).replace("{id}",a.substr(0,a.length-5)).replace("{gaevent}",gaevent)}else if(homesite)for(var a in homesite){if(typeof g_page_name!==undefined&&g_page_name==="articlePage")switch(a){case"casualTitle":gaevent='data-gaevent="article_toolbar_random:article"';break;case"gotopTitle":gaevent='data-gaevent="article_toolbar_backtop:article"';break;case"replyTitle":gaevent='data-gaevent="article_toolbar_comment:article"';break;case"shareTitle":gaevent='data-gaevent="article_toolbar_share:article"'}resultHtml+=html.replace("{title}",homesite[a]).replace(/{class}/g,a.substr(0,a.length-5)).replace("{id}",a.substr(0,a.length-5)).replace("{gaevent}",gaevent)}resultHtml+="</ul>",$container.append(resultHtml);if($(window).width()<1100){var window_w=$(window).width()-59;$("#toolBar").css({left:window_w,"margin-left":"0","margin-right":"5"})}$("#toolBar").hide(),$(window).scroll(function(){$(document).scrollTop()>1200?$("#toolBar").show():$("#toolBar").hide()}),$(".tool-share").bind("mouseenter",function(){var e='<a data-cmd="douban" class="gicon-share-db" href="#" title="分享到豆瓣">豆瓣</a>                            <a data-cmd="tsina" class="gicon-share-sina" href="#" title="分享到新浪微博">新浪微博</a>                            <a data-cmd="qzone" class="gicon-share-qzone" href="#" title="分享到QQ空间">QQ空间</a>                            <a data-cmd="weixin" class="gicon-share-weixin" href="#" title="分享到微信">微信</a>                            <a data-cmd="tqq" class="gicon-share-qqmb" href="#" title="分享到腾讯微博">腾讯微博</a>';tooltip=toolTip($(".tool-share"),option={position:[0,-236],width:205,klass:"bdsharebuttonbox"}),$(".tool-share .bdsharebuttonbox").attr("data-tag","shareMain"),window._bd_share_main.init(),bdShare(".tool-share .bdsharebuttonbox",e)}),$(".tool-share").mouseleave(function(){$(".tool-share .bdsharebuttonbox").remove()}),$("#gotopTool").click(function(e){e.preventDefault(),scrollto(0)}),$("#casualTool").attr("href","http://www.guokr.com/article/goodluck");if(!ukey)return $("#commentTool").attr("data-login","yes"),$("#mygroupsTool").attr("data-login","yes"),$("#replyTool").attr("data-login","yes"),$("#questionTool").attr("data-login","yes"),!1;$("#questionTool").attr({href:"/questions/new",target:"_blank"}),$("#commentTool").click(function(){function join(){var e='<div class="gui-block-apply">                            <p class="fl" style="color:red"></p>                            <p class="text">只有加入这个小组才能获得发帖权限</p>                            <p class="fr">                                <a href="javascript: void 0;" class="join-btn" id="joinBtn">确认加入并发帖</a>                                <a href="javascript: void 0;" class="blockClose">取消</a>                            </p>                         </div>',t=new Overlay;t.open(e,null,function(){t.title("提示"),$("#joinBtn").click(function(e){e.preventDefault(),t.close(),joinGroup(),window.open(tool_bar_data.create_url,"_blank")})})}function joinGroup(cb){$.ajax({url:"/apis/group/member.json",data:{group_id:g_group_id},type:"POST",async:!1,success:function(e){e.ok&&cb&&cb()},error:function(data){var json=eval("("+data.responseText+")");json.error_code==241001?alert("该小组不存在"):json.error_code==241016?alert("你不是这个小组的成员"):json.error_code==241017?alert("你是这个小组的管理员，不能退出"):json.error_code==241014&&alert("你在这个小组的黑名单里，不能加入")},dataType:"json"})}function applyJoinGroup(e,t){$.ajax({url:"/apis/group/member_application.json",data:{group_id:g_group_id,annotation:e},type:"POST",success:function(e){e.ok&&t&&t()},dataType:"json"})}function joinBt(){var e={applyBlock:'<div class="gui-block-apply">                                <textarea class="gttxt" placeholder="说点什么给管理员..." id="applyDetail"></textarea>                                <p class="fl" style="color:red"></p>                                <p class="fr">                                    <a href="javascript: void 0;" class="gnbtn" id="applyBtn">提交</a>                                    <a href="javascript: void 0;" class="blockClose">取消</a>                                </p>                             </div>',applied:'<span class="state-btn">已申请，待审核</span>'},t={applyTextTooLong:"申请不能超过250个字！",applyEmpty:"说点什么，让管理员了解你"},n=new Overlay;n.open(e.applyBlock,null,function(){return n.title("加入这个小组需要审核哦，说说你的理由吧"),placeholder.init("#applyDetail"),$("#applyBtn").click(function(r){r.preventDefault();var i=$("#applyDetail"),s=i.val();applyTip=$(this).parent().prev(),placeholder.support||s===i.attr("placeholder")&&(i.val(""),s="");if(s.length>250)return applyTip.text(t.applyTextTooLong),!1;if(!s.length)return applyTip.text(t.applyEmpty),!1;applyJoinGroup(s,function(){n.close(),$("#joinBt").replaceWith(e.applied)})}),!0})}g_join_option=="all"&&g_is_member==0?join():g_join_option=="apply"&&g_is_member==0?joinBt():window.open(tool_bar_data.create_url,"_blank")}),$("#replyTool").attr("href","#commentsReplyer");var mygroupsHtml;(function(){$.ajax({url:"/apis/group/favorite.json?offset&limit=12",type:"GET",success:function(e){var t=e.result,n,r,i;myGroupsHtml='<div class="myGroups-wrap">';if(t.length>0)for(var s=0;s<t.length;s++)n=t[s].name,r=t[s].url,i='<a href="<%=groupsUrl%>"><%=groupsName%></a>',i=tmpl(i,{groupsUrl:r,groupsName:n}),myGroupsHtml+=i;else myGroupsHtml+='<a class="add-groups" href="http://www.guokr.com/group/all/">加入一些有趣的小组</a>';myGroupsHtml+='<a class="mygroups-set" target="_blank" href="/group/user/joined/">设置常去的小组</a></div>'},dataType:"json"})})(),$(".tool-mygroups").bind("mouseenter",function(){toolTip($("#toolBar .tool-mygroups"),option={msg:myGroupsHtml,position:[0,-236],width:215}),$(".tooltip .tooltip-up").remove()}),$(".tool-mygroups").mouseleave(function(){$(".tool-mygroups .tooltip").remove()})},toolBar}),define("lib/Anime",["lib/support"],function(e){"use strict";return{addCssString:function(e){var t=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(t),t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=e:t.innerHTML+=e},loading:function(e){e.jquery||(e=$(e))},flipping:function(t,n,r,i){function u(){i&&i(t)}n=n||500,r=r||0;var s=".flip-container {                        -webkit-perspective: 1000;                        -moz-perspective: 1000;                        -o-perspective: 1000;                        perspective: 1000;                    }                    .gui-anime-flipping {                        -webkit-transform: rotateY(180deg);                        -moz-transform: rotateY(180deg);                        -o-transform: rotateY(180deg);                        transform: rotateY(180deg);                    }                    .flipper {                        -webkit-transition: <t>s;                        -webkit-transform-style: preserve-3d;                        -moz-transition: <t>s;                        -moz-transform-style: preserve-3d;                        -o-transition: <t>s;                        -o-transform-style: preserve-3d;                        transition: <t>s;                        transform-style: preserve-3d;                        position: relative;                    }                    .front, .back {                        -webkit-backface-visibility: hidden;                        -moz-backface-visibility: hidden;                        -o-backface-visibility: hidden;                        backface-visibility: hidden;                        position: absolute;                        top: 0;                        left: 0;                    }                    .front {                        z-index: 2;                    }                    .back {                        -webkit-transform: rotateY(180deg);                        -moz-transform: rotateY(180deg);                        -o-transform: rotateY(180deg);                        transform: rotateY(180deg);                }";if(!e.cssanimation()){t.children(":visible").fadeOut(n/2,function(){$(this).siblings().fadeIn(n/2)}),i&&i(t);return}if(!this.flippingCssAdded){try{this.addCssString(G.format(s,{t:n/1e3,d:r/1e3},/<([^<>]+)>/g))}catch(o){i&&i(t);return}this.flippingCssAdded=!0}t.find(".hide").removeClass("hide"),t.hasClass("gui-anime-flipping")?(t.removeClass("gui-anime-flipping"),setTimeout(function(){t.find(".back").addClass("hide")},n/2)):(t.addClass("gui-anime-flipping"),setTimeout(function(){t.find(".front").addClass("hide")},n/2)),setTimeout(u,n+r)},focusing:function(t,n,r,i){function o(){t.removeClass("gui-anime-focusing"),n&&n(t)}if(!e.cssanimation()){n&&n(t);return}r=r||500,i=i||0;if(!this.focusingCssAdded){try{this.addCssString(G.format("@-webkit-keyframes guiFocusing {                            0%{-webkit-transform: scale(4); opacity:0;}                            100%{-webkit-transform: scale(1); opacity:1;}                        }                        @-moz-keyframes guiFocusing {                            0%{-moz-transform: scale(4); opacity:0;}                            100%{-moz-transform: scale(1); opacity:1;}                        }                        @-o-keyframes guiFocusing {                            0%{-o-transform: scale(4); opacity:0;}                            100%{-o-transform: scale(1); opacity:1;}                        }                        @-ms-keyframes guiFocusing {                            0%{-ms-transform: scale(4); opacity:0;}                            100%{-ms-transform: scale(1); opacity:1;}                        }                        @keyframes guiFocusing {                            0%{transform: scale(4); opacity:0;}                            100%{transform: scale(1); opacity:1;}                        }                        .gui-anime-focusing {                            -webkit-animation-name: guiFocusing;                            -webkit-animation-duration: <t>s;                            -webkit-animation-delay: <d>s;                            -webkit-animation-timing-function: ease-out;                            -moz-animation-name: guiFocusing;                            -moz-animation-duration: <t>s;                            -moz-animation-delay: <d>s;                            -moz-animation-timing-function: ease-out;                            animation-name: guiFocusing;                            animation-duration: <t>s;                            animation-delay: <d>s;                            animation-timing-function: ease-out;                        }",{t:r/1e3,d:i/1e3},/<([^<>]+)>/g))}catch(s){n&&n(t);return}this.focusingCssAdded=!0}t.addClass("gui-anime-focusing"),setTimeout(o,r+i)},shaking:function(t,n,r,i){function o(){t.removeClass("gui-anime-shaking"),t.removeClass("gui-anime-shaking-inline"),n&&n(t)}if(!e.cssanimation()){n&&n(t);return}r=r||500,i=i||0;if(!this.shakingCssAdded){try{this.addCssString(G.format("@-webkit-keyframes guiShaking {                            0% { -webkit-transform: translate(2px, 1px) rotate(0deg);transform: translate(2px, 1px) rotate(0deg); }                            10% { -webkit-transform: translate(-1px, -2px) rotate(-1deg);transform: translate(-1px, -2px) rotate(-1deg); }                            20% { -webkit-transform: translate(-3px, 0px) rotate(1deg);transform: translate(-3px, 0px) rotate(1deg); }                            30% { -webkit-transform: translate(0px, 2px) rotate(0deg);transform: translate(0px, 2px) rotate(0deg); }                            40% { -webkit-transform: translate(1px, -1px) rotate(1deg);transform: translate(1px, -1px) rotate(1deg); }                            50% { -webkit-transform: translate(-1px, 2px) rotate(-1deg);transform: translate(-1px, 2px) rotate(-1deg); }                            60% { -webkit-transform: translate(-3px, 1px) rotate(0deg);transform: translate(-3px, 1px) rotate(0deg); }                            70% { -webkit-transform: translate(2px, 1px) rotate(-1deg);transform: translate(2px, 1px) rotate(-1deg); }                            80% { -webkit-transform: translate(-1px, -1px) rotate(1deg);transform: translate(-1px, -1px) rotate(1deg); }                            90% { -webkit-transform: translate(2px, 2px) rotate(0deg);transform: translate(2px, 2px) rotate(0deg); }                            100% { -webkit-transform: translate(1px, -2px) rotate(-1deg);transform: translate(1px, -2px) rotate(-1deg); }                          }                          @-moz-keyframes guiShaking {                            0% { -moz-transform: translate(2px, 1px) rotate(0deg);transform: translate(2px, 1px) rotate(0deg); }                            10% { -moz-transform: translate(-1px, -2px) rotate(-1deg);transform: translate(-1px, -2px) rotate(-1deg); }                            20% { -moz-transform: translate(-3px, 0px) rotate(1deg);transform: translate(-3px, 0px) rotate(1deg); }                            30% { -moz-transform: translate(0px, 2px) rotate(0deg);transform: translate(0px, 2px) rotate(0deg); }                            40% { -moz-transform: translate(1px, -1px) rotate(1deg);transform: translate(1px, -1px) rotate(1deg); }                            50% { -moz-transform: translate(-1px, 2px) rotate(-1deg);transform: translate(-1px, 2px) rotate(-1deg); }                            60% { -moz-transform: translate(-3px, 1px) rotate(0deg);transform: translate(-3px, 1px) rotate(0deg); }                            70% { -moz-transform: translate(2px, 1px) rotate(-1deg);transform: translate(2px, 1px) rotate(-1deg); }                            80% { -moz-transform: translate(-1px, -1px) rotate(1deg);transform: translate(-1px, -1px) rotate(1deg); }                            90% { -moz-transform: translate(2px, 2px) rotate(0deg);transform: translate(2px, 2px) rotate(0deg); }                            100% { -moz-transform: translate(1px, -2px) rotate(-1deg);transform: translate(1px, -2px) rotate(-1deg); }                          }                          @keyframes guiShaking {                            0% { transform: translate(2px, 1px) rotate(0deg); }                            10% { transform: translate(-1px, -2px) rotate(-1deg); }                            20% { transform: translate(-3px, 0px) rotate(1deg); }                            30% { transform: translate(0px, 2px) rotate(0deg); }                            40% { transform: translate(1px, -1px) rotate(1deg); }                            50% { transform: translate(-1px, 2px) rotate(-1deg); }                            60% { transform: translate(-3px, 1px) rotate(0deg); }                            70% { transform: translate(2px, 1px) rotate(-1deg); }                            80% { transform: translate(-1px, -1px) rotate(1deg); }                            90% { transform: translate(2px, 2px) rotate(0deg); }                            100% { transform: translate(1px, -2px) rotate(-1deg); }                          }                          .gui-anime-shaking-inline,                          .gui-anime-shaking {                            display:block;                            position: relative;                            -webkit-animation-name: guiShaking;                            -webkit-animation-duration: <t>s;                            -webkit-animation-delay: <d>s;                            -webkit-transform-origin:50% 50%;                            -webkit-animation-iteration-count: 1;                            -webkit-animation-timing-function: linear;                            -moz-animation-name: guiShaking;                            -moz-animation-duration: <t>s;                            -moz-animation-delay: <d>s;                            -moz-transform-origin:50% 50%;                            -moz-animation-iteration-count: 1;                            -moz-animation-timing-function: linear;                            animation-name: guiShaking;                            animation-duration: <t>s;                            animation-delay: <d>s;                            transform-origin:50% 50%;                            animation-iteration-count: 1;                            animation-timing-function: linear;                          }                          .gui-anime-shaking-inline {                            display: inline-block;                        }",{t:r/1e3,d:i/1e3},/<([^<>]+)>/g))}catch(s){n&&n(t);return}this.shakingCssAdded=!0}t.css("display")==="inline"?t.addClass("gui-anime-shaking-inline"):t.addClass("gui-anime-shaking"),setTimeout(o,r+i)}}}),define("lib/Count",["lib/Anime"],function(e){"use strict";function n(e,n,r,i){var s=t.exec(e.text()),o;o=+s[2]+n,r!=null&&(o=Math.max(r,o)),i!=null&&(o=Math.min(i,o)),e.text(s?(s[1]||"")+o+(s[3]||""):"")}function r(e,n,r,i){var s=t.exec(e.text());r!=null&&(n=Math.max(r,n)),i!=null&&(n=Math.min(i,n)),e.text(s?(s[1]||"")+n+(s[3]||""):"")}var t=/([^\-0-9]+)?([\-0-9]+)([\w\W]+)?/;return function(t,i,s){var o=$(t);this.hasTarget=o.length>0,this.add=function(t,r){return n(o,t,i,s),r&&e[r](o),this},this.set=function(e){return r(o,e,i,s),this}}}),function(){function n(e){this.message=e}var e=typeof exports!="undefined"?exports:this,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){var r=String(e);for(var i,s,o=0,u=t,a="";r.charAt(o|0)||(u="=",o%1);a+=u.charAt(63&i>>8-o%1*8)){s=r.charCodeAt(o+=.75);if(s>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|s}return a}),e.atob||(e.atob=function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i=0,s,o,u=0,a="";o=r.charAt(u++);~o&&(s=i%4?s*64+o:o,i++%4)?a+=String.fromCharCode(255&s>>(-2*i&6)):0)o=t.indexOf(o);return a})}(),define("Base64",function(){}),function(e){"use strict";function a(e){var t=0,n;for(n=0;n<e.length;n++)t=e.charCodeAt(n)+(t<<6)+(t<<16)-t<<0;return t}function f(){return e.devicePixelRatio||1}function l(e,t,n,r){var i,s,o,u="",f=e.length;t=t.replace(/^\/+/,""),f>1?(s=a(t)%f,s<0&&(s+=3),o=e[s]):o=e[0],i="http://"+o+"/"+encodeURI(t);if(n&&r)u+="/1";else if(n||r)u+="/3";return n&&(u+="/w/"+n),r&&(u+="/h/"+r),u!==""&&(i=i+"?imageView2"+u),i}function c(e){return e.indexOf("dev.guokr.com")>0}function h(e,t,n){var s,a,f,h,p=r.createElement("a"),d=c(e)?o:u;p.href=e,h=p.pathname;if(h.indexOf("/image/")===0)h=h.slice(7);else if(h.indexOf("image/")===0)h=h.slice(6);else if(h.indexOf("/thumbnail/")===0||h.indexOf("thumbnail/")===0)f=e.replace(i,"$2"),s=f.slice(-2),a={dJ:".gif",pQ:".jpg",BO:".png"}[s],h=f+a;return l(d,h,t,n)}function p(e,t,r){var o={src:e,width:null,height:null,"data-hashkey":null,"data-orig-width":null,"data-orig-height":null};if(!i.test(e))return s.test(e)&&(o.src=h(e)),o;o.src=e=h(e);var u=f(),a=e.replace(i,"$2"),l=n(a.replace(/_/g,"/").replace(/-/g,"+")),c=l.charCodeAt(32)+l.charCodeAt(33)*256+l.charCodeAt(34)*65536+l.charCodeAt(35)*16777216,p=l.charCodeAt(36)+l.charCodeAt(37)*256+l.charCodeAt(38)*65536+l.charCodeAt(39)*16777216;o["data-hashkey"]=a,o["data-orig-width"]=c,o["data-orig-height"]=p;if(t===undefined&&r>0)t=r*c/p;else if(r===undefined&&t>0)r=t*p/c;else if(t<1||r<1)return o;if(c<t*u||p<r*u)u=1,c>t&&p>r?u=Math.min(c/t,p/r):(t=c>t?t:c,r=p>r?r:p);o.width=Math.round(t),o.height=Math.round(r),t=Math.round(t*u),r=Math.round(r*u);if(Math.abs(c-t)>1||Math.abs(p-r)>1)o.src=h(e,t,r);return o}function d(e){if(i.test(e)||s.test(e))e=h(e);return e}var t,n=e.atob||require("Base64").atob,r=e.document||require("jsdom").jsdom(),i=/^http:\/\/(img1\.(?:\w+\.)?guokr\.com(?:\:\d+)?\/(?:image|thumbnail)|\d+\.im(?:\.dev)?\.guokr\.com(?:\:\d+)?)\/([\w-]{56})(?:_\d*x\d*)?\.(jpg|png|gif)(\?.*|$)/,s=/^(http:\/\/(?:\w+\.)*guokr\.com(?:\:\d+)?)?(\/gkimage\/[a-z0-9\/]{15}\.(gif|jpe?g|png))(\?.*|$)/,o=["1.im.dev.guokr.com","2.im.dev.guokr.com","3.im.dev.guokr.com"],u=["1.im.guokr.com","2.im.guokr.com","3.im.guokr.com"];t={sdbm:a,thumbnail:p,original:d,public_url:h},typeof define=="function"&&define.amd?define("lib/gkimage",["Base64"],function(){return t}):typeof e!="undefined"?(typeof module!="undefined"&&module.exports&&(e=module.exports=t),e.gkimage=t):window.gkimage=t}(typeof exports=="object"&&exports||this),define("lib/gbbcode",["jquery","lib/gkimage"],function(t,n){"use strict";function u(e){return/www\.tudou\.com/.test(e)?e+="&autoPlay=true":/www\.56\.com/.test(e)?e+="?auto=1":/player\.video\.qiyi\.com/.test(e)&&(e+="-autoPlay=1"),e}function a(e){var r=/src="[^"]+"/;e.each(function(){var e,r,i,s,o,u=t(this),a=u.parents(".gbbcode-content"),f=u.data("image"),l=t("<img>");u.replaceWith(l),i=l.css("max-width"),i!==null&&i.slice(-2)==="px"?i=parseInt(i):i=a.width(),s=i,o=l.parent(),o.css("display")==="block"&&(s=o.width()||s),r=Math.min(i,s),e=n.thumbnail(f,r),e.width===null?l.attr("src",e.src):l.attr(e)})}function f(e){e.each(function(){var e=t(this);e.attr("src",e.attr("src").replace(/\.svg$/,".png"))})}function l(e,r){var s=[];e.each(function(){var e=t(this).data("video-loaded"),n=t(this).data("video");e!==!0&&s.indexOf(n)<0&&s.push(n)});if(s.length===0)return;t.ajax({url:"/apis/shortener/url.json",type:"post",data:{url:s},dataType:"json",traditional:!0,success:function(o){if(!o.ok)return;s=[],e.each(function(){var e=t(this),r=e.parents(".gbbcode-content"),s=e.data("video"),a=o.result[s].extradata,f=o.result[s].urltype,l=e.width(),c=e.height();if(!a||a.player_type===undefined)return;var h,p,d=a.preview_image,v=u(a.player_url),m=a.player_type,g=a.title+" - "+f.title,y=n.thumbnail(d,l,c);e.attr("title",g).css("background-image","url("+y.src+")").bind("click touch",function(n){var s,o;if(m==="flash"&&i===!1){e.attr("target","_blank");return}n.preventDefault(),e.css("display","none"),p===undefined?p=t('<a data-collapsed href="javascript: void(0)">↑ 收起</a>').data("collapsed",!1).insertAfter(e).bind("click touch",function(t){t.preventDefault();if(p.data("collapsed")===!0)return;h.remove(),h=undefined,e.css("display","block"),p.css("display","none").data("collapsed",!0)}):p.css("display","block").data("collapsed",!1);if(h!==undefined)return;h=t("<iframe>").attr({src:v,frameborder:0,allowfullscreen:!0}).insertAfter(e),o=h.css("max-width"),o!==null&&o.slice(-2)==="px"?o=parseInt(o):o=r.width(),s=Math.min(o,h.parent().width()||o),h.attr({width:s,height:s*9/12})}).data("video-loaded",!0)}),r instanceof Function&&r()}})}function c(e){e.each(function(){var e=t(this);e.bind("load",function(){e.height(e.contents().find("body").height()+50)}),e.height(e.contents().find("body").height()+50)})}var r=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1"),i=!1;try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");s&&(i=!0)}catch(o){navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!==undefined&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(i=!0)}return function(e){e===undefined&&(e={}),e.imageSelector=e.imageSelector||"noscript[data-image]",e.videoSelector=e.videoSelector||"a[data-video]",e.mathSelector=e.mathSelector||"img[data-math]",e.pollSelector=e.pollSelector||"iframe[data-poll]",a(t(e.imageSelector)),l(t(e.videoSelector)),c(t(e.pollSelector)),r!==!0&&f(t(e.mathSelector))}}),define("lib/Menu",["lib/tmpl","lib/Event"],function(e,t){"use strict";function r(t,r,i,s){$.isFunction(i)||(s=i,i=null),this.$menu=$(e(n,{list:r,useFocus:s.useFocus,convert:s.convert,className:s.className||""})),this.$list=this.$menu.find("li"),this.selected=-1,this.data=r,this.doneCallBack=i;var o=this;o.$menu.appendTo(t).delegate("li","mouseenter",function(){var e=o.$list.index(this);if(o.selected===e)return;o.select(e,s.disableMouseChangeEvent)}).delegate("li","click",function(){var e=o.$list.index(this);o.selected=e,o.done()}).mouseleave(function(){o.select(-1,s.disableMouseChangeEvent)});if(s.useFocus){var u=o.$menu.children("a");u.keydown(function(e){e.preventDefault();switch(e.which){case 13:o.done();break;case 27:o.hide();break;case 40:o.down();break;case 38:o.up()}}).focus(function(){o.show(),o.selected===-1&&o.select(0)}),this.focus=function(){return u.focus(),this}}}var n='<div class="gui-menu <%=className%>">                        <% if (useFocus) { %>                            <a href="#" tabindex="0" hidefocus="true" class="gui-menu-focus">&nbsp;</a>                        <% } %>                        <ul class="gui-menu-list">                            <% for (var i=0;i<list.length;i++) { %>                            <li>                                <% if (typeof convert !== "undefined") { %>                                    <%:=convert(list[i])%>                                <% } else { %>                                    <%=list[i]%>                                <% } %>                            </li>                            <% } %>                        </ul>                    </div>';return t.extend(r),r.prototype.up=function(){var e=this.selected-1;return e<0&&(e=this.data.length-1),this.select(e),this},r.prototype.down=function(){var e=this.selected+1;return e>this.data.length-1&&(e=0),this.select(e),this},r.prototype.select=function(e,t){if(e==null)return this.data[this.selected];if(e<-1||e>=this.data.length)e=-1;return!t&&this.selected!==e&&!this.fire("change",this.data[e])?this:(this.selected=e,this.$list.removeClass("selected"),this.selected!==-1&&$(this.$list[this.selected]).addClass("selected"),this)},r.prototype.remove=function(){if(!this.fire("remove"))return;this.$menu&&this.$menu.remove(),delete this.$menu,delete this.$list,delete this.selected,delete this.data,delete this.doneCallBack},r.prototype.show=function(){return this.$menu.show(),this},r.prototype.hide=function(){return this.fire("hide")?(this.$menu.hide(),this):this},r.prototype.onChange=function(e){return this.on("change",e,this),this},r.prototype.onRemove=function(e){return this.on("remove",e,this),this},r.prototype.onHide=function(e){return this.on("hide",e,this),this},r.prototype.done=function(){return this.doneCallBack&&this.doneCallBack.call(this,this.data[this.selected]),this},r}),define("lib/Trie",[],function(){"use strict";function t(e,t){var n=[];for(var r=0,i=e.length;r<i;r++)e[r].indexOf(t)!==-1&&n.push(e[r]);return n}function n(e){var t=[],n={},r;for(var i=0,s=e.length;i<s;i++)r=e[i],n[r]||(t.push(r),n[r]=!0);return t}function r(r,i,s,o){function a(n,r,s){if(n.length===0){f(s,e-r);return}var o;(o=s[n.slice(0,1)])?(o.$&&n.length===1&&(u=u.concat(o.$)),a(n.slice(1),r,o)):s.$&&(u=u.concat(t(s.$,i)))}function f(e,t){if(t===0)return;var n;for(var r in e)n=e[r],n.$&&(u=u.concat(n.$)),f(n,t-1)}var u=[];i=new String(i),o&&(i=o(i)),a(i,i.length,r),s(n(u))}function i(e){return typeof e=="object"?e===null?"null":/\[object (\w+)\]/.exec(toString.call(e))[1].toLowerCase():typeof e}var e=5;return function(t,n,s){var o,u=!1,a=!1,f,l,c="";typeof g_obj_id!="undefined"&&(c=g_obj_id),i(t)==="function"?u||(u=!0,t(e,c,function(e){u=!1,o=s?s(e):e,f&&l&&r(o,f,l,n)},function(){a=!0,u=!1,s&&s()})):o=t,this.calculate=function(e,t){if(!e||a){t();return}u?(f=e,l=t):r(o,e,t,n)},this.isLoading=function(){return u},this.isFailed=function(){return a}}}),define("lib/cookies",{get:function(e){"use strict";if(document.cookie.length>0){var t,n=document.cookie.indexOf(e+"=");if(n!=-1)return n=n+e.length+1,t=document.cookie.indexOf(";",n),t==-1&&(t=document.cookie.length),unescape(document.cookie.substring(n,t))}return""},set:function(e,t,n,r){"use strict";return document.cookie=e+"="+escape(t)+(n==null?"":";expires="+n.toGMTString())+";path="+(r||"/"),this},remove:function(e,t){"use strict";var n=new Date;n.setTime(n.getTime()-1);var r=this.get(e);r!=null&&(document.cookie=e+"="+r+";expires="+n.toGMTString()+";path="+(t||"/"))}}),define("lib/accessToken",["lib/cookies"],function(e){"use strict";var t,n=window.location.host,r=window.url_re_signin||"",i=window.client_id||32353;return t=e.get("_"+i+"_access_token"),{checkToken:function(){n=window.location.host,t=e.get("_"+i+"_access_token")},getToken:function(){return t}}}),define("lib/TextUtils",[],function(){"use strict";function c(e,t){var n=typeof e[t];return n==="function"||n=="object"&&!!e[t]||n=="unknown"}function h(t,n){return typeof t[n]!=e}function p(e,t){return typeof e[t]=="object"&&!!e[t]}function d(e){window.console&&window.console.log&&window.console.log("TextInputs module for Rangy not supported in your browser. Reason: "+e)}function v(t,n,r){return n<0&&(n+=t.value.length),typeof r==e&&(r=n),r<0&&(r+=t.value.length),{start:n,end:r}}function m(e,t,n){return{start:t,end:n,length:n-t,text:e.value.slice(t,n)}}function g(){return p(document,"body")?document.body:document.getElementsByTagName("body")[0]}function w(e,t){return function(){var n=this.jquery?this[0]:this,r=n.nodeName.toLowerCase();if(n.nodeType==1&&(r=="textarea"||r=="input"&&n.type=="text")){var i=[n].concat(Array.prototype.slice.call(arguments)),s=e.apply(this,i);if(!t)return s}if(t)return this}}var e="undefined",t,n,r,i,s,o,u,a,f,l,y=document.createElement("textarea");g().appendChild(y);if(h(y,"selectionStart")&&h(y,"selectionEnd")&&c(y,"setSelectionRange"))t=function(e){var t=e.selectionStart,n=e.selectionEnd;return m(e,t,n)},n=function(e,t,n){var r=v(e,t,n);e.focus(),e.setSelectionRange(r.start,r.end)},f=function(e,t){t?e.selectionEnd=e.selectionStart:e.selectionStart=e.selectionEnd};else{if(!(c(y,"createTextRange")&&p(document,"selection")&&c(document.selection,"createRange"))){g().removeChild(y),d("No means of finding text input caret position");return}t=function(e){e.focus();var t=0,n=0,r,i,s,o,u=document.selection.createRange();return u&&u.parentElement()==e&&(s=e.value.length,r=e.value.replace(/\r\n/g,"\n"),i=e.createTextRange(),i.moveToBookmark(u.getBookmark()),o=e.createTextRange(),o.collapse(!1),i.compareEndPoints("StartToEnd",o)>-1?t=n=s:(t=-i.moveStart("character",-s),t+=r.slice(0,t).split("\n").length-1,i.compareEndPoints("EndToEnd",o)>-1?n=s:(n=-i.moveEnd("character",-s),n+=r.slice(0,n).split("\n").length-1))),m(e,t,n)};var b=function(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)};n=function(e,t,n){var r=v(e,t,n),i=e.createTextRange(),s=b(e,r.start);i.collapse(!0),r.start==r.end?i.move("character",s):(i.moveEnd("character",b(e,r.end)),i.moveStart("character",s)),i.select()},f=function(e,t){var n=document.selection.createRange();n.collapse(t),n.select()}}g().removeChild(y),i=function(e,t,r,i){var s;t!=r&&(s=e.value,e.value=s.slice(0,t)+s.slice(r)),i&&n(e,t,t)},r=function(e){var n=t(e);i(e,n.start,n.end,!0)},a=function(e){var r=t(e),i;return r.start!=r.end&&(i=e.value,e.value=i.slice(0,r.start)+i.slice(r.end)),n(e,r.start,r.start),r.text},l=function(e,t){t==null&&(t=e.value.length),n(e,t,t)},s=function(e,t,r,i){var s=e.value,o;e.value=s.slice(0,r)+t+s.slice(r),i&&(o=r+t.length,n(e,o,o))},o=function(e,r){var i=t(e),s=e.value;e.value=s.slice(0,i.start)+r+s.slice(i.end);var o=i.start+r.length;n(e,o,o)},u=function(e,r,i){var s=t(e),o=e.value;e.value=o.slice(0,s.start)+r+s.text+i+o.slice(s.end);var u=s.start+r.length,a=u+s.length;n(e,u,a)},$.fn.extend({getSelection:w(t,!1),setSelection:w(n,!0),collapseSelection:w(f,!0),deleteSelectedText:w(r,!0),deleteText:w(i,!0),extractSelectedText:w(a,!1),insertText:w(s,!0),replaceSelectedText:w(o,!0),surroundSelectedText:w(u,!0),insertCaret:w(l,!0)})}),define("lib/at",["lib/tmpl","lib/Menu","lib/Trie","lib/accessToken","lib/TextUtils"],function(e,t,n,r,i){"use strict";function S(e){!$.contains(l[0],e.target)&&c[0]!==e.target&&C()}function x(e,t,n,r){$.ajax({type:"get",url:"/apis/community/relationship/following_nickname.json",data:{access_token:w},success:function(e){e.ok&&n(e.result)},error:r,dataType:"json"})}function T(){if(T.inited)return;f=$("body"),l=$(s).appendTo(f),c?l.css("marginTop","30px"):c=l.prepend(o).find("input"),h=l.children("div"),g=new n(x,function(e){return e.toLowerCase().replace(b,"")},function(t){return h.html(e(u,{tip:t==null?null:E.tip,noneTip:t==null?E.loadFailTip:null})),m&&m.remove(),t});var t=!1;c.keydown(function(e){switch(e.which){case 13:e.preventDefault(),C(c.val()),t=!1;break;case 27:e.preventDefault(),C(),t=!1;break;case 40:m&&(t=!0,e.preventDefault(),m.down());break;case 38:m&&(t=!0,e.preventDefault(),m.up());break;case 8:c.val().length===0&&(e.preventDefault(),C()),t=!1;break;default:setTimeout(function(){var e=c.val();e&&e.slice(e.length-1).match(y)&&(e=e.replace(y,""),C(e))}),t=!1}}),window.addEventListener?c[0].addEventListener("input",function(){N(c.val())},!1):window.attachEvent&&c[0].attachEvent("onpropertychange",function(){!t&&window.event.propertyName=="value"&&N(c.val())}),T.inited=!0}function N(n){var r=null,i=null;g.calculate(n,function(n){g.isFailed()?r=E.loadFailTip:g.isLoading()?i=E.loadingTip:n==null?i=E.tip:n.length===0&&(r=E.noneTip),h.html(e(u,{tip:i,noneTip:r})),m&&m.remove(),n&&n.length>0&&(n=n.slice(0,10),m=(new t(h,n,function(e){C(e)},{useFocus:!0,disableMouseChangeEvent:!0})).onChange(function(e){c.val(e)}).onHide(function(){c.insertCaret()}))})}function C(e){e==="妹子"&&alert("﹁_﹁，出门右转是性情！"),l.css("left",-99999),e?p(e+" "):d(),f.unbind("click",S),a&&a.unbind("click",S),v=!1}var s='<div class="gui-at"><div></div></div>',o='<input class="gbtxt"/>',u='<% if(tip) { %><p><%=tip%></p><% } %><% if (noneTip) { %><p class="gui-at-none"><%=noneTip%></p><% } %>',a,f,l,c,h,p,d,v=!1,m,g,y=/[^\u3400-\u4db5\u4e00-\u9fcba-zA-Z0-9._\-]/g,b=/[^\u3400-\u4db5\u4e00-\u9fcba-z0-9]/g,w=r.getToken(),E={tip:"输入对方昵称来@TA",loadFailTip:"获取失败，请刷新页面重试",loadingTip:"获取用户列表中...",noneTip:"关注列表无匹配，回车键确认输入"};return function(t,n,r,i,s){if(v)return;v=!0,p=n,d=r,i&&(a=i),s&&(c=s),setTimeout(function(){T(),l.css({top:t.top,left:t.left,display:"block"}),s||c.val(""),c.focus(),N(c.val()),f.click(S),a&&a.click(S)})}}),define("lib/AliasUtils",["lib/toolTip","lib/G"],function(e,t){"use strict";function r(e){var t=e!==undefined;if(n!==undefined){if(t){e(n);return}return n}$.ajax({url:"/apis/auth/external_oauth2.json",type:"GET",async:t,success:function(r){if(r.ok){(g_page_name==="postEditPage"||g_page_name==="askContentPage")&&i();var s=r.result,o={is_disabled:s.weibo===undefined},u={is_disabled:s.douban===undefined},a={is_disabled:!1,is_expired:!1};o.is_expired=o.is_disabled?!0:!s.weibo.access_token,u.is_expired=u.is_disabled?!0:!s.douban.access_token,n={weibo:o,douban:u,activity:a},t&&e(n)}},dataType:"json"});if(!t)return n}function i(){ukey&&$.ajax({url:"/apis/flowingboard/item/white_list.json",type:"GET",async:!0,success:function(e){if(e.ok){var t=e.result;for(var r in t)if(ukey===t[r].ukey){!n.weibo.is_disabled&&!n.weibo.is_expired&&$("#shareXl").attr("checked",!0),!n.douban.is_disabled&&!n.douban.is_expired&&$("#shareDb").attr("checked",!0);break}}},dataType:"json"})}var n;return{checkAlias:function(n){var i=r();if(i===undefined)return;var s,o,u,a,f,l=$(n),c=!1;t.each(i,function(e,t){(e.is_disabled||e.is_expired)&&$("input[value="+t+"]",l).length&&(c=!0)}),c&&(o='<div class="tip">                                    <p style="margin-bottom:2px;line-height:1.5">{msg}</p>                                     <p>                                        <a href="{url}" target="_blank" class="sw_btn-ext" style="margin-right:5px;color: #ccc;">确定</a>                                        <a href="javascript:void 0;" class="closeBindTip" style="color:#ccc;">关闭</a>                                     </p>                                </div>',s={weibo:{disabled:"去新浪微博授权后才可以发布，点击确定前往相应页面。",expired:"新浪微博授权已过期，点击确定前往相应页面重新授权。"},douban:{disabled:"去豆瓣网授权后才可以发布，点击确定前往相应页面。",expired:"豆瓣网授权已过期，点击确定前往相应页面重新授权。"}},a={weibo:weibo_signin,renren:renren_signin,douban:douban_signin},l.css("position","relative").delegate("label,:checkbox","click",function(n){function v(){u.remove(),i[c]={is_disabled:!1,is_expired:!1},r.sign=!1}function m(){u.remove(),r.sign=!1}var r=this,u,c,h,p,d;p=$(this),p.is("label")?d=$("#"+p.attr("for")):(d=p,p=$("label[for="+d.attr("id")+"]",l)),c=d.val(),h=i[c];if(h.is_disabled||h.is_expired){if(r.sign){n.preventDefault();return}r.sign=!0,n.preventDefault(),f=l.css("margin-bottom"),l.css("margin-bottom","100px"),u=e(l,{msg:t.format(o,{msg:s[c][h.is_disabled?"disabled":"expired"],url:a[c]}),width:200,offset:20,position:[30,-10],coordinates:d},function(){l.css("margin-bottom",f)}),$(".closeBindTip",u.$toolTip).one("click",m).prev().one("click",v)}}))},makeShareTmpl:function(e){var n=r(),i=g_page_name=="editBlogPage"||g_page_name=="postEditPage"?"checked":"";if(n===undefined)return"";var s,o,u=!1;return t.each(n,function(e,t){u=!0}),u?(s="<p>同时分享到：",o={weibo:'&nbsp;&nbsp;<input id="shareXl" type="checkbox" value="weibo" name="share_opts" /><label class="gicon-share-lsina" for="shareXl">新浪微博</label>',douban:'&nbsp;&nbsp;<input id="shareDb" type="checkbox" value="douban" name="share_opts" /><label class="gicon-share-ldb" for="shareDb">豆瓣网</label>',activity:'&nbsp;&nbsp;<input id="shareAc" type="checkbox" value="activity" name="share_opts"'+i+' /><label for="shareAc">动态</label>'},t.each(o,function(e,t){s+=e||""}),s+="</p>"):s=t.format('绑定其他帐号：<a class="gicon-share-lsina" target="_blank" href="{weibo}" title="绑定新浪微博帐号">新浪微博</a><!--<a class="gicon-share-lrr" target="_blank" href="{renren}" title="绑定人人网帐号">人人网</a>--><a class="gicon-share-ldb" target="_blank" href="{douban}" title="绑定豆瓣网帐号">豆瓣网</a>',{weibo:weibo_signin,renren:renren_signin,douban:douban_signin}),e&&$(e).html(s),s},makeRecoTmpl:function(e){var n=r();if(n===undefined)return"";var i,s,o=!1;return t.each(n,function(e,t){t!=="activity"&&!e.is_disabled&&!e.is_expired&&(o=!0)}),o?(i="同时分享到：",s={weibo:'&nbsp;&nbsp;<input id="recoXl" type="checkbox" class="recoShare" value="weibo" name="weibo" /><label class="gicon-share-lsina" for="recoXl">新浪微博</label>',douban:'&nbsp;&nbsp;<input id="recoDb" type="checkbox" class="recoShare" value="douban" name="douban" /><label class="gicon-share-ldb" for="recoRr">豆瓣网</label>'},t.each(n,function(e,t){!e.is_disabled&&!e.is_expired&&(i+=s[t]||"")}),e&&$(e).html(i),i):""}}}),define("lib/draftNew",[],function(){"use strict";function e(e,t,n){function s(){r._sendDraft(function(){r._timer=setTimeout(s,i)})}var r=this,i=n.interval||3e4;this._bodyLimit=n.bodyLimit||30,this._titleLimit=n.titleLimit||15,this._checkTitle=n.checkTitle||!0,this._isTitleChange=!1,this._isBodyChange=!1,this._prefix=n.prefix||"日志",this._isAsk=n.isAsk||!1,this._$title=n.$title||null,this._success=n.success||null,this._editor=e,this._api=t,this._timer=null,this._markBodyChange=function(){r._isBodyChange=!0},this._markTitleChange=function(){r._isTitleChange=!0},r._checkTitle&&this._$title.bind("keyup",function(){r._markTitleChange()}),this._editor.on("keyup",r._markBodyChange),s()}return e.prototype._sendDraft=function(e){var t=this,n={},r=t._editor.getContent({format:"text"}),i=t._$title.val()||t._$title.text();n.body=t._editor?t._editor.getContent():"",n.type=t._prefix,n.location=window.location.href.split("?")[0].split("#")[0]+"#replyer",t._isBodyChange&&r.length>t._bodyLimit||t._isTitleChange&&i.length>t._titleLimit?(n.title=t._$title?$.trim(t._$title.val()||t._$title.text()):"未命名草稿",n.title||(n.title="未命名草稿"),t._api(n,function(){t._success(),t._isTitleChange=!1,t._isBodyChange=!1,e&&e.call(t)})):e&&e.call(t)},e.prototype.destory=function(){var e=this;e._timer&&(clearTimeout(e._timer),e._timer=0),e.checkTitle&&e._$title.unbind(),e._editor.off("keyup",e._markChange)},function(t,n,r){return new e(t,n,r)}}),define("lib/beforeLogin",[],function(){"use strict";function t(t){if(e)return;var r="成为果壳青年，一起记录科技时代",i=t||1e3,s='<div class="guokr-layer-beforelogin">                            <div class="guokr-layer-bl-con">                                <div class="guokr-layer-mobile-qrcode"></div>                                <div class="guokr-layer-mobile-text">                                    扫描下载果壳网官方App                                    <div>果壳精选，科学走着瞧</div>                                </div>                                <a class="guokr-layer-mobile-icon" href="http://www.guokr.com/mobile/" title="移动应用"></a>                                <div class="guokr-layer-slogan">'+r+'</div>                                <div class="guokr-layer-bl-btn">                                    <a class="gl-weibo" href="'+weibo_signin+'" data-gaevent="footer_login:v1.1.1.1:login" target="_blank"></a>                                </div>                                <div class="guokr-layer-bl-btn">                                    <a class="gl-qq" href="'+qq_signin+'"  data-gaevent="footer_login:v1.1.1.1:login" target="_blank"></a>                                </div>                                <div class="guokr-layer-bl-btn">                                    <a class="gl-douban" href="'+douban_signin+'"  data-gaevent="footer_login:v1.1.1.1:login" target="_blank"></a>                                </div>                                <div class="guokr-layer-bl-reg">                                    <a href="javascript: void 0;" data-login="yes" data-gaevent="footer_login:v1.1.1.1:login">登录</a><span>或直接</span>                                </div>                                <div class="guokr-layer-bl-btn">                                    <a class="gl-reg" href="'+url_signup+'"  data-gaevent="footer_login:v1.1.1.1:login" target="_blank"></a>                                </div>                                <div class="gclear"></div>                            </div>                            <div class="guokr-beforelogin-close"><a href="javascript:void(0)">关闭</a></div>                        </div>';$("body").append($(s)),$(".guokr-beforelogin-close").click(function(){n(i)}),$(".guokr-layer-beforelogin").fadeIn(i),e=!0}function n(t){if(!e)return;var n=t||1e3;$(".guokr-layer-beforelogin").fadeOut(n)}var e=!1;return function(e,r){var i=r||1e3,s=e||2e3,o=!1;return $(window).one("scroll",function(){t(i)}),setTimeout(function(){t(i)},e),{delLayer:n}}}),define("lib/report",["lib/Overlay","lib/tmpl"],function(e,t){function r(){var e=$("#reportReasons").find(":checked").next(),t=e.next(),n=t.length?t.val():e.text();return n}function i(e,t,i,s,o){function u(t){t.preventDefault();var i=r();if(!i){alert("请填写举报理由");return}if(i.length<2){alert("多写几个字又不会怀孕");return}if(i.length>140){alert("删除理由不能超过100个字");return}s(e,i,function(){n.close(),o()})}n.open(i,[{event:"click",selector:"#reportSure",func:u},{event:"click",selector:"#reportCancel",func:function(e){e.preventDefault(),n.close()}}]),n.title(t)}function u(e,n,r){if(e.attr("data-report")!="yes")return;var u=e.attr("data-url"),a=e.attr("data-type"),f=e.attr("data-title"),l=e.attr("data-img"),c={url:u,type:a,img:l,title:f},h=t(s,c),p="举报"+a;i(u,p,h,o.reportAdmin,function(){e.text("举报成功"),e.attr("data-report","no")})}var n=new e,s='<div class="block-report-content">                         <% if (img) { %>                         <img src="<%=img%>" width="48" height="48"/>                         <% } %>                         <% if (title) { %>                             <a href="<%=url%>" target="_blank"><%=title%></a>                         <% } %>                     </div>                     <div class="block-report-reasons">                         <h5>举报理由：</h5>                         <ul id="reportReasons">                             <li><input type="radio" id="reason1" name="reason" /><label for="reason1">垃圾广告</label></li>                             <li><input type="radio" id="reason2" name="reason"/><label for="reason2">敏感或淫秽色情信息</label></li>                             <li><input type="radio" id="reason3" name="reason"/><label for="reason3">人身攻击</label></li>                             <li><input type="radio" id="reason4" name="reason"/><label for="reason4">内容涉及抄袭及版权问题</label></li>                             <li class="block-report-reasons-o"><input type="radio" id="reason5" name="reason"/><label for="reason5">其他理由</label><input type="text" class="block-report-reasons-txt"/></li>                         </ul>                     </div>                     <div class="block-report-do">                         <a href="#" id="reportSure">提交</a><a href="#" id="reportCancel">取消</a>                     </div>',o={reportAdmin:function(e,t,n){$.post("/apis/censor/report.json",{url:e,reason:t},n)}};return u}),define("lib/Select",[],function(){var e=!1;return Select=function(e,t,n,r){this.selectId=e,this.optTmp=t||'<li><a href="javascript: void 0;" optId="{optionId}">{optName}</a></li>',this.option=n,this.callBack=r,this.init()},Select.prototype={constructor:Select,init:function(){this.buildSelect(),this.bindHover(),this.bindClick(),this.setOptions()},buildSelect:function(){var e=this,t=e.option,n=t.length,r="",i=$("#"+e.selectId);i.append('<ul class="options"></ul>');for(var s=0;s<n;s++)r+=e.optTmp.replace("{optionId}",t[s].id).replace("{optName}",t[s].name);i.find(".options").html(r)},bindHover:function(){$(document).delegate(".gselect","hover",function(){$(this).css({cursor:"pointer"})})},bindClick:function(){var t=this;$("#"+t.selectId).delegate(".gselect-box","click",function(){var n=$("#"+t.selectId),r=n.find(".options"),i=r.css("display");return i=="none"?(e&&$(".options").hide(),r.css("display","block"),e=!0):(r.css("display","none"),e=!1),!1}),$("body").click(function(){if(e)return $(".options").hide(),e=!1,!1})},setOptions:function(){var e=this,t=$("#"+e.selectId);t.delegate(".options li a","click",function(){e.setOption($(this)),e.callBack($(this))}),e.setOption(t.find(".options li:eq(0) a"))},setOption:function(e){var t=this,n=$("#"+t.selectId),r=e.html(),i=n.find(".gselected");i.html(r),n.find("ul a").removeClass("select-act"),e.addClass("select-act")}},Select}),define("lib/Basket",["lib/Overlay","lib/Select"],function(e,t){var n=function(n){var r={};return r={template:{newBasket:'<div class="new-basket-box">                                <label for="basketTitle">                                    标题<span class="new-basket-tip">（必填）</span>                                </label>                                <input id="basketTitle" />                                <label for="basketDescrip">描述</label>                                <textarea id="basketDescrip"></textarea>                                <label for="basketCategory">分类</label>                                <div id="basketCategory" class="gselect">                                    <div class="gselect-box">                                        <span class="gselected">选择类别</span>                                        <b class="gnarrow-down"></b>                                    </div>                                </div>                                <span class="basket-form-tip" id="basketCategoryTip"></span>                                <div class="gclear">                                    <a href="javascript:void 0;" class="gbtn gfr" id="createOkBtn">确定</a>                                </div>                            </div>',firstBasket:'<div class="first-basket-box"><a class="first-basket-tip" id="createFirstBlock"><span class="first-basket-add"><span class="first-basket-add-top"></span><span class="first-basket-add-mid"></span><span class="first-basket-add-btm"></span></span>创建一个果篮，把你喜欢的内容收集进来吧。</a><div class="first-basket-btns"><a href="javascript:void 0;" id="createFirstBtn" class="gfr gbtn">创建</a><a href="javascript:void 0;" class="blockClose gfr">取消</a></div></div>',basketList:'<div class="basket-box" id="basketBox"><ul class="baskets">{baskets}</ul><div class="basket-box-footer gclear"><a href="javascript:void 0;" id="createBasketBtn" class="gfl">创建新果篮</a><a href="javascript:void 0;" class="gfr gbtn blockClose">确定</a></div></div>',basketLi:'<li{adClas} data-basket_id="{basketId}"><span class="gfr">{operationTxt}</span><p class="gellipsis">{basketName}</p></li>',addedTag:'<span data-operation="delBasket">已添加</span>',addTag:'<a href="javascript:void 0;" data-operation="addBasket">+ 添加</a>',delTag:'<a href="javascript:void 0;" data-operation="delBasket">- 扔掉</a>'},apis:{basketApi:"/apis/favorite/basket.json",fruitApi:"/apis/favorite/link.json",categoryApi:"/apis/favorite/category.json"},ukey:ukey,fruitUrl:"",btitle:"",defaultOpts:{isCreateBasket:!1,createCallBack:function(e){},delLinkCallBack:function(e){e.parents("li").removeClass("added"),e.replaceWith(r.template.addTag)}},opt:function(){return $.extend({},this.defaultOpts,n)},add:function(e){var t=this,n=e;t.fruitUrl=n.attr("data-url"),t.btitle=n.attr("data-title"),t.getBasket()},del:function(e){var t=g_uid,n=this;$.ajax({url:n.apis.basketApi,type:"delete",data:{basket_id:e},success:function(e){window.location="/i/"+t+"/baskets/"},dataType:"json"})},getLinkInfo:function(e){var t=this;$.ajax({url:"/apis/favorite/link.json",type:"get",data:{ukey:t.ukey,url:t.fruitUrl,retrieve_type:"by_url"},success:function(n){var r=n.result;if(e){for(var i=0;i<r.baskets.length;i++){var s=r.baskets[i].id;for(var o=0;o<e.length;o++)if(e[o].id==s){e[o].contained_fruit=!0;break}}t.showBaskets(e)}},error:function(n){var r=$.parseJSON(n.responseText);r.error_code===200015&&t.showBaskets(e)},dataType:"json"})},getBasket:function(){var e=this;ukey&&$.ajax({url:e.apis.basketApi+"?t="+(new Date).getTime(),type:"get",data:{retrieve_type:"by_ukey",ukey:e.ukey,limit:100},success:function(t){var n=t.result;n.length==0?e.createFirstBasket():e.getLinkInfo(n)},dataType:"json"})},fruitAdd:function(e,t){var n=this;$.ajax({url:n.apis.fruitApi,type:"POST",data:{basket_id:e,url:n.fruitUrl,title:n.btitle},success:function(e){t.parents("li").addClass("added"),t.replaceWith(n.template.addedTag)},dataType:"json"})},fruitDel:function(e,t,n){var r=this,n=n||r.fruitUrl;$.ajax({url:r.apis.fruitApi,type:"delete",data:{basket_id:e,url:n},success:function(e){r.opt().delLinkCallBack(t)},dataType:"json"})},createFirstBasket:function(){var t=new e,n=this;t.open(n.template.firstBasket,null,function(){t.title("创建新果篮"),t.width(432),$(".first-basket-box").delegate("#createFirstBlock","click",function(){n.createBasket()}),$(".first-basket-box").delegate("#createFirstBtn","click",function(){n.createBasket()})})},basketSend:function(e,t,n,r){var i=this;$.ajax({url:i.apis.basketApi,type:"post",data:{title:e,introduction:t,category_id:n},success:function(e){var t=e;i.opt().isCreateBasket?(r.close(),i.opt().createCallBack(t)):i.getBasket()},error:function(e){var t=$.parseJSON(e.responseText);t.error_code===243043?alert("您已经创建过同名果篮"):t.error_code===243045&&alert("您已经超过了可创建果篮的最大限制")},dataType:"json"})},getCategory:function(){var e=this;$.ajax({url:e.apis.categoryApi,type:"GET",success:function(t){var n=t.result;n.unshift({id:"-1",name:"选择类别"}),e.createBasketBlock(n)},dataType:"json"})},createBasket:function(){var e=this;e.getCategory()},createBasketBlock:function(n){var r=new e,i=this;r.open(i.template.newBasket,null,function(){r.title("创建新果篮"),r.width(432);var e='<li><a href="javascript: void 0;" data-category="{optionId}">{optName}</a></li>',s=new t("basketCategory",e,n,function(){});$(".new-basket-box").delegate("#createOkBtn","click",function(){var e=$("#basketTitle").val(),t=$("#basketDescrip").val(),n=$("#basketCategory .options .select-act").data("category");if(e===""){$("#basketTitle").css("border-color","red");return}i.basketSend(e,t,n,r)})})},showBaskets:function(t){var n=new e,r=this,i="",s="",o=t,u=o.length,a,f="";for(var l=0;l<u;l++)a=o[l],adClas=a.contained_fruit?' class="added"':"",f=a.contained_fruit?r.template.addedTag:r.template.addTag,i+=r.template.basketLi.replace("{adClas}",adClas).replace("{basketId}",a.id).replace("{basketName}",a.title).replace("{operationTxt}",f);s=r.template.basketList.replace("{baskets}",i),n.open(s,null,function(){n.title("添加到果篮"),n.width(432),$("#basketBox").delegate(".added","mouseenter",function(){$(this).find(".gfr").html(r.template.delTag)}),$("#basketBox").delegate(".added","mouseleave",function(){$(this).find(".gfr").html(r.template.addedTag)}),$("#basketBox").delegate("[data-operation]","click",function(){var e=$(this),t=e.attr("data-operation"),n=e.parents("li").attr("data-basket_id");if(t=="addBasket")r.fruitAdd(n,e);else{if(t!="delBasket")return;r.fruitDel(n,e)}}),$("#basketBox").delegate("#createBasketBtn","click",function(){r.createBasket()})})}}};return n}),define("lib/groupJoin",["lib/Overlay","lib/Count","lib/placeholder"],function(Overlay,Count,placeholder){function joinHTML(e,t){return'<a class="delete" href="javascript:void 0;" data-id="'+e+'" data-method="'+t+'" data-operation="quit">已加入</a>'}function quitHTML(e,t,n,r){return'<a class="add" data-gaevent="group_join_button:group" href="javascript:void 0;" data-id="'+e+'" data-operation="'+t+'" data-method="'+n+'">'+r+"</a>"}function joinGroup(type,id,cb){$.ajax({url:"/apis/group/member.json",data:{group_id:id},type:type,success:function(e){e.ok&&cb&&cb()},error:function(data){var json=eval("("+data.responseText+")");json.error_code==241001?alert("该小组不存在"):json.error_code==241016?alert("你不是这个小组的成员"):json.error_code==241017?alert("你是这个小组的管理员，不能退出"):json.error_code==241014&&alert("你在这个小组的黑名单里，不能加入")},dataType:"json"})}function applyJoinGroup(e,t,n){$.ajax({url:"/apis/group/member_application.json",data:{group_id:t,annotation:e},type:"POST",success:function(e){e.ok&&n&&n()},dataType:"json"})}function groupJoin(e){var t=$(e.containerSelector||"body"),n=e.targetSelector||"a[data-operation]",r=e.numberSelector,i=e.parentsSelector||!0,s=e.join||joinHTML,o=e.quit||quitHTML,u=e.applyBlock||htmls.applyBlock,a=e.applied||htmls.applied;t.delegate(n,"click",function(){var n=$(this),f=n.data("operation"),l=n.attr("data-method"),c=n.attr("data-id"),h=l==="apply"?"申请":"+&nbsp;加入",p;r&&(i===!0?p=new Count(n.parent().find(r)):i===1?p=new Count(t.find(r)):p=new Count(n.parent(i).find(r))),f==="quit"||f==="unjoin"?joinGroup(type[f],c,function(){n.replaceWith(o(c,l,l,h)),p.hasTarget&&p.add(adds[f]),e.callback&&e.callback()}):f==="join"?joinGroup(type[f],c,function(){n.replaceWith(s(c,l)),p.hasTarget&&p.add(adds[f]),e.callback&&e.callback()}):block.open(u,null,function(){return block.title("加入这个小组需要申请哦，说说你的理由吧"),placeholder.init("#applyDetail"),$("#applyBtn").click(function(e){e.preventDefault();var t=$("#applyDetail"),r=t.val();applyTip=$(this).parent().prev(),placeholder.support||r===t.attr("placeholder")&&(t.val(""),r="");if(r.length>250)return applyTip.text(i18n.applyTextTooLong),!1;if(!r.length)return applyTip.text(i18n.applyEmpty),!1;applyJoinGroup(r,c,function(){block.close(),n.replaceWith(a)})}),!0})})}var htmls={applyBlock:'<div class="gui-block-apply">                            <textarea class="gttxt" placeholder="说点什么给管理员..." id="applyDetail"></textarea>                            <p class="fl" style="color:red"></p>                            <p class="fr">                                <a href="javascript: void 0;" class="gnbtn" id="applyBtn">提交</a>                                <a href="javascript: void 0;" class="blockClose">取消</a>                            </p>                         </div>',applied:'<span class="applied">已申请</span>'},i18n={applyTextTooLong:"申请理由不能超过250个字！",applyEmpty:"说点什么，让管理员了解你"},adds={join:1,quit:-1},type={join:"POST",quit:"DELETE"},block=new Overlay,joinOpts={rank:{containerSelector:".side-rank",numberSelector:"span.number"},groupList:{containerSelector:".group-list",targetSelector:".quitBtn,.joinBtn",numberSelector:".number",join:function(e,t){return'<a class="quitBtn"  href="javascript:void 0;" data-id="'+e+'" data-operation="quit" data-method="'+t+'"><span class="icon-ok">已加入</span></a>'},quit:function(e,t,n,r){return'<a class="joinBtn" data-gaevent="group_one_button_join:group" href="javascript:void 0;" data-id="'+e+'" data-operation="join" data-method="'+n+'">'+r+"</a>"}}};return function(){var e=[].slice.call(arguments),t=arguments.length,n;while(t--)typeof e[t]=="string"?(n=joinOpts[e[t]])&&groupJoin(n):typeof e[t]=="object"&&groupJoin(e[t])}}),define("lib/nameCard",["lib/toolTip","lib/tmpl"],function(toolTip,tmpl){function init(e,t,n,r,i){e=e,options=t,elemData=n,where=r||g_page_name,options.isGroup?getGroupData(i):getUserData(i)}function userFocus(e){var e=e;e.ukey&&(e.ukey===window.ukey?e.isMe=!0:$.ajax({url:"/apis/community/relationship/follow.json?retrieve_type=is_following&ukey="+e.ukey,async:!1,success:function(t){e.isFollowing=t.result.is_following},dataType:"json"}));if(window.ukey){e.isMe?nameCardToolTip.$toolTip.find('a[data-operation="follow"]').remove():e.isFollowing&&nameCardToolTip.$toolTip.find('a[data-operation="follow"]').replaceWith('<a class="card-focus_complete-btn" data-operation="unfollow" href="javascript: void 0;" data-login="yes"><span>已关注</span></a>');var t=follow();t.bind(nameCardToolTip.$toolTip,e.ukey)}}function showTooltip(e,t){var n=$(container),r=elemData.triggerElem,i=$(window).height(),s=$(window).width(),o=elemData.triggerTopViewArea,u=elemData.triggerRightViewArea,a=r.offset().left,f=r.offset().top+30,l=parseInt(r.css("height")),c=parseInt(r.css("width")),h=[f+l+12,a],p=o>i/2?"down":"up",d=options.offset||10,v=options.width||300,m=options.klass||"name_card";isGroup=options.isGroup||!1,a>s/2&&s-u<v-20&&(h[1]=a-v+50,d=v-d-20);if(window.nameCardShowOrder===t){nameCardToolTip=toolTip(n,{msg:e.resultHtml,position:h,direction:p,offset:d,width:v,klass:m},function(){return!1});if(p==="up")nameCardToolTip.$toolTip.css({top:f,display:"block"});else if(p==="down"){var g=parseInt(nameCardToolTip.$toolTip.css("height"));nameCardToolTip.$toolTip.css({top:f-g-52,display:"block"})}if(isGroup){if(window.ukey){var y=follow();y.bind(nameCardToolTip.$toolTip)}}else userFocus(e)}}function getGroupData(e){window.groupInfoCache=window.groupInfoCache||{};var t=elemData.triggerElem.attr("data-group_id"),n={resultHtml:""};groupInfoCache[t]?(n.resultHtml=formatHtml(groupInfoCache[t]),showTooltip(n,e)):$.ajax({url:"/apis/group/group.json",data:{retrieve_type:"by_id",group_id:t},success:function(n){var n=n.result[0],r={};for(var i in n)r[i]=n[i];r.icon=n.icon.large,groupInfoCache[t]=r;if(!r.is_publicly_readable)return;$.ajax({url:"/apis/group/post.json",data:{retrieve_type:"digest_post_by_group",group_id:t,limit:3},success:function(n){groupInfoCache[t].digests=n.result;var r=formatHtml(groupInfoCache[t]),i={resultHtml:r};showTooltip(i,e)},dataType:"json"})},dataType:"json"})}function getUserData(e){window.userInfoCache=window.userInfoCache||{};var t="",n="",r={resultHtml:"",ukey:"",isFollowing:!1,isMe:!1};if(elemData.ukey)t=elemData.ukey,r.ukey=elemData.ukey,n="/apis/community/user/"+t+".json";else{if(!elemData.nickname)return r.resultHtml=notExistHtml,showTooltip(r,e),!1;t=elemData.nickname,n="/apis/community/user.json?retrieve_type=by_nickname&nickname="+t}/^group/.test(where)?(r.resultHtml=nameCardHtml+groupFootmark,userInfoCache[t]?(r.resultHtml=formatHtml(userInfoCache[t],r.resultHtml),showTooltip(r,e)):$.ajax({url:n,success:function(t){var n=t.result;t.result.hasOwnProperty("ukey")||n[decodeURI(elemData.nickname)]&&n[decodeURI(elemData.nickname)].hasOwnProperty("ukey")?(r.ukey=n.ukey||n[decodeURI(elemData.nickname)].ukey,elemData.ukey?userInfoCache[r.ukey]=n:elemData.nickname&&(userInfoCache[r.ukey]=n[decodeURI(elemData.nickname)]),$.ajax({url:"/apis/group/user_info.json?ukey="+r.ukey,success:function(t){var n=t.result;for(var i in n)userInfoCache[r.ukey][i]=n[i];r.resultHtml=formatHtml(userInfoCache[r.ukey],r.resultHtml),showTooltip(r,e)},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"})):(r.resultHtml=notExistHtml,showTooltip(r,e))},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"})):/^ask/.test(where)?(r.resultHtml=nameCardHtml+askFootmark,userInfoCache[t]?(r.resultHtml=formatHtml(userInfoCache[t],r.resultHtml),showTooltip(r,e)):$.ajax({url:n,success:function(t){var n=t.result;t.result.hasOwnProperty("ukey")||n[decodeURI(elemData.nickname)]&&n[decodeURI(triggerElemData.nickname)].hasOwnProperty("ukey")?(r.ukey=n.ukey||n[decodeURI(elemData.nickname)].ukey,elemData.ukey?userInfoCache[r.ukey]=n:elemData.nickname&&(userInfoCache[r.ukey]=n[decodeURI(elemData.nickname)]),r.resultHtml=formatHtml(userInfoCache[r.ukey],r.resultHtml),showTooltip(r,e)):(r.resultHtml=notExistHtml,showTooltip(r,e))},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"})):where==="site"&&(r.resultHtml=nameCardHtml+siteFootMark,userInfoCache[t]?(r.resultHtml=formatSiteHtml(userInfoCache[t],r.resultHtml),showTooltip(r,e)):$.ajax({url:n,success:function(t){var n=t.result;t.result.hasOwnProperty("ukey")||n[decodeURI(elemData.nickname)]&&n[decodeURI(triggerElemData.nickname)].hasOwnProperty("ukey")?(r.ukey=n.ukey||n[decodeURI(elemData.nickname)].ukey,elemData.ukey?userInfoCache[r.ukey]=n:elemData.nickname&&(userInfoCache[r.ukey]=n[decodeURI(elemData.nickname)]),$.ajax({url:"/apis/minisite/article.json?retrieve_type=by_ukey&limit=3&ukey="+r.ukey,success:function(t){var n=t.result;userInfoCache[r.ukey]._new_articles=n,r.resultHtml=formatSiteHtml(userInfoCache[r.ukey],r.resultHtml),showTooltip(r,e)},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"})):(r.resultHtml=notExistHtml,showTooltip(r,e))},error:function(){r.resultHtml=notExistHtml,showTooltip(r,e)},dataType:"json"}))}function formatHtml(e,t){var n=e.level==="active"?'class="super-group-name"':"";if(!options.isGroup){var r="";e.introduction&&e.introduction.length>65&&(e.introduction=e.introduction.substr(0,65)+"...");if(e.admin_group&&e.admin_group.length>0){var i='<a href="<%=url%>"><%=title%></a>，';r+="<p>管理的小组：";for(var s=0;s<e.admin_group.length;s++)r+=tmpl(i,{url:e.admin_group[s][1],title:e.admin_group[s][0]});r=r.substr(0,r.length-1),r+="</p>"}var o=tmpl(userAchieveHtml,{badge_counts_gold:e.badge_counts.gold,badge_counts_silver:e.badge_counts.silver,badge_counts_copper:e.badge_counts.copper}),u=e.is_title_authorized?tmpl('<a class="icon-sai" target="_blank" title="果壳达人:<%=title%>" href="http://www.guokr.com/nuts/"></a>',{title:e.title}):"",a=tmpl(userNutHtml,{is_title_authorized:u});userFollow=tmpl(userFollowHtml,{followings_count:e.followings_count,followings_url:e.url+"followings/",followers_count:e.followers_count,followers_url:e.url+"followers/"}),t=tmpl(t,{url:e.url,avatar_normal:e.avatar.normal,nickname:e.nickname,title:tmpl("<%=title%><%:=br%>",{title:e.title.trim()?e.title:"",br:e.title.trim()?"<br />":""}),userNut:a,nutKlass:n,achieveHtml:o,followHtml:userFollow,introduction:e.title.trim()?e.introduction.trim()?"简介："+e.introduction:"":e.introduction.trim()?"简介："+e.introduction:"简介：这家伙很懒，还没有写简介",posts_count:e.posts_count,digest_posts_count:e.digest_posts_count,post_replies_count:e.post_replies_count,admin_group:r,questions_count:e.questions_count,answers_count:e.answers_count,answer_supports_count:e.answer_supports_count})}else{e.introduction_summary&&e.introduction_summary.length>65&&(e.introduction_summary=e.introduction_summary.substr(0,65)+"...");if(e.is_application_required)var f=e.is_membership_applied?groupAppliedHtml:groupApplyHtml;else var f=e.is_member?groupUnfollowHtml:groupFollowHtml;followStr=tmpl(f,{memberNum:e.members_count,url:e.url,groupId:e.id}),groupAchieve=tmpl(groupAchieveHtml,{groupPostNum:e.posts_count});var l=e.level==="active"?tmpl('<a class="gicon-super" title="此小组处于高维空间，拥有更多功能与玩法" href="<%=url%>"></a>',{url:e.url}):"",t=tmpl(nameCardHtml,{avatar_normal:e.icon,nickname:e.name,nutKlass:n,achieveHtml:groupAchieve,userNut:l,followHtml:followStr,introduction:e.introduction_summary,title:"",url:e.url,groupId:e.id});digestsHtml="",digests=e.digests;if(digests){var c='<li class="gellipsis"><a href="<%=url%>"><%=title%></a></li>';for(var h=0;h<digests.length;h++){var p=digests[h];digestsHtml+=tmpl(c,{url:p.url,title:p.title})}var d=tmpl(groupFoot,{postDigests:digestsHtml});t+=d}}return t}function formatSiteHtml(e,t){var n="",r='<a href="<%=url%>"><%=title%></a><br/>',i=e._new_articles;if(i&&i.length>0){n+='<div class="card-footmark">                            <p class="card-footmark-tit"><span>主题站最新文章</span></p>                            <div class="card-footmark-info">';for(var s=0;s<i.length;s++)n+=tmpl(r,{url:i[s].url,title:i[s].title});n=n.substr(0,n.length-1),n+="</div></div>"}e.introduction&&e.introduction.length>65&&(e.introduction=e.introduction.substr(0,65)+"...");var o=tmpl(userAchieveHtml,{badge_counts_gold:e.badge_counts.gold,badge_counts_silver:e.badge_counts.silver,badge_counts_copper:e.badge_counts.copper}),u=e.is_title_authorized?tmpl('<a class="gicon-sai" target="_blank" title="果壳达人:<%=title%>" href="http://www.guokr.com/nuts/">ψ</a>',{title:e.title}):"",a=tmpl(userNutHtml,{is_title_authorized:u});return userFollow=tmpl(userFollowHtml,{followings_count:e.followings_count,followings_url:e.url+"followings/",followers_count:e.followers_count,followers_url:e.url+"followers/"}),t=tmpl(t,{url:e.url,avatar_normal:e.avatar.normal,nickname:e.nickname,title:tmpl("<%=title%><%:=br%>",{title:e.title.trim()?e.title:"",br:e.title.trim()?"<br />":""}),userNut:a,nutKlass:"",achieveHtml:o,followHtml:userFollow,introduction:e.title.trim()?e.introduction.trim()?"简介："+e.introduction:"":e.introduction.trim()?"简介："+e.introduction:"简介：这家伙很懒，还没有写简介",site_articles:n}),t}function follow(){return{mouseEvents:function(e){function t(e){e.removeClass().addClass("card-focus_cancel-btn").html("<span>取消</span>")}function n(e){if(options.isGroup)var t="<span>已加入</span>";else var t="<span>已关注</span>";e.removeClass().addClass("card-focus_complete-btn").html(t)}e.delegate(".card-focus_complete-btn","mouseenter",function(){t($(this))}),e.delegate(".card-focus_cancel-btn","mouseleave",function(){n($(this))})},followApi:function(e,t,n){$.ajax({url:"/apis/community/relationship/follow.json",data:{ukey_following:e},type:t,success:function(e){e.ok&&n&&n()},dataType:"json"})},joinApi:function(id,type,cb){$.ajax({url:"/apis/group/member.json",data:{group_id:id},type:type,success:function(e){e.ok&&cb&&cb()},error:function(data){var json=eval("("+data.responseText+")");json.error_code==241001?alert("该小组不存在"):json.error_code==241016?alert("你不是这个小组的成员"):json.error_code==241017?alert("你是这个小组的管理员，不能退出"):json.error_code==241014&&alert("你在这个小组的黑名单里，不能加入")},dataType:"json"})},doFollow:function(e,t){var n=this,r=e.data("operation");if(options.isGroup){var i=r==="join"?"post":"delete",s=e.data("id");this.joinApi(s,i,function(){i==="post"?e.replaceWith(tmpl('<a class="card-focus_complete-btn" data-operation="unjoin" href="javascript: void 0;" data-login="yes" data-id="<%=id%>"><span>已加入</span></a>',{id:s})):e.replaceWith(tmpl('<a class="card-focus-btn" data-operation="join" href="javascript: void 0;" data-login="yes" data-id="<%=id%>"><span>加入</span></a>',{id:s}))})}else{var i=r==="follow"?"post":"delete";this.followApi(t,i,function(){i==="post"?e.replaceWith('<a class="card-focus_complete-btn" data-operation="unfollow" href="javascript: void 0;" data-login="yes"><span>已关注</span></a>'):e.replaceWith('<a class="card-focus-btn" data-operation="follow" href="javascript: void 0;" data-login="yes"><span>关注</span></a>')})}},bind:function(e,t){var n=this;(function(){e.delegate("a[data-operation]","click",function(){n.doFollow($(this),t)}),n.mouseEvents($(this))})()}}}var nameCardHtml='<div class="card-head">                    <a href="<%=url%>" class="card-user_pic"><img src="<%=avatar_normal%>" title="<%=nickname%>"></a>                    <div class="card-user_info">                        <div class="card-user_info-name">                            <a href="<%=url%>" <%:=nutKlass%> ><%=nickname%></a><%:=userNut%>                        </div>                        <div class="card-achieve-stat"><%:=achieveHtml%></div>                    </div>                </div>                <div class="card-focus"><%:=followHtml%></div>                <div class="card-desp"><%:=title%><%=introduction%></div>',userNutHtml='<span class="card-user_info-nuts"><%:=is_title_authorized%></span>',userAchieveHtml=' <span class="card-achieve-num"><i class="card-achieve-icon-gold icon-medal"></i><%=badge_counts_gold%></span>                            <span class="card-achieve-num"><i class="card-achieve-icon-silver icon-medal"></i><%=badge_counts_silver%></span>                            <span class="card-achieve-num"><i class="card-achieve-icon-copper icon-medal"></i><%=badge_counts_copper%></span>',groupAchieveHtml='<span class="card-achieve-small"><%=groupPostNum%>&nbsp;帖子</span>',userFollowHtml='<a href="javascript:void 0;" class="card-focus-btn" data-operation="follow" data-login="yes"><span>关注</span></a>                            <a href="<%=followings_url%>" class="card-focus-num">关注&nbsp;&nbsp;&nbsp;<span><%=followings_count%></span></a>|                            <a href="<%=followers_url%>" class="card-focus-num">被关注&nbsp;&nbsp;&nbsp;<span><%=followers_count%></span></a>',groupFollowHtml='<a href="javascript:void 0;" class="card-focus-btn" data-operation="join" data-login="yes" data-id="<%=groupId%>"><span>加入</span></a>                            <a href="<%=url%>members/" class="card-focus-num">成员&nbsp;&nbsp;&nbsp;<span><%=memberNum%></span></a>',groupUnfollowHtml='<a href="javascript:void 0;" class="card-focus_complete-btn" data-operation="quit" data-login="yes" data-id="<%=groupId%>"><span>已加入</span></a>                            <a href="<%=url%>members/" class="card-focus-num">成员&nbsp;&nbsp;&nbsp;<span><%=memberNum%></span></a>',groupApplyHtml='<a href="<%=url%>" class="card-focus-btn" data-login="yes"><span>申请</span></a>                        <a href="<%=url%>members/" class="card-focus-num">成员&nbsp;&nbsp;&nbsp;<span><%=memberNum%></span></a>',groupAppliedHtml='<span class="card-focus_complete-btn"><span>已加入</span></span>                            <a href="<%=url%>members/" class="card-focus-num">成员&nbsp;&nbsp;&nbsp;<span><%=memberNum%></span></a>',groupFootmark='<div class="card-footmark">                            <p class="card-footmark-tit"><span>小组足迹</span></p>                            <div class="card-footmark-info">                                <p>                                    发帖：<span><%=posts_count%></span>                                    精华：<span><%=digest_posts_count%></span>                                    回帖：<span><%=post_replies_count%></span>                                </p>                                <%:=admin_group%>                            </div>                        </div>',askFootmark='<div class="card-footmark">                            <p class="card-footmark-tit"><span>问答足迹</span></p>                            <div class="card-footmark-info">                                <p>                                    提问：<span><%=questions_count%></span>                                    回答：<span><%=answers_count%></span>                                    获得支持：<span><%=answer_supports_count%></span>                                </p>                            </div>                        </div>',groupFoot='<div class="card-footmark">                        <p class="card-footmark-tit"><span>最新精华帖</span></p>                        <ul class="card-footmark-info">                            <%:=postDigests%>                        </ul>                    </div>',siteFootMark="<%:=site_articles%>",notExistHtml='<div class="card-head">抱歉，该用户不在这个位面。</div>',nameCardToolTip=null,container="body",options={},elemData={},where="",showOrder=window.nameCardShowOrder||0,ukey=ukey,nameCard=function(e,t,n,r,i){init(e,t,n,r,i)};return nameCard}),define("lib/userCard",["lib/nameCard"],function(e){function t(e,t,n,r){return function(){var i=e.attr("data-ukey")||"",s=e.attr("href").replace(/^(?:(?:http\:\/\/[a-z0-9\.]*)?guokr\.com(?:\:\d+)?)?\/n\/([^\/]*)\/$/,"$1")||"";window.nameCardShowOrder=window.nameCardShowOrder||0,r($(".gwrap"),{offset:10},{ukey:i,nickname:s,triggerElem:e,triggerTopViewArea:t,triggerRightViewArea:n},"group",window.nameCardShowOrder)}}return function(n){var r=null;n.delegate('a[href*="/i/"][data-ukey]',"mouseenter",function(){var n=$(this),i=this.getBoundingClientRect().top,s=this.getBoundingClientRect().right;r=window.setTimeout(t(n,i,s,e),500)}),n.delegate('a[href*="/i/"][data-ukey]',"mouseleave",function(){clearTimeout(r),r=setTimeout(function(){$(".name_card").remove(),window.nameCardShowOrder++},200),$(".name_card").hover(function(){clearTimeout(r)},function(){$(this).remove(),window.nameCardShowOrder++})}),n.delegate('a[href*="/n/"]',"mouseenter",function(){if(/^(?:(?:http\:\/\/[a-z0-9\.]*)?guokr\.com(?:\:\d+)?)?\/n\/([^\/]*)\/$/.test($(this).attr("href"))){var n=$(this),i=this.getBoundingClientRect().top,s=this.getBoundingClientRect().right;r=window.setTimeout(t(n,i,s,e),500)}}),n.delegate('a[href*="/n/"]',"mouseleave",function(){/^(?:(?:http\:\/\/[a-z0-9\.]*)?guokr\.com(?:\:\d+)?)?\/n\/([^\/]*)\/$/.test($(this).attr("href"))&&(clearTimeout(r),r=setTimeout(function(){$(".name_card").remove(),window.nameCardShowOrder++},200),$(".name_card").hover(function(){clearTimeout(r)},function(){$(this).remove(),window.nameCardShowOrder++}))})}}),define("lib/slide",[],function(){"use strict";function t(e,t,n,r){n.hide(),n.eq(e).show(),r.removeClass(t),r.eq(e).addClass(t)}var e="current";return function(n,r,i,s){function d(n){s&&s.showEffect?s.showEffect(n,e,l,h):t(n,e,l,h)}function v(){a=0}function m(){a=1}var o=r||0,u=i||5e3,a=1,f=n.children().eq(0),l=f.children(),c=n.children().eq(1),h=c.children(),p=h.length;return d(o),u!==-1&&setInterval(function(){a&&(o++,o%=p,d(o))},u),f.hover(v,m),h.mouseover(function(){v(),o=h.index(this),d(o)}).mouseout(m),{show:function(){return d(),this},stop:function(){return v(),this},start:function(){return m(),this}}}}),require(["lib/user","lib/G","lib/Overlay","lib/toolBar","lib/Count","lib/placeholder","lib/bdShare","lib/gkimage","lib/gbbcode","lib/at","lib/AliasUtils","lib/draftNew","lib/beforeLogin","lib/toolTip","lib/cookies","lib/report","lib/Basket","lib/scrollto","lib/groupJoin","lib/userCard","lib/slide","lib/tmpl"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){"use strict";function D(e,t,n){e.delegate("a[data-operation]","click",function(e){e.preventDefault();var r=$(this);r.data("operation")===n?confirm("确定删除这条评论？")&&_.deleteComment(r.data("id"),function(){r.closest("li").fadeOut()}):r.data("operation")===t&&_.likeComment(r.data("id"),function(){var e=r.parent().find(".cmt-do-num");e.text(+e.text()+1),r.after('<span class="icon-like liked"></span>').remove()})})}function P(e,t){if(t&&g_is_member){var n,r="",i=t.dom,s=t.selection,o=e.parent(),r=o.prev().find(">:not(blockquote)").text(),u=100;r.length>u&&(r=r.substring(0,u)+"..."),s.setContent(["<blockquote>引用@",o.siblings(".cmtAuthor").text()," 的话：",tinymce.html.Entities.encodeRaw(r),"</blockquote>"].join("")),n=s.getEnd(),n&&n.tagName==="BLOCKQUOTE"&&s.setContent(" "),g($(k)),t.focus()}else g($(k))}function H(e,t){var n=$("#replyAlsoReco");e.submit(function(n){var r=this,i=$("#captcha");if(r.sign===!0)return!1;r.sign=!0;var s=t.dom.doc.body.innerText!=null?t.dom.doc.body.innerText:t.dom.doc.body.textContent,o=$.trim(s).length,u;if(!$.trim(t.getContent()))return alert("请填写内容"),r.sign=!1,!1;if(o>3e3)return alert("回应内容不能超过3000字"),r.sign=!1,!1;u=s.match(L);if(u&&u.length>20)return alert("对不起，不能@超过20个人"),r.sign=!1,!1;if(i.length&&i.attr("type")==="text"&&!i.val())return alert("验证码不能为空"),r.sign=!1,!1;e.find("textarea").val(function(){return t.getContent()})})}function B(e,t){var n;return g_can_publish_anon_post?n='<div class="anon-op"><input id="is_anon" type="checkbox" value="y" name="is_anon"><label for="is_anon">匿名发表</label></div>':n="",'<h3 id="replyer">你的评论</h3>                <form action="/post/'+e+'/#commentsReplyer" method="POST" id="replyForm">                    <input id="csrf_token" name="csrf_token" type="hidden" value="'+t+'">                    <textarea id="reply" name="body"></textarea>                    <input id="captcha" name="captcha" type="hidden" value="">                    <div class="cmts-submit-box gclear"><a href="javascript:void 0;" class="draft-btn" id="draftTip"></a><input type="submit" class="gnbtn-primary" value="发 布"><div class="cmts-share" id="checkAlias" style="position: relative; "></div>'+n+"</div>                </form>"}var S=g_obj_id,x="article",T=$("#comments"),N="#replyForm",C="reply",k="#commentsReplyer",L=/@[\u3400-\u4db5\u4e00-\u9fcba-zA-Z0-9\._\-]+/g,A=!1,O="",M=!1,_={deleteComment:function(e,t){$.ajax({url:"/apis/group/post_reply.json",data:{reply_id:e,reason:""},type:"DELETE",success:function(e){e.ok&&t&&t()},dataType:"json"})},likeComment:function(e,t){$.ajax({url:"/apis/group/post_reply_liking.json",data:{reply_id:e},type:"POST",success:function(e){e.ok&&t&&t()},dataType:"json"})},likePost:function(e,t,n,r){$.ajax({url:"/apis/group/post_liking.json",data:{post_id:e},type:t,success:function(e){e.ok&&n&&n()},error:function(e){r&&r(e)},dataType:"json"})},deletePost:function(e){_.adminDeletePost("作者删除",e)},adminDeletePost:function(e,t){$.ajax({url:"/apis/group/post.json",data:{reason:e,post_id:g_obj_id},type:"DELETE",success:function(e){e.ok&&t&&t()},dataType:"json"})},adminOperation:function(e,t){for(var n in e)e[n]=e[n]?"yes":"no";e.post_id=g_obj_id,$.ajax({url:"/apis/group/post.json",data:e,type:"PUT",success:function(e){e.ok&&t&&t()},dataType:"json"})},adminDeleteReply:function(e,t,n){$.post("/api/group/post_reply.json",{reply_id:e,reason:t},function(e){e==="OK"&&n&&n()})}},j={login:function(){function d(){function n(){if(tinyMCE.activeEditor)return r=tinyMCE.activeEditor,H(t,r),!0;setTimeout(n,100)}function a(){r&&r.initialized?(O==="replyQuote"&&P(h,r),setTimeout(function(){T.delegate("a[data-operation=quoteComment]","click",function(){P($(this),r)})},1e3),A=!0):setTimeout(a,1e3)}function l(e,t){u.html('<i class="icon-delete draft-save"></i>正在保存').css("visibility","visible"),$.ajax({url:"/apis/community/draft.json",type:"post",data:e,success:function(e){e.ok&&t&&(s=e.result.id,t())},dataType:"json"})}function p(){u.html('<i class="icon-delete draft-save"></i>已保存').css("visibility","visible").hover(function(){$(this).html('<i class="icon-delete draft-del"></i>删除草稿')},function(){$(this).html('<i class="icon-delete draft-save"></i>已保存')}).click(function(e){o&&confirm("确定要删除草稿并清空编辑框吗？")&&(o=!1,$.ajax({url:"/apis/community/draft.json",type:"delete",data:{ids:s},success:function(e){r.setContent(""),o=!0},dataType:"json"}),$(this).css("visibility","hidden"))})}function d(){i=c(tinyMCE.activeEditor,l,e),$(window).delegate("#stop","click",function(){i&&i.destory()})}var e={success:function(){p()},interval:2e4,$title:$("#articleTitle"),checkTitle:!1,prefix:"文章"};window.initEditor("#replyForm textarea:first",{width:648,content_css:tinymceContentCSS,submit_form_selector:"#replyForm",setup:function(e){e.on("init",function(e,t){d()})},atFunc:f}),n(),a()}function b(){if(A)return;$(".reply-box").hide(),$(".cmts-do form").show(),d()}var e=$("#"+C),t=$(N),r,i,s,o=!0,u=$("#draftTip"),a,h;$(".cmts-do form textarea").text()!==""?(O="draft",b()):($(".reply-box").on("click.init",function(){O="reply";if(!g_is_member){var e=g_obj_id,t=g_csrf_token;$(".group-info-small .add").trigger("click"),$("#commentsReplyer").html(B(e,t)),$("#checkAlias").html(l.makeShareTmpl()),l.checkAlias(w),$(".reply-box").off("click.init")}b()}),$("a[data-operation=quoteComment]").on("click",function(e){g_is_member?(O="replyQuote",h=$(this),b()):g($(k))}));var w=$("#checkAlias");w.html(l.makeShareTmpl()),l.checkAlias(w),$(".anon-op").delegate("#is_anon","click",function(){var e=$(this),t=e.prop("checked"),n=$("#shareAc");t?(n.attr("disabled","true"),n.removeAttr("checked")):n.removeAttr("disabled").attr("checked","true")}),T.delegate("ul.cmts-list>li","mouseenter mouseleave",function(){var e=$(this).find("a[data-report]");e.toggle(),e.next().toggle()}),T.delegate("a[data-report]","click",function(){v($(this))}),function(){var e=$("#recommendBt");e.click(function(){var t=new Recommend;t.show(g_share_data,e.find(".recom-num"))})}(),function(){var e=new m,t=$("#basketBtn");t.click(function(){e.add(t)})}(),$(".document").mouseup(function(e){function f(){return document.selection?u=$.trim(document.selection.createRange().text):window.getSelection()&&(u=$.trim(window.getSelection())),u.length>100&&(u=u.substring(0,100)+"..."),u}var t=5,i=5,s,o=null,u="";f()&&(a?$("#quoteToCmt").css({top:e.pageY+t+"px",left:e.pageX+i+"px",position:"absolute","z-index":999,"font-size":"12px"}).show("fast"):(A===!1&&(O="articleQuote",b()),a='<a class="gbtn quote_to_cmt" href="javascript:void 0;" id="quoteToCmt">引用到评论</a>',$("body").append(a),$("#quoteToCmt").css({top:e.pageY+t+"px",left:e.pageX+i+"px",position:"absolute","z-index":999,"font-size":"12px"}).show("fast").click(function(e){var t=r.getContent();r.setContent([t,t?"\n":"","<blockquote>引用文章内容：",f(),"</blockquote><br/>"].join("")),$("#quoteToCmt").hide(),s=(new n).open("<div>已将“"+u+"”引用到评论框。</div>").title("引用到评论框").closeCallBack(function(){o&&clearTimeout(o)}),o=setTimeout(function(){s.close()},2e3)})))}).mousedown(function(){$("#quoteToCmt").hide()}),T.find(".cmts-title, .cmts-list").show(),$(".gpages").show(),D(T,"likeComment","deleteComment");var S={deleteConfirm:"确认删除？"};(function(){$('a[data-operation="delete"]',"#controlPanel").click(function(e){var t=$(this),n=g_obj_id;e.preventDefault(),confirm(S.deleteConfirm)&&_.deletePost(function(){window.location.href=t.data("goto")})})})();if(g_is_admin){var x=new n,L=function(){var e=$("#delReasons").find(":checked").next(),t=e.next(),n=t.length?t.val():e.text();return n},M=function(e,t,n,r){function i(e){e.preventDefault();var t=L();if(!t){alert("请填写删除理由");return}if(t.length>140){alert("删除理由不能超过140个字");return}n(t,function(){x.close(),r()})}x.open(t,[{event:"click",selector:"#delSure",func:i},{event:"click",selector:"#delCancel",func:function(e){e.preventDefault(),x.close()}}]),x.title(e)},j=$("#commentsReplyer"),F="<h4>发表回应</h4><p>此帖子目前不允许回应</p>",I='<div class="block-del-content">                                            <% if (img) { %>                                            <img src="<%=img%>" width="48" height="48"/>                                            <% } %>                                            <div>                                                <a href="<%=link%>" target="_blank"><%=name%>：</a>                                                <p class="<%=contentClass%>"><%=content%></p>                                            </div>                                        </div>                                        <div class="block-del-reasons">                                            <h5>删除理由：</h5>                                            <ul id="delReasons">                                                <li><input type="radio" id="reason1" name="reason" /><label for="reason1">广告、色情等违规内容</label></li>                                                <li><input type="radio" id="reason2" name="reason"/><label for="reason2">与本组无关的内容</label></li>                                                <li><input type="radio" id="reason3" name="reason"/><label for="reason3">不适当言论</label></li>                                                <li><input type="radio" id="reason4" name="reason"/><label for="reason4">违反相关组规</label></li>                                                <li class="block-del-reasons-o"><input type="radio" id="reason5" name="reason"/><label for="reason5">其他理由</label><input type="text" class="block-del-reasons-txt"/></li>                                            </ul>                                        </div>                                        <div class="block-del-do">                                            <a href="#" id="delSure">提交</a><a href="#" id="delCancel">取消</a>                                        </div>',q={adminDeleteReply:function(){var e=this,t=e.parent(),n=t.siblings(".cmtAuthor"),r=t.siblings(".cmtContent").text().replace("\n",""),i={name:n.text(),link:n.attr("href"),img:t.siblings(".cmtImg").find("img").attr("src"),content:r.length>60?r.slice(0,60)+"...":r,contentClass:""},s={deleteTitle:"删除回应"},o=E(I,i);M(s.deleteTitle,o,_.adminDeleteReply,function(){e.closest("li").slideUp("slow")})},adminDelete:function(){var e=this,t=$("#articleAuthor"),n={name:t.text(),link:t.attr("href"),img:$("#articleAuthorImg").attr("src"),content:$("#articleTitle").text(),contentClass:"block-del-post"},r={deleteTitle:"删除主贴"},i=E(I,n);M(r.deleteTitle,i,_.adminDeletePost,function(){var t=e.attr("data-goto");t?window.location=t:window.location=window.location.pathname+window.location.search})},adminDigestOn:function(){var e=this;_.adminOperation({is_digest:!0},function(){e.replaceWith('<a href="javascript:void(0);" data-operation="adminDigestOff">取消精华</a>')})},adminDigestOff:function(){var e=this;_.adminOperation({is_digest:!1},function(){e.replaceWith('<a href="javascript:void(0);" data-operation="adminDigestOn">加精华</a>')})},adminReplyOff:function(){var e=this;_.adminOperation({is_replyable:!1},function(){e.replaceWith('<a href="javascript:void(0);" data-operation="adminReplyOn">解除禁止回应</a>'),j.html(F),$(".cmtQuote").each(function(){var e=$(this).parent();e.html(e.html().replace(/[^&]*&nbsp;&nbsp;\|&nbsp;&nbsp;([^&]*)/,"$1"))})})},adminReplyOn:function(){var e=this;_.adminOperation({is_replyable:!0},function(){location.reload()})},adminStickOn:function(){var e=this;_.adminOperation({is_stick:!0},function(){e.replaceWith('<a href="javascript:void(0);" data-operation="adminStickOff">解除置顶</a>')})},adminStickOff:function(){var e=this;_.adminOperation({is_stick:!1},function(){e.replaceWith('<a href="javascript:void(0);" data-operation="adminStickOn">置顶</a>')})}};$("#controlPanel").delegate("a[data-operation]","click",function(e){var t=$(this),n=t.attr("data-operation"),r;n&&n in q&&(e.preventDefault(),r=q[n],r.call(t))}),$("#comments").delegate(".adminCmtDelete","click",function(e){e.preventDefault();var t=$(this),n=t.attr("data-operation"),r;r=q[n],r.call(t)})}(function(){function i(t){t.preventDefault(),e.attr("src",n+"?v="+r++)}var e=$("#captchaImage"),t=$("#changeCaptchaImage"),n=e.attr("src"),r=1;t.click(i),e.click(i)})(),$(".document-do").delegate(".post-like-btn","click",function(e){e.preventDefault();var t=$(this),n=t.hasClass("gnbtn-primary")?"DELETE":"POST";_.likePost(t.data("id"),n,function(){var e=t.find(".post-like-num");t.hasClass("gnbtn-primary")?(e.text(+e.text()-1?+e.text()-1:0),t.removeClass("gnbtn-primary").addClass("gnbtn-block")):(e.text(+e.text()+1),t.removeClass("gnbtn-block").addClass("gnbtn-primary"))},function(e){var t=$.parseJSON(e.responseText).error_code;t===200101&&alert("你的动作太快了！")})}),$(".document-do").hover(function(){var e=$(this).find("a[data-report]");e.toggle(),e.next().toggle()}).delegate("a[data-report]","click",function(){v($(this))}),y({containerSelector:".group-info-small",targetSelector:"#joinBt",numberSelector:"#memberCounter",parentsSelector:1,join:function(e,t){return'<a id="joinBt" class="quit" href="javascript:void 0;" data-id="'+e+'" data-operation="quit" data-method="'+t+'">已加入<span class="split">|</span>退出</a>'},quit:function(e,t,n,r){return'<a id="joinBt" class="add" data-gaevent="group_one_button_join:group" href="javascript:void 0;" data-id="'+e+'" data-operation="join" data-method="'+n+'">'+r+"</a>"},callback:function(){g_is_member=!g_is_member}}),$("#newPostBtn").click(function(e){if(!g_is_member){e.preventDefault();var t=$(this).parent();t.css("overflow","visible").css("z-index","999").addClass("gclear");var n=p(t,{msg:'<div class="tip">                                <p class="tip-txt">只有小组成员才能发言，先加入小组吧</p>                                <div class="gpack">                                    <a class="tip-btn" href="javascript:void 0;">知道了</a>                                </div>                                <a class="tip-close icon-cross" href="javascript:void 0;"></a>                            </div>',position:[-90,770],direction:"down",offset:121,width:250},function(){return!1});t.find("s").css("background-color","transparent").css("color","#BDBDBD").css("zoom","1"),t.find(".tip-close, .tip-btn").click(function(){n.remove()})}}),$(".gmain").delegate("[data-blacklist=yes]","click",function(e){e.preventDefault(),alert("你已经被该帖子作者拉黑")}),$(".main").delegate("[data-blacklist=yes]","click",function(e){e.preventDefault(),g($("#commentsReplyer"))})},all:function(){function e(){$(".gbbcode-content").delegate("img","mouseenter",function(){var e=$(this);if(e.data("previewPrepared")){e.trigger("previewShow");return}e.wrap('<span class="pic-wrap"></span>').data("previewPrepared",!0).parent().bind("previewShow",function(){var e=$(this),t=window.devicePixelRatio||1,n=e.find("img:first"),r=n.data("orig-width"),i=n.data("orig-height"),s=n.width();if(r/t>64&&i/t>64){e.width(s),n.after('<span id="picView" class="pic-view" href="javascript:void(0);" title="预览图片"></span>');var o=e.find(".pic-view");o.css({left:s-30,cursor:"pointer"}).bind("click",function(e){e.preventDefault();var t=n.data("hashkey"),r=n.data("orig-width"),i=n.data("orig-height");r>64&&i>64&&window.open("/post/"+g_obj_id+"/gallery/#"+t)})}}).mouseleave(function(){$(this).find(".pic-view").remove()}).trigger("previewShow")})}function n(){var e=d.get("post_like")?!1:!0;e&&i()}function i(){var e=$(".post-like-btn"),t=p(e,{msg:'<div class="tip post-like-tip">                                    <p>来点赞吧，让这个帖子成为小组热帖。</p>                                    <a href="javascript:void 0;" class="tip-close  icon-cross" id="likeCloseBtn"></a>                                </div>',klass:"tooltip-new",position:[42,-110],direction:"up",zIndex:998,offset:130,width:270,noscroll:!0},function(){return!1});$("#likeCloseBtn").bind("click",function(){t.remove(),s()})}function s(){var e=new Date,t=365;e.setTime(e.getTime()+t*24*3600*1e3),d.set("post_like",1,e)}r($(".gwrap"),{gotopTitle:"回到顶部 "},null,null),a(),e(),n(),$(".post-detail a").attr("target","_blank"),$(".cmt-content a").attr("target","_blank"),function(){function r(){var e,n=$("#articleTitle").text().replace(/^\s*|\s*$/g,"")||document.title.replace(/^\s*|\s*$/g,""),r=$("#articleContent [data-video]:first").data("video"),i=location.protocol+"//"+location.host+location.pathname+"?f=wx";e=$.map($("#sharePic, #articleContent img, #articleContent noscript[data-image]"),function(e){var t=$(e),n=t.data("image")||t.data("src")||t.attr("src");return n&&(n=u.original(n)),n}),window._bd_share_config={share:{tag:"shareMain",bdText:n,bdDesc:n,bdUrl:i,bdPic:e,bdSign:"off",onBeforeClick:function(e,t){return e==="tsina"?(t.bdText="这个有意思 →_→【"+t.bdText+"】 （分享自 @果壳网）",r!==null&&(t.bdText+=r),t.bdPic=t.bdPic.join("||")):e==="tqq"?(t.bdText="这个有意思 →_→【"+t.bdText+"】 （分享自 @果壳网）",t.bdPic=t.bdPic.join("||")):(t.bdDesc="这个有意思 →_→【"+t.bdText+"】 （来自 果壳网）",t.bdPic=t.bdPic[0]||""),t},bdSnsKey:{tsina:"2727579136",tqq:"100246400"}}},t.loadScript("http://bdimg.share.baidu.com/static/api/js/share.js?v=86835285.js?cdnversion="+~(-(new Date)/36e5))}function i(e,t,n){e.hasClass("bdshare-button-style0-16")?(e.removeClass("bdshare-button-style0-16"),n!==!0&&e.show()):setTimeout(function(){i(e,t,n)},t)}var e=$("#share"),n='分享到：                        <a data-cmd="tsina" class="icon-weibo" href="#" title="分享到新浪微博"></a>                        <a data-cmd="douban" class="icon-douban" href="#" title="分享到豆瓣"></a>                        <a data-cmd="qzone" class="icon-qzone" href="#" title="分享到QQ空间"></a>                        <a data-cmd="tqq" class="icon-qqmb" href="#" title="分享到腾讯微博"></a>                        <a data-cmd="weixin" class="icon-weixin" href="#" title="分享到微信"></a>';o(e,n),e.hide(),e.attr("data-tag","shareMain"),r(),i(e,200)}(),b($(".cmts-list")),b($(".post-info"));var f=$("#sideSlide"),l=$("#sideSlideTmpl").html();$.get("/apis/flowingboard/flowingboard.json",{name:"post_sidepic"},function(e){if(e.result===null||e.result.length===0||e.result[0]===null)return;var t=e.result[0],n={items:[]},r=parseInt(f.css("width")),i=0;for(var s in t.items)t.items[s].url&&t.items[s].image&&(t.items[s].image=u.thumbnail(t.items[s].image,290,160).src,n.items.push(t.items[s]));n.items.length>0&&(f.addClass("side-promote"),f.html(E(l,n)),i=parseInt($(".focus-tag").css("width")),$(".focus-tag").css("left",(r-i)/2),w(f,0,3e3,{showEffect:function(e,t,n,r){n.filter(":visible").stop().animate({opacity:0},500,function(){$(this).css("top","-160px")}),n.eq(e).css("top",0).stop().animate({opacity:1},1e3),r.removeClass(t),r.eq(e).addClass(t)}}))},"json")},unlogin:function(){}},F=e.isLogin()?"login":"unlogin";j[F]&&j[F](ukey),j.all&&j.all()}),define("post",function(){})})();